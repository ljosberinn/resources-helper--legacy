var rHelper={init:{user:function(){rHelper.fn.INSRT_userSettings();rHelper.init.core()},core:function(){rHelper.fn.SET_tabSwitcherAnchorBased();rHelper.fn.SET_transportCost();$.each(rHelper.data.material,function(a){rHelper.fn.EVNT_materialInput(a);rHelper.fn.INSRT_materialRate(a);rHelper.fn.INSRT_materialAmountOfMines(a);rHelper.fn.INSRT_materialNewMinePrice(a);rHelper.fn.INSRT_materialRateWorth(a);rHelper.fn.INSRT_materialNewMinePerfectIncome(a);rHelper.fn.INSRT_flowRate(a,"material")});rHelper.fn.INSRT_totalMineWorth(rHelper.fn.CALC_totalMineWorth());
rHelper.fn.INSRT_totalMineCount(rHelper.fn.CALC_totalMineCount());rHelper.fn.INSRT_materialMineAmortisation();rHelper.fn.INSRT_materialHighlightMinePerfectIncome();var a=rHelper.fn.GET_calculationOrder();$.each(a,function(a,c){rHelper.fn.EVNT_factoryInput(c);rHelper.fn.INSRT_factoryName(c);rHelper.fn.INSRT_factoryLevel(c);rHelper.fn.INSRT_factoryOutput(c);rHelper.fn.INSRT_factoryUpgradeCost(c);rHelper.fn.INSRT_factoryDependencies(c);rHelper.fn.INSRT_factoryWorkload(c);rHelper.fn.INSRT_factoryTurnover(c);
rHelper.fn.INSRT_factoryTurnoverPerUpgrade(c);rHelper.fn.INSRT_factoryROI(c);rHelper.fn.INSRT_diamondFactoryOutput(c);rHelper.fn.INSRT_diamondFactoryOutputWarehouse(c);rHelper.fn.INSRT_diamondDependencies(c);rHelper.fn.INSRT_diamondEfficiency(c);rHelper.fn.INSRT_diamondProfit(c);rHelper.fn.INSRT_flowRate(c,"product")});rHelper.fn.INSRT_totalFactoryUpgrades();rHelper.fn.INSRT_factoryHighlightColumns();rHelper.fn.INSRT_diamondTop10Profit();rHelper.fn.INSRT_diamondTotalProfit();rHelper.fn.INSRT_flowDistributionGlobal();
rHelper.init.enableTippy()},enableTippy:function(){$.each($("[title]"),function(a,b){b._tippy||tippy(b,{dynamicTitle:!0})})}},fn:{GET_calculationOrder:function(){return[0,1,2,3,4,7,8,9,10,15,17,18,5,6,13,19,11,12,14,16,20,21]},API_toggleLoader:function(a){a=$("#api-"+a+"-loading");"none"==a.css("display")?a.fadeIn("fast").css("display","flex"):a.fadeOut("fast")},API_toggleSuccessor:function(a){a=$("#api-"+a+"-finished");"none"==a.css("display")?a.fadeIn("fast"):a.fadeOut("fast")},API_toggleSuccessorHelper:function(a){setTimeout(function(){rHelper.fn.API_toggleSuccessor(a)},
15E3)},API_getFactories:function(a){rHelper.fn.API_toggleLoader("factories");$.get("api/core.php?query=1&key="+a+"",function(a){$.each(a,function(a,b){rHelper.data.products[a].factoryLevel=b});a=rHelper.fn.GET_calculationOrder();$.each(a,function(a,b){rHelper.fn.INSRT_factoryLevel(b);rHelper.fn.INSRT_factoryOutput(b);rHelper.fn.INSRT_factoryUpgradeCost(b);rHelper.fn.INSRT_factoryDependencies(b);rHelper.fn.INSRT_factoryWorkload(b);rHelper.fn.INSRT_factoryTurnover(b);rHelper.fn.INSRT_factoryTurnoverPerUpgrade(b);
rHelper.fn.INSRT_factoryROI(b)});rHelper.fn.INSRT_totalFactoryUpgrades();rHelper.fn.INSRT_factoryHighlightColumns();rHelper.fn.API_toggleLoader("factories");rHelper.fn.API_toggleSuccessor("factories");rHelper.fn.API_toggleSuccessorHelper("factories")})},API_getWarehouse:function(a){rHelper.fn.API_toggleLoader("warehouse");$.getJSON("api/core.php?query=2&key="+a,function(a){$.each(a,function(a,b){var c=a,d="material";14<=a&&36>a?(c-=14,d="products"):36<=a&&52>a?(c-=36,d="loot"):52<=a&&(c-=52,d="units");
rHelper.data[d][c].warehouse.level=b.level;rHelper.data[d][c].warehouse.fillAmount=b.fillAmount;rHelper.data[d][c].warehouse.contingent=5E3*Math.pow(b.level,2);var f=rHelper.data[d][c].warehouse.fillAmount/rHelper.data[d][c].warehouse.contingent;isNaN(f)&&(f=0);rHelper.data[d][c].warehouse.fillStatus=f});rHelper.fn.API_toggleLoader("warehouse");rHelper.fn.API_toggleSuccessor("warehouse");rHelper.fn.API_toggleSuccessorHelper("warehouse")})},API_getMineSummary:function(a){rHelper.fn.API_toggleLoader("mines-summary");
$.get("api/core.php?query=51&key="+a+"",function(a){$.each(a,function(a,b){rHelper.data.material[a].perHour=b.perHour;rHelper.data.material[a].amountOfMines=b.amountOfMines});$.each(rHelper.data.material,function(a){rHelper.fn.INSRT_materialRate(a);rHelper.fn.INSRT_materialAmountOfMines(a);rHelper.fn.INSRT_materialNewMinePrice(a);rHelper.fn.INSRT_materialRateWorth(a);rHelper.fn.INSRT_materialNewMinePerfectIncome(a);rHelper.fn.CALC_dependantFactories(a,"material")});rHelper.fn.INSRT_totalMineWorth(rHelper.fn.CALC_totalMineWorth());
rHelper.fn.INSRT_totalMineCount(rHelper.fn.CALC_totalMineCount());rHelper.fn.INSRT_materialMineAmortisation();rHelper.fn.INSRT_materialHighlightMinePerfectIncome();rHelper.fn.API_toggleLoader("mines-summary");rHelper.fn.API_toggleSuccessor("mines-summary");rHelper.fn.API_toggleSuccessorHelper("mines-summary")})},API_getMineMap:function(){$.getJSON("api/core.php?mineMap",function(a){rHelper.data.mineMap=a;rHelper.fn.API_toggleLoader("mines-detailed");rHelper.fn.API_toggleSuccessor("mines-detailed");
rHelper.fn.API_toggleSuccessorHelper("mines-detailed")})},API_getMineMapInitiator:function(a){rHelper.fn.API_toggleLoader("mines-detailed");$.getJSON("api/core.php?query=5&key="+a,function(a){"rHelper.fn.API_getMineMap()"==a.callback?rHelper.fn.API_getMineMap():swal("Error","Couldn't fetch mine details - API potentially unavailable!","error")})},API_getPlayerInfo:function(a,b){rHelper.fn.API_toggleLoader("player");var c="api/core.php?query=7&key="+a;b&&(c+="&anonymity=true");$.getJSON(c,function(a){rHelper.data.userInformation.level=
a.lvl;rHelper.data.userInformation.points=a.points;rHelper.data.userInformation.rank=a.worldrank;a.name&&(rHelper.data.userInformation.name=a.name);a=(new Date(1E3*a.registerdate)).toISOString().match(/(\d{4}\-\d{2}\-\d{2})T(\d{2}:\d{2}:\d{2})/);rHelper.data.userInformation.registeredGame=a[1]+" "+a[2];rHelper.fn.API_toggleLoader("player");rHelper.fn.API_toggleSuccessor("player");rHelper.fn.API_toggleSuccessorHelper("player")})},API_getAttackLog:function(){$.getJSON("api/core.php?attackLog",function(a){rHelper.data.attackLog=
a;rHelper.fn.API_toggleLoader("attack-log");rHelper.fn.API_toggleSuccessor("attack-log");rHelper.fn.API_toggleSuccessorHelper("attack-log")})},API_getAttackLogInitiator:function(a){rHelper.fn.API_toggleLoader("attack-log");$.getJSON("api/core.php?query=9&key="+a,function(a){console.log(a);"rHelper.fn.API_getAttackLog()"==a.callback?rHelper.fn.API_getAttackLog():swal("Error","Couldn't fetch attack log - API potentially unavailable!","error")})},API_getTradeLog:function(){$.getJSON("api/core.php?tradeLog",
function(a){rHelper.data.tradeLog=a;rHelper.fn.API_toggleLoader("trade-log");rHelper.fn.API_toggleSuccessor("trade-log");rHelper.fn.API_toggleSuccessorHelper("trade-log")})},API_getTradeLogInitiator:function(a){rHelper.fn.API_toggleLoader("trade-log");$.getJSON("api/core.php?query=6&key="+a,function(a){"rHelper.fn.API_getTradeLog()"==a.callback?rHelper.fn.API_getTradeLog():swal("Error","Couldn't fetch trade log - API potentially unavailable!","error")})},API_getMissions:function(){$.getJSON("api/core.php?missions",
function(a){rHelper.data.missions=a;rHelper.fn.API_toggleLoader("missions");rHelper.fn.API_toggleSuccessor("missions");rHelper.fn.API_toggleSuccessorHelper("missions")})},API_getMissionsInitiator:function(a){rHelper.fn.API_toggleLoader("missions");$.getJSON("api/core.php?query=10&key="+a,function(a){"rHelper.fn.API_getMissions()"==a.callback&&rHelper.fn.API_getMissions()})},API_getBuildings:function(a){rHelper.fn.API_toggleLoader("buildings");$.getJSON("api/core.php?query=3&key="+a,function(a){$.each(a,
function(a,b){rHelper.data.buildings[a].level=b});rHelper.fn.API_toggleLoader("buildings");rHelper.fn.API_toggleSuccessor("buildings");rHelper.fn.API_toggleSuccessorHelper("buildings")})},API_getHeadquarter:function(a){rHelper.fn.API_toggleLoader("headquarter");$.getJSON("api/core.php?query=4&key="+a,function(a){rHelper.data.headquarter.user.hqPosition.lat=a.lat;rHelper.data.headquarter.user.hqPosition.lon=a.lon;rHelper.data.headquarter.user.level=a.level;$.each(a.paid,function(a,b){rHelper.data.headquarter.user.paid[a]=
b});rHelper.fn.API_toggleLoader("headquarter");rHelper.fn.API_toggleSuccessor("headquarter");rHelper.fn.API_toggleSuccessorHelper("headquarter")})},API_getCreditInformation:function(a){$("#api-credits").html('<span id="api-credits-loading" class="circles-to-rhombuses-spinner"><span class="rhombuses-circle"></span><span class="rhombuses-circle"></span><span class="rhombuses-circle"></span></span>');$("#api-credits-loading").css("display","flex");$.get("api/core.php?query=0&key="+a+"",function(a){a=
parseInt(a[0].creditsleft);rHelper.data.userInformation.remainingCredits=a;rHelper.fn.INSRT_API_remainingCredits(a);$("#api-submit").attr("disabled",!1);$("#api-credits-loading").css("display","none")})},API_init:function(a,b,c){$.isArray(b)&&$.each(b,function(d,e){switch(e){case 1:rHelper.fn.API_getFactories(a);break;case 2:rHelper.fn.API_getWarehouse(a);break;case 3:rHelper.fn.API_getBuildings(a);break;case 4:rHelper.fn.API_getHeadquarter(a);break;case 5:rHelper.fn.API_getMineMapInitiator(a);break;
case 51:rHelper.fn.API_getMineSummary(a);break;case 6:rHelper.fn.API_getTradeLogInitiator(a);break;case 7:rHelper.fn.API_getPlayerInfo(a,c);break;case 9:rHelper.fn.API_getAttackLogInitiator(a);break;case 10:rHelper.fn.API_getMissionsInitiator(a)}e==b[b.length-1]&&rHelper.fn.API_getCreditInformation(a)})},SET_globalObject:function(a,b,c,d){rHelper.data[a][b][c]=d;console.log(a,b,c,d)},SET_save:function(){localStorage.setItem("rGame",JSON.stringify(rHelper.data))},SET_tabSwitcherAnchorBased:function(){var a=
"#"+window.location.hash.substr(1);"#"==a&&(a="#factories");$(".nav-link").each(function(b,c){var d=$(c),e=$("#"+c.dataset.target);d.attr("href")==a?(e.css("display","block"),d.addClass("active")):(e.css("display","none"),d.removeClass("active"))})},SET_transportCost:function(){rHelper.data.buildings[9].transportCost=1+(15-rHelper.data.buildings[9].level)/100},EVNT_factoryInput:function(a){$("#factories-level-"+a).on("input",function(){var a=parseInt(this.id.replace("factories-level-","")),c=parseInt(this.value);
rHelper.fn.SET_globalObject("products",a,"factoryLevel",c);rHelper.fn.INSRT_factoryOutput(a);rHelper.fn.INSRT_factoryUpgradeCost(a);rHelper.fn.INSRT_factoryDependencies(a);rHelper.fn.INSRT_factoryWorkload(a);rHelper.fn.INSRT_factoryTurnover(a);rHelper.fn.INSRT_factoryTurnoverPerUpgrade(a);rHelper.fn.INSRT_factoryROI(a);rHelper.fn.CALC_dependantFactories(a,"product");rHelper.fn.INSRT_diamondFactoryLevel(a);rHelper.fn.INSRT_diamondFactoryOutput(a);rHelper.fn.INSRT_diamondFactoryOutputWarehouse(a);rHelper.fn.INSRT_diamondDependencies(a);
rHelper.fn.INSRT_diamondEfficiency(a);rHelper.fn.INSRT_diamondProfit(a);rHelper.fn.INSRT_diamondTop10Profit();rHelper.fn.INSRT_diamondTotalProfit();rHelper.fn.INSRT_flowRate(a,"product");rHelper.fn.INSRT_flowDistributionGlobal();rHelper.fn.INSRT_factoryHighlightColumns()})},EVNT_materialInput:function(a){$("#material-rate-"+a).on("input",function(){var a=this.id.replace("material-rate-",""),c=parseInt(this.value);rHelper.fn.SET_globalObject("material",a,"perHour",c);rHelper.fn.INSRT_materialRateWorth(a);
rHelper.fn.INSRT_totalMineWorth(rHelper.fn.CALC_totalMineWorth());rHelper.fn.CALC_dependantFactories(a,"material");rHelper.fn.INSRT_flowRate(a,"material");rHelper.fn.INSRT_flowDistributionGlobal()});$("#material-amount-of-mines-"+a).on("input",function(){var a=this.id.replace("material-amount-of-mines-",""),c=parseInt(this.value);rHelper.fn.SET_globalObject("material",a,"amountOfMines",c);$.each(rHelper.data.material,function(a){rHelper.fn.INSRT_materialNewMinePrice(a)});rHelper.fn.INSRT_materialMineAmortisation();
rHelper.fn.INSRT_totalMineCount(rHelper.fn.CALC_totalMineCount())})},INSRT_totalMineWorth:function(a){$("#material-total-worth").text(a.toLocaleString("en-US"))},INSRT_totalMineCount:function(a){$("#material-total-mine-count").text(a.toLocaleString("en-US"))},INSRT_materialRate:function(a){$("#material-rate-"+a).val(rHelper.data.material[a].perHour)},INSRT_materialAmountOfMines:function(a){$("#material-amount-of-mines-"+a).val(rHelper.data.material[a].amountOfMines)},INSRT_userSettings:function(){$("#security-token").text(rHelper.data.userInformation.securityToken);
""!=rHelper.data.userInformation.realKey&&"undefined"!=typeof rHelper.data.userInformation.realKey&&($("#api-key").val(rHelper.data.userInformation.realKey),rHelper.fn.INSRT_API_remainingCredits(rHelper.data.userInformation.remainingCredits));rHelper.data.settings.forEach(function(a){var b=0;switch(a.setting){case "lang":switch(a.value){case "de":b=0;break;case "en":b=1;break;case "fr":b=2;break;case "in":b=3;break;case "jp":b=4;break;case "ru":b=5}$("#settings-language").val(b);break;case "customTU":for(b=
0;3>=b;b+=1)$("#settings-custom-tu-"+(b+1)).val(a.value[b]);break;case "idealCondition":1===a.value&&$("#settings-ideal-conditions").prop("checked",!0);break;case "factoryNames":1===a.value&&$("#settings-toggle-factory-names").prop("checked",!0);break;case "transportCostInclusion":1===a.value&&$("#settings-toggle-transport-cost-inclusion").prop("checked",!0);break;case "theBigShort":$("#settings-thebigshort").val(a.value);break;case "mapVisibleHQ":1===a.value&&$("#settings-hq-visibility").val(1);
break;case "priceAge":$("#settings-price-age").val(a.value)}})},INSRT_materialNewMinePrice:function(a){$("#material-new-price-"+a).text(rHelper.fn.CALC_materialNewMinePrice(rHelper.fn.CALC_totalMineCount(),a).toLocaleString("en-US"))},INSRT_materialRateWorth:function(a){$("#material-worth-"+a).text(rHelper.fn.CALC_materialRateWorth(a).toLocaleString("en-US"))},INSRT_materialMineAmortisation:function(){var a=rHelper.fn.CALC_materialMineROI("100"),b=rHelper.fn.CALC_materialMineROI("505"),c=rHelper.fn.CALC_materialMineROI("505hq");
$.each(a,function(a,b){$("#material-roi-100-"+a).text(b.toFixed(2).toLocaleString("en-US"))});$.each(b,function(a,b){$("#material-roi-500-"+a).text(b.toFixed(2).toLocaleString("en-US"))});$.each(c,function(a,b){$("#material-roi-x-"+a).text(b.toFixed(2).toLocaleString("en-US"))});rHelper.fn.INSRT_materialHighlightColumns(a,"#material-roi-100-","text-success","text-danger");rHelper.fn.INSRT_materialHighlightColumns(b,"#material-roi-500-","text-success","text-danger");rHelper.fn.INSRT_materialHighlightColumns(c,
"#material-roi-x-","text-success","text-danger")},INSRT_materialNewMinePerfectIncome:function(a){$("#material-perfect-income-"+a).text(rHelper.fn.CALC_materialMinePerfectIncome(a).toLocaleString("en-US"))},INSRT_materialHighlightMinePerfectIncome:function(){var a=[];$.each(rHelper.data.material,function(b){a.push(rHelper.fn.CALC_materialMinePerfectIncome(b))});rHelper.fn.INSRT_materialHighlightColumns(a,"#material-perfect-income-","text-danger","text-success")},INSRT_materialHighlightColumns:function(a,
b,c,d){var e=0,g,f;$.each(["min","max"],function(h,k){switch(k){case "min":e=a.min();g=c;f=d;break;case "max":e=a.max(),g=d,f=c}$(b+a.indexOf(e)).removeClass(f).addClass(g)})},INSRT_factoryName:function(a){$("#factories-name-"+a).text(rHelper.data.products[a].factoryName)},INSRT_factoryLevel:function(a){var b=rHelper.data.products[a].factoryLevel;$("#factories-level-"+a).val(b);$("#diamond-level-"+a).text(b)},INSRT_factoryOutput:function(a){$("#factories-product-"+a).text(rHelper.fn.CALC_factoryOutput(a).toLocaleString("en-US"))},
INSRT_factoryUpgradeCost:function(a){var b=$("#factories-upgrade-cost-"+a);a=rHelper.fn.CALC_factoryUpgradeCost(a);b.text(a.sum.toLocaleString("en-US"));b.attr("title",a.title);applyTippyOnNewElement(b)},INSRT_totalFactoryUpgrades:function(){$("#factories-total-upgrades").text(rHelper.fn.CALC_totalFactoryUpgrades().toLocaleString("en-US"))},INSRT_factoryDependencies:function(a){var b=rHelper.data.products[a].dependencies,c="";if($.isArray(b))$.each(b,function(b,d){var e=rHelper.fn.CALC_convertId(d),
f=rHelper.fn.CALC_returnPriceViaId(d).toLocaleString("en-US"),g=rHelper.fn.CALC_factoryDependencyRequiredAmount(a,b),l=rHelper.fn.CALC_factoryDependencyExistingAmount(e,b),l=rHelper.fn.CALC_factoryComparatorRequiredVsExistingAmount(g,l),h=crEl("span"),k=crEl("span"),n=crEl("span");$(k).addClass(e.icon).attr("title",f.toLocaleString("en-US"));$(n).addClass(l).text(g.toLocaleString("en-US"));$(h).append(k.outerHTML+" "+n.outerHTML+" ");c+=h.outerHTML});else{var d=rHelper.fn.CALC_convertId(b),b=rHelper.fn.CALC_returnPriceViaId(b).toLocaleString("en-US"),
e=rHelper.fn.CALC_factoryDependencyRequiredAmount(a,0),g=rHelper.fn.CALC_factoryDependencyExistingAmount(d,0),g=rHelper.fn.CALC_factoryComparatorRequiredVsExistingAmount(e,g),f=crEl("span"),h=crEl("span"),k=crEl("span");$(h).addClass(d.icon).attr("title",b.toLocaleString("en-US"));$(k).addClass(g).text(e.toLocaleString("en-US"));$(f).append(h.outerHTML+" "+k.outerHTML+" ");c+=f.outerHTML}$("#factories-dependencies-"+a).html(c)},INSRT_factoryAmortisation:function(a){var b="#factories-roi-"+a;a=rHelper.fn.CALC_factoryAmortisation(a);
a=0>a||Infinity==a?"\u221e":a.toFixed(2);$(b).text(a)},INSRT_factoryWorkload:function(a){var b=$("#factories-workload-"+a),c=rHelper.data.products[a].dependencies;rHelper.data.products[a].dependencyWorkload=[];$.isArray(c)?$.each(c,function(b){b=rHelper.fn.CALC_factoryDepedencyWorkload(a,b);rHelper.data.products[a].dependencyWorkload.push(b)}):(c=rHelper.fn.CALC_factoryDepedencyWorkload(a,0),rHelper.data.products[a].dependencyWorkload.push(c));c=rHelper.fn.CALC_factoryWorkloadMinNonSanitized(a);1<=
c?b.removeClass("text-danger").addClass("text-success"):b.removeClass("text-success").addClass("text-danger");b.text((100*c).toFixed(2)+" %")},INSRT_factoryTurnover:function(a){var b=$("#factories-turnover-"+a),c=rHelper.fn.CALC_factoryTurnover(a);0>=c?b.removeClass("text-success").addClass("text-danger"):b.removeClass("text-danger").addClass("text-success");rHelper.data.products[a].turnover=c;$(b).text(c.toLocaleString("en-US"))},INSRT_factoryHighlightColumns:function(){var a;$.each(["#factories-upgrade-cost-",
"#factories-increase-per-upgrade-","#factories-roi-","#diamond-profit-"],function(b,c){switch(b){case 0:a="upgradeCost";break;case 1:a="turnoverIncrease";break;case 2:a="roi";break;case 3:a=[]}var d=[],e=[];$.each(rHelper.data.products,function(b,f){$(c+b).removeClass("text-success text-danger");var g;g="object"==typeof a?f.diamond.profit:f[a];0<rHelper.data.products[b].turnover&&-Infinity!=g&&Infinity!=g&&0<g&&(d.push(g),e.push(b))});var g=e[d.indexOf(d.min())],f=e[d.indexOf(d.max())];switch(b){case 0:case 2:$(c+
g).addClass("text-success");g!=f&&$(c+f).addClass("text-danger");break;case 1:case 3:$(c+f).addClass("text-success"),g!=f&&$(c+g).addClass("text-danger")}})},INSRT_factoryROI:function(a){var b=$("#factories-roi-"+a),c=rHelper.fn.CALC_factoryROI(a);rHelper.data.products[a].roi=c;c=0>c||Infinity===c?"\u221e":c.toFixed(2);b.text(c.toLocaleString("en-US"))},INSRT_factoryTurnoverPerUpgrade:function(a){var b=$("#factories-increase-per-upgrade-"+a),c=rHelper.fn.CALC_factoryTurnoverPerUpgrade(a);rHelper.data.products[a].turnoverIncrease=
c;b.text(c.toLocaleString("en-US"))},INSRT_API_remainingCredits:function(a){$("#api-credits").text(a.toLocaleString("en-US")+" Credits left")},INSRT_diamondFactoryOutput:function(a){$("#diamond-product-"+a).text(rHelper.fn.CALC_diamondFactoryOutput(a).toLocaleString("en-US"))},INSRT_diamondFactoryOutputWarehouse:function(a){var b=rHelper.fn.CALC_diamondFactoryOutput(a),b=rHelper.fn.CALC_nextGreaterWarehouseLevel(b);$("#diamond-product-warehouse-"+a).text(b.toLocaleString("en-US"))},INSRT_diamondDependencies:function(a){var b=
rHelper.data.products[a].dependencies,c="",d=crEl("span");$(d).addClass("nav-icon-warehouses");if($.isArray(b))$.each(b,function(b,e){var f=rHelper.fn.CALC_convertId(e),g=rHelper.fn.CALC_returnPriceViaId(e),l=120*rHelper.fn.CALC_factoryDependencyRequiredAmount(a,b),h=rHelper.fn.CALC_nextGreaterWarehouseLevel(l);rHelper.data.products[a].diamond.dependenciesWorth+=g*l;var k=crEl("span"),n=crEl("span"),t=crEl("span"),p=crEl("kbd"),q=crEl("span");$(n).addClass(f.icon).attr("title",g.toLocaleString("en-US"));
$(t).text(l.toLocaleString("en-US"));$(q).text(h);$(p).append(d.outerHTML+" "+q.outerHTML);$(k).append(n.outerHTML+" "+t.outerHTML+" "+p.outerHTML+" ");c+=k.outerHTML});else{var e=rHelper.fn.CALC_convertId(b),b=rHelper.fn.CALC_returnPriceViaId(b),g=120*rHelper.fn.CALC_factoryDependencyRequiredAmount(a,0),f=rHelper.fn.CALC_nextGreaterWarehouseLevel(g);rHelper.data.products[a].diamond.dependenciesWorth+=b*g;var h=crEl("span"),k=crEl("span"),l=crEl("span"),n=crEl("kbd"),q=crEl("span");$(k).addClass(e.icon).attr("title",
b.toLocaleString("en-US"));$(l).text(g.toLocaleString("en-US"));$(q).text(f);$(n).append(d.outerHTML+" "+q.outerHTML);$(h).append(k.outerHTML+" "+l.outerHTML+" "+n.outerHTML+" ");c+=h.outerHTML}$("#diamond-dependencies-"+a).html(c)},INSRT_diamondEfficiency:function(a){$("#diamond-efficiency-"+a).text((100*rHelper.fn.CALC_diamondEfficiency(a)).toFixed(2).toLocaleString("en-US")+"%")},INSRT_diamondProfit:function(a){$("#diamond-profit-"+a).text(rHelper.fn.CALC_diamondProfit(a).toLocaleString("en-US"))},
INSRT_diamondFactoryLevel:function(a){$("#diamond-level-"+a).text(rHelper.data.products[a].factoryLevel)},INSRT_diamondTop10Profit:function(){var a=rHelper.fn.CALC_diamondTop10Profit().toLocaleString("en-US");$("#diamond-top-10").text(a)},INSRT_diamondTotalProfit:function(){var a=rHelper.fn.CALC_diamondTotalProfit().toLocaleString("en-US");$("#diamond-total").text(a)},INSRT_flowRate:function(a,b){var c=$("#flow-"+b+"-rate-"+a),d=rHelper.fn.CALC_flowRate(a,b);c.text(d.toLocaleString("en-US"))},INSRT_flowDistributionGlobal:function(){var a=
0,b=0,c="yellowgreen",d="yellowgreen";$.each(rHelper.data.material,function(b){a+=rHelper.fn.INSRT_flowDistributionSingle(b,"material")});var e=rHelper.fn.GET_calculationOrder();$.each(e,function(a,c){b+=rHelper.fn.INSRT_flowDistributionSingle(c,"product")});0>a&&(c="coral");0>b&&(d="coral");rHelper.data.material.totalIncomePerHour=a;rHelper.data.products.totalIncomePerHour=b;$("#flow-material-total").text(a.toLocaleString("en-US")).css("color",c);$("#flow-products-total").text(b.toLocaleString("en-US")).css("color",
d);$("#effective-hourly-income").text((a+b).toLocaleString("en-US"))},INSRT_flowSurplus:function(a,b,c){var d=$("#flow-"+b+"-surplus-"+a);0>c&&d.css("color","coral");d.html('<span class="resources-'+b+"-"+(a+1)+'"></span> '+c.toLocaleString("en-US"))},INSRT_flowDistributionSingle:function(a,b){$("#flow-"+b+"-distribution-"+a);var c=$("#flow-"+b+"-worth-"+a),d=0,e=rHelper.fn.CALC_flowDistribution(a,b),g="yellowgreen";switch(b){case "material":d=rHelper.fn.CALC_returnPriceViaId(a);break;case "product":d=
rHelper.fn.CALC_returnPriceViaId(a+14)}"product"==b&&0>rHelper.data.products[a].turnover&&(e=0);d*=e;0>e&&(d*=rHelper.data.buildings[9].transportCost,g="coral");d=Math.round(d);switch(b){case "material":rHelper.data.material[a].effectiveTurnover=d;break;case "product":rHelper.data.products[a].effectiveTurnover=d}c.css("color",g);c.text(d.toLocaleString("en-US"));rHelper.fn.INSRT_flowSurplus(a,b,e);return d},CALC_flowDistribution:function(a,b){function c(a,b,c,d){var e,f,g=0,h="";"material"==a?(f=
b-14,b=rHelper.data.products[f],$.isArray(b.dependencies)?(e=b.dependencies.indexOf(c),e=b.requiredAmount[e]):e=b.requiredAmount):(f=b,b=rHelper.data.products[b],$.isArray(b.dependencies)?(e=b.dependencies.indexOf(c+14),e=b.requiredAmount[e]):e=b.requiredAmount);0<b.turnover&&(g=b.factoryLevel*e);h=h+('<span class="resources-'+a+"-"+(c+1)+'"></span> ')+(g.toLocaleString("en-US")+' <svg xmlns="http://www.w3.org/2000/svg" width="15" fill="#fff" viewBox="0 0 31.49 31.49"><path d="M21.205 5.007c-.429-.444-1.143-.444-1.587 0-.429.429-.429 1.143 0 1.571l8.047 8.047H1.111C.492 14.626 0 15.118 0 15.737c0 .619.492 1.127 1.111 1.127h26.554l-8.047 8.032c-.429.444-.429 1.159 0 1.587.444.444 1.159.444 1.587 0l9.952-9.952c.444-.429.444-1.143 0-1.571l-9.952-9.953z"/></svg> ');
h+='<span class="resources-product-'+(f+1)+'"></span> ';$("#flow-"+a+"-distribution-"+c+"-"+d).html(h);return g}var d=0,e={},g=0;switch(b){case "material":e=rHelper.data.material[a];d=e.perHour;break;case "product":var e=rHelper.data.products[a],d=e.factoryLevel,f=e.scaling,h=rHelper.fn.CALC_factoryMinWorkload(a),d=d*f*h}e=e.dependantFactories;$.isArray(e)?$.each(e,function(d,e){g+=c(b,e,a,d)}):""!=e&&(g+=c(b,e,a,0));return d-g},CALC_flowRate:function(a,b){var c=0;switch(b){case "material":c=rHelper.data.material[a].perHour;
break;case "product":var c=rHelper.data.products[a],d=rHelper.fn.CALC_factoryMinWorkload(a),c=c.factoryLevel*c.scaling*d}return c},CALC_factoryMinWorkload:function(a){a=rHelper.data.products[a].dependencyWorkload.min();1<a&&(a=1);return a},CALC_diamondTotalProfit:function(){var a=0;$.each(rHelper.data.products,function(b,c){var d=c.diamond.profit;0<d&&(a+=d)});return a},CALC_diamondTop10Profit:function(){var a=[];$.each(rHelper.data.products,function(b,c){var d=c.diamond.profit;0<d&&a.push(d)});for(var b=
0,a=a.sort(function(a,b){return b-a}),c=0;9>=c;c+=1)a[c]&&(b+=a[c]);return b},CALC_diamondEfficiency:function(a){a=rHelper.data.products[a].diamond;var b=a.outputWorth/(a.dependenciesWorth+a.productionCost);isNaN(b)&&(b=0);return a.efficiency=b},CALC_diamondProfit:function(a){a=rHelper.data.products[a].diamond;a.profit=a.outputWorth-(a.dependenciesWorth+a.productionCost);return a.profit},CALC_nextGreaterWarehouseLevel:function(a){return Math.ceil(Math.sqrt(a/5E3))},CALC_diamondFactoryOutput:function(a){var b=
rHelper.data.products[a],c=b.factoryLevel*b.scaling*120,d=120*b.cashPerHour;0==b.factoryLevel&&(d=0);rHelper.data.products[a].diamond={outputWorth:c*rHelper.fn.CALC_returnPriceViaId(a+14),dependenciesWorth:0,productionCost:d,efficiency:0,profit:0};return b.factoryLevel*b.scaling*120},CALC_dependantFactoriesHelper:function(a,b){"material"==b&&(a-=14);rHelper.fn.INSRT_factoryDependencies(a);rHelper.fn.INSRT_factoryWorkload(a);rHelper.fn.INSRT_factoryTurnover(a);rHelper.fn.INSRT_factoryTurnoverPerUpgrade(a);
rHelper.fn.INSRT_factoryROI(a);rHelper.fn.INSRT_factoryHighlightColumns();""!=rHelper.data.products[a].dependantFactories&&rHelper.fn.CALC_dependantFactories(a,"product")},CALC_dependantFactories:function(a,b){var c="";switch(b){case "material":c=rHelper.data.material[a].dependantFactories;break;case "product":c=rHelper.data.products[a].dependantFactories}$.isArray(c)?$.each(c,function(a,c){rHelper.fn.CALC_dependantFactoriesHelper(c,b)}):""!=c&&rHelper.fn.CALC_dependantFactoriesHelper(c,b)},CALC_factoryTurnoverPerUpgrade:function(a){var b=
0;rHelper.fn.CALC_factoryMinWorkload(a);var c=[],b=rHelper.data.products[a].dependencies;$.isArray(b)?$.each(b,function(b){b=rHelper.fn.CALC_factoryDepedencyWorkload(a,b,"nextLevel");c.push(b)}):(b=rHelper.fn.CALC_factoryDepedencyWorkload(a,0,"nextLevel"),c.push(b));b=c.min();1<b&&(b=1);b=parseInt(rHelper.fn.CALC_factoryTurnover(a,"nextLevel",b)-rHelper.data.products[a].turnover);10>b&&-10<b&&(b=0);return b},CALC_factoryDependencyExistingAmount:function(a,b){return a.perHour?a.perHour:a.factoryLevel*
a.scaling},CALC_factoryWorkloadMinNonSanitized:function(a){return rHelper.data.products[a].dependencyWorkload.min()},CALC_factoryCashCostPerHour:function(a,b){var c=rHelper.data.products[a],d=c.factoryLevel;b&&(d+=1);return c.cashPerHour*d},CALC_factoryTurnover:function(a,b,c){var d=rHelper.data.products[a],e=rHelper.fn.CALC_returnPriceViaId(a+14),g=d.factoryLevel,f=rHelper.fn.CALC_factoryCashCostPerHour(a,b),h=rHelper.fn.CALC_factoryMinWorkload(a),k=0;b&&(g+=1,h=c);c=d.scaling*g*e;$.isArray(d.dependencies)?
$.each(d.dependencies,function(c){c=rHelper.fn.CALC_factoryDependencyWorth(a,c,b);k+=c}):(d=rHelper.fn.CALC_factoryDependencyWorth(a,0,b),k+=d);return(c-k-f)*h},CALC_factoryDependencyWorth:function(a,b,c){var d=rHelper.data.products[a];a=d.factoryLevel;c&&(a+=1);$.isArray(d.dependencies)?(c=d.requiredAmount[b],b=rHelper.fn.CALC_returnPriceViaId(d.dependencies[b])):(c=d.requiredAmount,b=rHelper.fn.CALC_returnPriceViaId(d.dependencies));return a*c*b},CALC_factoryDepedencyWorkload:function(a,b,c){var d=
rHelper.data.products[a];a=d.factoryLevel;c&&(a+=1);$.isArray(d.dependencies)?(c=d.dependencies[b],b=d.requiredAmount[b]):(c=d.dependencies,b=d.requiredAmount);b*=a;13>=c?a=rHelper.data.material[c].perHour:(a=rHelper.fn.CALC_convertId(c),c=a.dependencyWorkload.min(),1<c&&(c=1),a=a.factoryLevel*a.scaling*c);b=a/b;if(isNaN(b)||Infinity===b)b=0;return b},CALC_factoryROI:function(a){return rHelper.data.products[a].upgradeCost/rHelper.data.products[a].turnoverIncrease/24},CALC_factoryComparatorRequiredVsExistingAmount:function(a,
b){isNaN(b)&&(b=0);return b<a?'class="faulty-dependency"':""},CALC_factoryDependencyRequiredAmount:function(a,b){var c=rHelper.data.products[a];return($.isArray(c.requiredAmount)?c.requiredAmount[b]:c.requiredAmount)*c.factoryLevel},CALC_totalFactoryUpgrades:function(){var a=0;$.each(rHelper.data.products,function(b,c){a+=c.factoryLevel});return a},CALC_factoryUpgradeCost:function(a){var b=rHelper.data.products[a].factoryLevel;"undefined"!=typeof b&&b||(b=0);var c=b+1,d=0,e=0,b=crEl("table"),g=crEl("tbody"),
f,h;$.each(rHelper.data.products[a].upgradeMaterialAmount,function(b,k){var l=crEl("tr"),p;if(0===b)for(d+=k*Math.pow(c,2),p=0;2>=p;p+=1){f=crEl("td");switch(p){case 0:var m=crEl("img");$(m).attr("src","assets/img/cash.png").attr("alt","Cash");$(f).append(m);break;case 1:$(f).addClass("text-right").attr("colspan",3).text(d.toLocaleString("en-US"));break;case 2:h=crEl("small"),$(h).text("Transportation"),$(f).addClass("text-right").append(h)}l.append(f)}else{var m=rHelper.data.products[a].upgradeMaterial[b],
n=k*Math.pow(c,2),q=rHelper.fn.CALC_returnPriceViaId(m)*n,u=(rHelper.data.buildings[9].transportCost-1)*q,r;d+=q;e+=u;m+=1;13>=m?r="material":14<=m&&35>=m?(m-=14,r="products"):36<=m&&51>=m?(m-=36,r="loot"):(m-=51,r="units");for(p=0;4>=p;p+=1){f=crEl("td");switch(p){case 0:$(f).addClass("resources-"+r+"-"+m);break;case 1:$(f).addClass("text-right").text(n.toLocaleString("en-US"));break;case 2:$(f).text("\u2259");break;case 3:$(f).addClass("text-right").text(q.toLocaleString("en-US"));break;case 4:h=
crEl("small"),$(h).addClass("text-warning").text("+"+u.toLocaleString("en-US")),$(f).addClass("text-right").append(h)}$(l).append(f)}}$(g).append(l)});for(var k=crEl("tr"),l=0;1>=l;l+=1)f=crEl("td"),$(f).addClass("text-right"),0===l?$(f).attr("colspan",4).text(d.toLocaleString("en-US")):(h=crEl("small"),$(h).addClass("text-warning").text("+"+e.toLocaleString("en-US")),$(f).append(h)),$(k).append(f);$(g).append(k);$(b).append(g);rHelper.data.products[a].upgradeCost=d;return{sum:d,title:b.outerHTML}},
CALC_factoryOutput:function(a){a=rHelper.data.products[a];return a.factoryLevel*a.scaling},CALC_totalMineCount:function(){var a=0;$.each(rHelper.data.material,function(b,c){a+=c.amountOfMines});return a},CALC_totalMineWorth:function(){var a=0;$.each(rHelper.data.material,function(b,c){a+=rHelper.fn.CALC_materialRateWorth(b)});return a},CALC_returnPriceViaId:function(a){var b="current 1day 3days 7days 4weeks 3months 6months 1year max".split(" ")[rHelper.data.settings[7].value];a=rHelper.fn.CALC_convertId(a).prices[b];
return a.ai>=a.player?a.ai:a.player},CALC_convertId:function(a){return 13>=a?rHelper.data.material[a]:14<=a&&35>=a?rHelper.data.products[a-14]:36<=a&&51>=a?rHelper.data.loot[a-36]:rHelper.data.units[a-51]},CALC_materialNewMinePrice:function(a,b){return Math.round(rHelper.data.material[b].basePrice*(1+a/50))},CALC_materialRateWorth:function(a){return rHelper.data.material[a].perHour*rHelper.fn.CALC_returnPriceViaId(a)},CALC_materialMinePerfectIncome:function(a){return rHelper.data.material[a].maxRate*
rHelper.fn.CALC_returnPriceViaId(a)},CALC_materialMineROI:function(a){for(var b=[],c=0;13>=c;c+=1){var d=rHelper.fn.CALC_materialNewMinePrice(rHelper.fn.CALC_totalMineCount(),c),e=rHelper.fn.CALC_materialMinePerfectIncome(c),g=rHelper.fn.CALC_customTUPrice();switch(a){case "100":b.push(d/e/24);break;case "505":b.push((d+g)/e/24/5.05);break;case "505hq":var f=1;rHelper.data.headquarter.user&&(f=rHelper.data.headquarter.user.level);b.push((d+g)/e/24/5.05/(rHelper.data.headquarter[f-1].boost-.9))}}return b},
CALC_customTUPrice:function(){for(var a=0,b=0;3>=b;b+=1)a+=rHelper.data.settings[1].value[b]*rHelper.fn.CALC_returnPriceViaId(46+b);return a}},data:{}};
(function(){$("#loading-text").text("fetching data");"undefined"!=typeof localStorage.rGame&&1!=getCookie("loggedIn")?(rHelper.data=JSON.parse(localStorage.getItem("rGame")),loadingAnimToggler("hide"),console.log("Found existing data!"),rHelper.init.core()):$.get({url:"api/core.php",success:function(a){rHelper.data=a;localStorage.setItem("rGame",JSON.stringify(a));loadingAnimToggler("hide");switch(parseInt(getCookie("loggedIn"))){case 1:console.log("Returning user - fetched existing data!");break;
default:console.log("New user - fetched basic data!")}rHelper.init.user()},error:function(a){swal("Error fetching data","Error message:<br />"+a+"<br /> Please try again.","error")}})})();
