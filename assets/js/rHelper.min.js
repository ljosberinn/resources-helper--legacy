"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},rHelper={init:{user:function user(){rHelper.methods.INSRT_userSettings(),rHelper.init.core()},core:function core(){removeLoggedInButtons(),rHelper.methods.SET_tabSwitcherAnchorBased(),rHelper.methods.SET_transportCost("init"),$.each(rHelper.data.material,function(materialId){rHelper.methods.EVNT_materialInput(materialId),rHelper.methods.INSRT_materialData(materialId),rHelper.methods.INSRT_warehouseData(materialId,"material"),rHelper.methods.INSRT_priceHistoryName("material",materialId)}),rHelper.methods.INSRT_totalMineWorth(rHelper.methods.CALC_totalMineWorth()),rHelper.methods.INSRT_totalMineCount(rHelper.methods.CALC_totalMineCount());var calculationOrder=rHelper.methods.GET_calculationOrder();$.each(calculationOrder,function(index,factoryId){rHelper.methods.EVNT_factoryInput(factoryId),rHelper.methods.INSRT_factoryDiamondData(factoryId,"product"),rHelper.methods.INSRT_warehouseData(factoryId,"products"),rHelper.methods.INSRT_priceHistoryName("products",factoryId)}),$.each(rHelper.data.loot,function(index){rHelper.methods.INSRT_warehouseData(index,"loot"),rHelper.methods.INSRT_priceHistoryName("loot",index),4==index||index>=10&&index<=13||(rHelper.methods.SET_recyclingProfitObj(index),rHelper.methods.INSRT_recycling(index))});var unitsFns=["SET_UnitProfitObj","INSRT_unitsCraftingPrice","INSRT_unitsMarketPrice","INSRT_unitsPricePerStrength"];$.each(rHelper.data.units,function(index){rHelper.methods.INSRT_warehouseData(index,"units"),$.each(unitsFns,function(i,fn){rHelper.methods[fn](index)}),rHelper.methods.INSRT_unitsRecyclingProfit("units",index),rHelper.methods.INSRT_priceHistoryName("units",index)});var buildingFns=["INSRT_buildingName","SET_buildingBackgroundColor","INSRT_buildingData","INSRT_buildingToLevel10","EVNT_buildingChange"];$.each(rHelper.data.buildings,function(buildingId){$.each(buildingFns,function(i,fn){rHelper.methods[fn](buildingId)})});var hqFns=["INSRT_headquarterOvwString","INSRT_headquarterOvwRadius","INSRT_headquarterOvwCost","INSRT_headquarterOvwBoost","INSRT_headquarterOvwTransportation","EVNT_switchHeadquarter"];$.each(rHelper.data.headquarter,function(headquarterLevel){$.each(hqFns,function(i,fn){rHelper.methods[fn](headquarterLevel)})});var pieGraphs=["material"];$.each(pieGraphs,function(i,val){rHelper.methods.EVNT_buildGraph(val)});var gaugeGraphs=["buildings","headquarter"];$.each(gaugeGraphs,function(i,val){rHelper.methods.INSRT_gaugeGraph(val)});var nonParamBoundMethods=["INSRT_materialMineAmortisation","INSRT_materialHighlightMinePerfectIncome","INSRT_totalFactoryUpgrades","INSRT_factoryHighlightColumns","INSRT_diamondTop10Profit","INSRT_diamondTotalProfit","INSRT_flowDistributionGlobal","INSRT_warehouseTotalLevel","INSRT_warehouseTotalWorth","EVNT_priceHistoryOnChange","SET_hqLevel","EVNT_headquarterInput","INSRT_missions","EVNT_attackLogTrigger","INSRT_companyWorth","EVNT_sortableTables","EVNT_assignTitleToIcons","EVNT_enableTippy"];$.each(nonParamBoundMethods,function(i,fn){rHelper.methods[fn]()})}},methods:{GET_calculationOrder:function GET_calculationOrder(){return[0,1,2,3,4,7,8,9,10,15,17,18,5,6,13,19,11,12,14,16,20,21]},API_toggleLoadSuccessorHelper:function API_toggleLoadSuccessorHelper(target){var fns=["API_toggleLoader","API_toggleSuccessor","API_toggleSuccessorHelper"];$.each(fns,function(i,fn){rHelper.methods[fn](target)})},API_toggleLoader:function API_toggleLoader(selector){var el=$("#api-"+selector+"-loading");"none"==el.css("display")?el.fadeIn("fast").css("display","flex"):el.fadeOut("fast")},API_toggleSuccessor:function API_toggleSuccessor(selector){var el=$("#api-"+selector+"-finished");"none"==el.css("display")?el.fadeIn("fast"):el.fadeOut("fast")},API_toggleSuccessorHelper:function API_toggleSuccessorHelper(selector){setTimeout(function(){rHelper.methods.API_toggleSuccessor(selector)},15e3)},API_getFactories:function API_getFactories(key){rHelper.methods.API_toggleLoader("factories"),$.get("api/core.php?query=1&key="+key,function(data){$.each(data,function(i,value){rHelper.data.products[i].factoryLevel=value});var calculationOrder=rHelper.methods.GET_calculationOrder();$.each(calculationOrder,function(index,factoryId){rHelper.methods.INSRT_factoryDiamondData(factoryId,"product")}),rHelper.methods.INSRT_totalFactoryUpgrades(),rHelper.methods.INSRT_factoryHighlightColumns(),rHelper.methods.INSRT_diamondTop10Profit(),rHelper.methods.INSRT_diamondTotalProfit(),rHelper.methods.INSRT_flowDistributionGlobal(),rHelper.methods.API_toggleLoadSuccessorHelper("factories"),sorttable.innerSortFunction.apply($("#module-diamond th")[4],[]),sorttable.innerSortFunction.apply($("#module-diamond th")[5],[]),rHelper.methods.SET_save()})},API_getWarehouse:function API_getWarehouse(key){rHelper.methods.API_toggleLoader("warehouse"),$.getJSON("api/core.php?query=2&key="+key,function(data){$.each(data,function(i,warehouseInfo){var iterator=i,targetObj="material";i>=14&&i<36?(iterator-=14,targetObj="products"):i>=36&&i<52?(iterator-=36,targetObj="loot"):i>=52&&(iterator-=52,targetObj="units");var contingent=5e3*Math.pow(warehouseInfo.level,2),fillStatus=warehouseInfo.amount/contingent;isNaN(fillStatus)&&(fillStatus=0),rHelper.data[targetObj][iterator].warehouse.level=warehouseInfo.level,rHelper.data[targetObj][iterator].warehouse.fillAmount=warehouseInfo.amount,rHelper.data[targetObj][iterator].warehouse.contingent=contingent,rHelper.data[targetObj][iterator].warehouse.fillStatus=fillStatus,rHelper.methods.SET_save()}),$.each(rHelper.data.material,function(materialId){rHelper.methods.INSRT_warehouseData(materialId,"material")});var calculationOrder=rHelper.methods.GET_calculationOrder();$.each(calculationOrder,function(index){rHelper.methods.INSRT_warehouseData(index,"products")}),$.each(rHelper.data.loot,function(index){rHelper.methods.INSRT_warehouseData(index,"loot")}),$.each(rHelper.data.units,function(index){rHelper.methods.INSRT_warehouseData(index,"units")}),rHelper.methods.INSRT_warehouseTotalLevel(),rHelper.methods.INSRT_warehouseTotalWorth(),rHelper.methods.API_toggleLoadSuccessorHelper("warehouse")})},API_getMineSummary:function API_getMineSummary(key){rHelper.methods.API_toggleLoader("mines-summary"),$.get("api/core.php?query=51&key="+key,function(data){$.each(data,function(i,obj){rHelper.data.material[i].perHour=obj.perHour,rHelper.data.material[i].amountOfMines=obj.amountOfMines}),$.each(rHelper.data.material,function(materialId){rHelper.methods.INSRT_materialData(materialId,"api")});var fns=["INSRT_materialMineAmortisation","INSRT_materialHighlightMinePerfectIncome","INSRT_flowDistributionGlobal"];$.each(fns,function(i,fn){rHelper.methods[fn]()}),rHelper.methods.INSRT_totalMineWorth(rHelper.methods.CALC_totalMineWorth()),rHelper.methods.INSRT_totalMineCount(rHelper.methods.CALC_totalMineCount()),rHelper.methods.EVNT_buildGraph("material"),rHelper.methods.API_toggleLoadSuccessorHelper("mines-summary"),rHelper.methods.SET_save()})},API_getMineMap:function API_getMineMap(){$.getJSON("api/core.php?mineMap",function(data){rHelper.data.mineMap=data,rHelper.methods.API_toggleLoadSuccessorHelper("mines-detailed"),rHelper.methods.EVNT_mapCreation("personal"),rHelper.methods.SET_overTimeGraph()})},API_getMineMapInitiator:function API_getMineMapInitiator(key){rHelper.methods.API_toggleLoader("mines-detailed"),$.getJSON("api/core.php?query=5&key="+key,function(data){"rHelper.methods.API_getMineMap()"==data.callback?rHelper.methods.API_getMineMap():swal("Error","Couldn't fetch mine details - API potentially unavailable!","error")})},API_getPlayerInfo:function API_getPlayerInfo(key,anonymity){rHelper.methods.API_toggleLoader("player");var url="api/core.php?query=7&key="+key;anonymity&&(url+="&anonymity=true"),$.getJSON(url,function(data){rHelper.data.userInformation.level=data.lvl,rHelper.data.userInformation.points=data.points,rHelper.data.userInformation.rank=data.worldrank,data.name&&(rHelper.data.userInformation.name=data.name),rHelper.data.userInformation.registeredGame=rHelper.methods.CALC_convertDateToIso(data.registerdate),rHelper.methods.API_toggleLoadSuccessorHelper("player")})},API_getAttackLog:function API_getAttackLog(type,target,skipCount){void 0===type&&(type="attackSimple");var url="api/core.php?attackLog&type="+type;target&&(url+="&target="+target),skipCount&&(url+="&skip="+skipCount),$.getJSON(url,function(data){rHelper.data.attackLog=data,rHelper.methods.API_toggleLoadSuccessorHelper("attack-log"),rHelper.methods.INSRT_attackLog(type)})},API_getAttackLogInitiator:function API_getAttackLogInitiator(key){rHelper.methods.API_toggleLoader("attack-log"),$.getJSON("api/core.php?query=9&key="+key,function(data){'rHelper.methods.API_getAttackLog("attackSimple")'!=data.callback?swal("Error","Couldn't fetch attack log - API potentially unavailable!","error"):rHelper.methods.API_toggleLoadSuccessorHelper("attack-log")})},API_getTradeLog:function API_getTradeLog(skipCount,filter,dateFilter){var url="api/core.php?tradeLog";skipCount&&(url+="&skipCount="+skipCount),filter&&(url+="&filter="+filter),dateFilter&&(url+="&day="+dateFilter);var buttons=[$("#tradelog-next"),$("#tradelog-previous")];$.each(buttons,function(i,btn){btn.attr("disabled",!0)}),$.getJSON(url,function(data){rHelper.data.tradeLog=data,rHelper.methods.API_toggleLoadSuccessorHelper("trade-log"),rHelper.methods.INSRT_tradeLog(),$.each(buttons,function(i,btn){btn.attr("disabled",!1)})})},API_getTradeLogInitiator:function API_getTradeLogInitiator(key){rHelper.methods.API_toggleLoader("trade-log"),$.getJSON("api/core.php?query=6&key="+key,function(data){"rHelper.methods.API_getTradeLog()"==data.callback?rHelper.methods.API_getTradeLog():swal("Error","Couldn't fetch trade log - API potentially unavailable!","error")})},API_getMissions:function API_getMissions(){$.getJSON("api/core.php?missions",function(data){rHelper.data.missions=data,rHelper.methods.API_toggleLoadSuccessorHelper("missions"),rHelper.methods.INSRT_missions()})},API_getMissionsInitiator:function API_getMissionsInitiator(key){rHelper.methods.API_toggleLoader("missions"),$.getJSON("api/core.php?query=10&key="+key,function(data){"rHelper.methods.API_getMissions()"==data.callback&&rHelper.methods.API_getMissions()})},API_getBuildings:function API_getBuildings(key){rHelper.methods.API_toggleLoader("buildings"),$.getJSON("api/core.php?query=3&key="+key,function(data){var fns=["INSRT_buildingName","SET_buildingBackgroundColor","INSRT_buildingData","INSRT_buildingToLevel10"];$.each(data,function(i,buildingLevel){rHelper.data.buildings[i].level=buildingLevel,$.each(fns,function(k,fn){rHelper.methods[fn](i)})}),rHelper.methods.INSRT_gaugeGraph("buildings"),rHelper.methods.API_toggleLoadSuccessorHelper("buildings"),rHelper.methods.SET_save()})},API_getHeadquarter:function API_getHeadquarter(key){rHelper.methods.API_toggleLoader("headquarter"),$.getJSON("api/core.php?query=4&key="+key,function(data){rHelper.data.headquarter.user=rHelper.data.headquarter.user||{hqPosition:{lon:0,lat:0},level:0,paid:[0,0,0,0]},rHelper.data.headquarter.user.hqPosition.lat=data.lat,rHelper.data.headquarter.user.hqPosition.lon=data.lon,rHelper.data.headquarter.user.level=data.level,$.each(data.paid,function(i,paid){rHelper.data.headquarter.user.paid[i]=paid}),rHelper.methods.INSRT_gaugeGraph("headquarter"),rHelper.methods.SET_hqLevel(),rHelper.methods.API_toggleLoadSuccessorHelper("headquarter"),rHelper.methods.SET_save()})},API_getCreditInformation:function API_getCreditInformation(key){$("#api-credits").html('<span id="api-credits-loading" class="circles-to-rhombuses-spinner"><span class="rhombuses-circle"></span><span class="rhombuses-circle"></span><span class="rhombuses-circle"></span></span>'),$("#api-credits-loading").css("display","flex"),$.get("api/core.php?query=0&key="+key,function(data){var remainingCredits=parseInt(data[0].creditsleft);rHelper.data.userInformation.remainingCredits=remainingCredits,rHelper.methods.INSRT_API_remainingCredits(remainingCredits),$("#api-submit").attr("disabled",!1),$("#api-credits-loading").css("display","none")})},API_init:function API_init(key,queries,anonymity){$.isArray(queries)&&$.each(queries,function(i,query){switch(query){case 1:rHelper.methods.API_getFactories(key);break;case 2:rHelper.methods.API_getWarehouse(key);break;case 3:rHelper.methods.API_getBuildings(key);break;case 4:rHelper.methods.API_getHeadquarter(key);break;case 5:rHelper.methods.API_getMineMapInitiator(key);break;case 51:rHelper.methods.API_getMineSummary(key);break;case 6:rHelper.methods.API_getTradeLogInitiator(key);break;case 7:rHelper.methods.API_getPlayerInfo(key,anonymity);break;case 9:rHelper.methods.API_getAttackLogInitiator(key);break;case 10:rHelper.methods.API_getMissionsInitiator(key);break;default:rHelper.methods.API_getCreditInformation(key)}})},API_getWorldMap:function API_getWorldMap(type){$.getJSON("api/core.php?worldMap="+type,function(data){rHelper.data.worldMap=rHelper.data.worldMap||{},rHelper.data.worldMap=data,rHelper.methods.EVNT_mapCreation("world")})},SET_globalObject:function SET_globalObject(selector,index,key,value){$.isArray(key)?rHelper.data[selector][index][key[0]][key[1]]=value:rHelper.data[selector][index][key]=value,rHelper.methods.SET_save()},SET_save:function SET_save(){var loggedInCookie=parseInt(getCookie("loggedIn")),hasAPIKeyAttached=_typeof(rHelper.data.userInformation.realKey);1==loggedInCookie&&"undefined"==hasAPIKeyAttached&&(localStorage.setItem("rGame",JSON.stringify(rHelper.data)),swal("Data has been saved remotely!","<not implemented yet>","error"))},SET_tabSwitcherAnchorBased:function SET_tabSwitcherAnchorBased(){var anchor="#"+window.location.hash.substr(1);"#"==anchor&&(anchor=1!=getCookie("loggedIn")?"#registrationlogin":"#factories"),"#leaderboard"==anchor&&rHelper.methods.INSRT_leaderboard(),"#tradelog"==anchor&&rHelper.methods.API_getTradeLog(),"#techupgrades"==anchor&&rHelper.methods.INSRT_techUpgradeRows(),$(".nav-link").each(function(i,navLink){var navEl=$(navLink),target=$("#"+navLink.dataset.target);navEl.attr("href")==anchor?(target.css("display","block"),navEl.addClass("active")):(target.css("display","none"),navEl.removeClass("active"))})},SET_transportCost:function SET_transportCost(init){if(rHelper.data.buildings[9].transportCost=1+(15-rHelper.data.buildings[9].level)/100,!init){$.each(rHelper.data.buildings,function(buildingId){var fns=["SET_buildingBackgroundColor","INSRT_buildingData","INSRT_buildingToLevel10"];$.each(fns,function(i,fn){rHelper.methods[fn](buildingId)})});var calculationOrder=rHelper.methods.GET_calculationOrder();$.each(calculationOrder,function(index,factoryId){var fns=["INSRT_factoryUpgradeCost","INSRT_factoryROI"];$.each(fns,function(i,fn){rHelper.methods[fn](factoryId)}),rHelper.methods.INSRT_flowDistributionGlobal()}),$.each(rHelper.data.headquarter,function(headquarterLevel){rHelper.methods.INSRT_headquarterOvwTransportation(headquarterLevel)})}},SET_buildingBackgroundColor:function SET_buildingBackgroundColor(buildingId){var buildingLevel=rHelper.data.buildings[buildingId].level,r=255-10*buildingLevel,g=127+7*buildingLevel,b=80-3*buildingLevel;$("#building-"+buildingId).css("background-color","rgba("+r+","+g+","+b+", 0.25)")},SET_buildingTableVisibility:function SET_buildingTableVisibility(buildingId,state){var _ref=[$("#building-"+buildingId+" tbody"),$("#building-"+buildingId+" tfoot")],tbody=_ref[0],tfoot=_ref[1];$.each([tbody,tfoot],function(i,el){switch(state){case"show":"none"==el.css("display")&&el.css("display","table-row-group");break;case"hide":"none"!=el.css("display")&&el.css("display","none")}})},SET_recyclingProfitObj:function SET_recyclingProfitObj(lootId){rHelper.data.loot[lootId].profit={outputWorth:0,inputWorth:0,profit:0}},SET_recyclingPlantLevel:function SET_recyclingPlantLevel(){$.each(rHelper.data.loot,function(lootId){if(!(4==lootId||lootId>=10&&lootId<=13)){var fns=["INSRT_recyclingProducts","INSRT_recyclingOutputWorth","INSRT_recyclingInputWorth"];$.each(fns,function(i,fn){rHelper.methods[fn](lootId)}),rHelper.methods.INSRT_unitsRecyclingProfit("recycling",lootId)}})},SET_UnitProfitObj:function SET_UnitProfitObj(unitId){rHelper.data.units[unitId].profit={craftingPrice:0,marketPrice:0,profit:0}},SET_hqLevel:function SET_hqLevel(){var headquarter=rHelper.data.headquarter;if(headquarter.user){var userHqLevel=headquarter.user.level;rHelper.methods.SET_hqSelectorClass(userHqLevel-1),rHelper.methods.INSRT_headquarterPaid();var fns=["INSRT_headquarterContentRequiredAmount","INSRT_headquarterMissing","INSRT_headquarterRemainingCost"];$.each(fns,function(i,fn){rHelper.methods[fn](userHqLevel)})}},SET_hqSelectorClass:function SET_hqSelectorClass(userHqLevel){for(var i=0;i<=9;i+=1)userHqLevel!=i?$(".hq-thumb-"+i).addClass("disabled-hq"):$(".hq-thumb-"+i).removeClass("disabled-hq")},SET_newMap:function SET_newMap(container,zoom,type){return new google.maps.Map(container[0],{zoom:zoom,mapTypeId:type})},SET_mapOptions:function SET_mapOptions(map,maxZoom,primaryMine){return map.setOptions({maxZoom:maxZoom,center:new google.maps.LatLng(primaryMine.lat,primaryMine.lon)}),map},SET_mapImg:function SET_mapImg(folder,icon,size){return{url:"assets/img/maps/"+folder+"/"+icon+".png",scaledSize:new google.maps.Size(size,size)}},SET_mapInfoWindow:function SET_mapInfoWindow(contentString){return new google.maps.InfoWindow({content:contentString})},SET_mapFolderRelation:function SET_mapFolderRelation(relation){var folder="foe";return"friend"==relation&&(folder="friend"),folder},SET_mapHQHandler:function SET_mapHQHandler(map,hqObj){var hqLevel=hqObj.level,_ref2=[12.5*hqLevel,rHelper.data.headquarter[hqLevel-1].radius,{lat:hqObj.lat,lng:hqObj.lon}],hqSize=_ref2[0],radius=_ref2[1],center=_ref2[2];rHelper.methods.SET_mapHqCircle(map,center,radius,hqObj.relation),new google.maps.Marker({map:map,position:center,icon:rHelper.methods.SET_mapImg("hq",hqLevel,hqSize)})},SET_mapHqCircle:function SET_mapHqCircle(map,hqCenter,radius,relation){var color="#FF0000";return"friend"==relation&&(color="#00FF00"),new google.maps.Circle({strokeColor:color,strokeOpacity:.8,strokeWeight:2,fillColor:color,fillOpacity:.35,map:map,center:hqCenter,radius:radius,draggable:!0})},SET_mapMineHandler:function SET_mapMineHandler(now,subObj,map,mapType){var type=subObj.type,relObj=rHelper.data.material[type],buildMilliseconds=rHelper.methods.CALC_toMilliseconds(subObj.builddate),buildDate=rHelper.methods.CALC_convertDateToIso(buildMilliseconds),age=(now-buildMilliseconds)/1e3/86400,estRevenue=rHelper.methods.CALC_mineEstRevenue(subObj,type,age),contentString=rHelper.methods.CALC_createMapContentString(relObj,buildDate,age,estRevenue,subObj),infoWindow=rHelper.methods.SET_mapInfoWindow(contentString),marker=new google.maps.Marker({map:map,position:{lat:subObj.lat,lng:subObj.lon},icon:rHelper.methods.SET_mapImg(rHelper.methods.SET_mapFolderRelation(subObj.relation),type,20)});return"personal"==mapType&&subObj.builddate==rHelper.data.mineMap.mines[0].builddate&&marker.setAnimation(google.maps.Animation.BOUNCE),google.maps.event.addListener(marker,"click",function(){openedWindow&&openedWindow.close(),openedWindow=infoWindow,infoWindow.open(map,marker)}),marker},SET_overTimeGraph:function SET_overTimeGraph(){for(var data=rHelper.data.mineMap.mines,timestamps=[],mineCount=[],avgMinePrice=[],income=[],hours=[],hour=0;hour<=23;hour+=1)hours.push([hour+" to "+(hour+1),0]);$.each(data,function(index,subObj){var buildHour=new Date(rHelper.methods.CALC_toMilliseconds(subObj.builddate)).getHours();hours[buildHour][1]+=1}),Highcharts.chart("graph-buildinghabits",{chart:{type:"column",backgroundColor:"transparent"},title:{text:"Building habits per hour",style:{color:"#dedede"}},xAxis:{type:"category",labels:{rotation:-45,style:{fontSize:"13px",fontFamily:"Verdana, sans-serif",color:"#dedede"}}},yAxis:{min:0,title:{text:"Amount of mines",style:{color:"#dedede"}},labels:{style:{color:"#dedede"}}},legend:{enabled:!1},tooltip:{pointFormat:"Mines built at this hour: <b>{point.y}</b>"},series:[{name:"Mines",data:hours,dataLabels:{enabled:!0,rotation:-90,color:"#dedede",align:"right",y:10,style:{fontSize:"13px",fontFamily:"Verdana, sans-serif",color:"#dedede"}}}],exporting:{chartOptions:{chart:{backgroundColor:"#5f473e"}}}});var firstMine=data[0].builddate,lastMine,daysSinceFirstMine=(data[data.length-1].builddate-firstMine)/86400;timestamps.push(rHelper.methods.CALC_toMilliseconds(firstMine));for(var i=0;i<=daysSinceFirstMine;i+=1){var date=rHelper.methods.CALC_toMilliseconds(firstMine+86400*i);timestamps.push(date)}$.each(timestamps,function(i,ts){var mineCountAtGivenTS=0,sum=0,totalIncomeAtGivenTS=0;$.each(data,function(index,subObj){var builddate;rHelper.methods.CALC_toMilliseconds(subObj.builddate)<=ts&&(mineCountAtGivenTS+=1,totalIncomeAtGivenTS+=rHelper.methods.CALC_returnPriceViaId(subObj.type)*subObj.fullRate)}),$.each(rHelper.data.material,function(k){sum+=rHelper.methods.CALC_materialNewMinePrice(mineCountAtGivenTS,k)}),income.push(Math.round(totalIncomeAtGivenTS)),mineCount.push(mineCountAtGivenTS),avgMinePrice.push(Math.round(sum/14)),timestamps[i]=rHelper.methods.CALC_convertDateToIso(ts)}),Highcharts.chart("graph-overtime",{chart:{type:"spline",zoomType:"x",backgroundColor:"transparent"},title:{useHTML:!0,text:"Progress graph",style:{color:"#dedede"}},xAxis:{categories:timestamps,labels:{style:{color:"#dedede"}}},yAxis:{title:{text:"Price or mine count over time",style:{color:"#dedede"}},labels:{formatter:function formatter(){return this.value.toLocaleString("en-US")},style:{color:"#dedede"}}},legend:{enabled:!0,backgroundColor:"#dedede"},tooltip:{crosshairs:!0,shared:!0},plotOptions:{spline:{marker:{radius:4,lineColor:"#666666",lineWidth:1}}},series:[{name:"Mine count",marker:{symbol:"square"},data:mineCount,color:"orange"},{name:"Average cost of a new mine",marker:{symbol:"diamond"},data:avgMinePrice,color:"coral"},{name:"Average income at given time",marker:{symbol:"triangle"},data:income,color:"yellowgreen"}],exporting:{chartOptions:{chart:{backgroundColor:"#5f473e"}}}})},EVNT_enableTippy:function EVNT_enableTippy(){$.each($("[title]"),function(i,el){el._tippy||tippy(el,{dynamicTitle:!0}),$(el).addClass("tippied")})},EVNT_assignTitleToIconsHelper:function EVNT_assignTitleToIconsHelper(min,max,subSelector,incrementor){for(var _loop=function _loop(i){$.each($(".resources-"+subSelector+"-"+i),function(k,el){if(!$(el).attr("title")){var convertedId=i+incrementor;$(el).attr("title",rHelper.methods.CALC_returnPriceViaId(convertedId).toLocaleString("en-US"))}})},i=min;i<=max;i+=1)_loop(i)},EVNT_assignTitleToIcons:function EVNT_assignTitleToIcons(){var maxIndices=[13,21,16,5],subObjs=["material","product","loot","unit"],length=[0,14,36,52];$.each(maxIndices,function(i,val){rHelper.methods.EVNT_assignTitleToIconsHelper(0,val,subObjs[i],length[i])})},EVNT_sortableTables:function EVNT_sortableTables(){var tables=[$("#module-mines table")[0],$("#module-factories table")[0],$("#module-diamond table")[0],$("#techupgrades-combinations-tbl")[0],$("#recycling-tbl")[0],$("#units-tbl")[0]];$.each(tables,function(index,table){sorttable.makeSortable(table),2==index?sorttable.innerSortFunction.apply($("#module-diamond th")[5],[]):4==index&&(sorttable.innerSortFunction.apply($("#techupgrades-combinations-tbl th")[5],[]),sorttable.innerSortFunction.apply($("#techupgrades-combinations-tbl th")[5],[]))})},EVNT_factoryInput:function EVNT_factoryInput(factoryId){$("#factories-level-"+factoryId).on("input",function(){var factoryId=parseInt(this.id.replace("factories-level-","")),factoryLevel=parseInt(this.value);rHelper.methods.SET_globalObject("products",factoryId,"factoryLevel",factoryLevel);var fns=["INSRT_factoryOutput","INSRT_factoryUpgradeCost","INSRT_factoryDependencies","INSRT_factoryWorkload","INSRT_factoryTurnover","INSRT_factoryTurnoverPerUpgrade","INSRT_factoryROI","INSRT_diamondFactoryLevel","INSRT_diamondFactoryOutput","INSRT_diamondFactoryOutputWarehouse","INSRT_diamondDependencies","INSRT_diamondEfficiency","INSRT_diamondProfit"];$.each(fns,function(i,fn){rHelper.methods[fn](factoryId)}),rHelper.methods.CALC_dependantFactories(factoryId,"product"),rHelper.methods.INSRT_diamondTop10Profit(),rHelper.methods.INSRT_diamondTotalProfit(),rHelper.methods.INSRT_flowRate(factoryId,"product"),rHelper.methods.INSRT_flowDistributionGlobal(),rHelper.methods.INSRT_factoryHighlightColumns()})},EVNT_materialInput:function EVNT_materialInput(materialId){$("#material-rate-"+materialId).on("input",function(){var materialId=this.id.replace("material-rate-",""),materialAmount=parseInt(this.value);rHelper.methods.SET_globalObject("material",materialId,"perHour",materialAmount),rHelper.methods.INSRT_materialRateWorth(materialId),rHelper.methods.INSRT_totalMineWorth(rHelper.methods.CALC_totalMineWorth()),rHelper.methods.CALC_dependantFactories(materialId,"material"),rHelper.methods.INSRT_flowRate(materialId,"material"),rHelper.methods.INSRT_flowDistributionGlobal(),rHelper.methods.EVNT_buildGraph("material")}),$("#material-amount-of-mines-"+materialId).on("input",function(){var materialId=this.id.replace("material-amount-of-mines-",""),materialAmountOfMines=parseInt(this.value);rHelper.methods.SET_globalObject("material",materialId,"amountOfMines",materialAmountOfMines),$.each(rHelper.data.material,function(materialId){rHelper.methods.INSRT_materialNewMinePrice(materialId)}),rHelper.methods.INSRT_warehouseRemainingTimeToFull(materialId,"material"),rHelper.methods.INSRT_materialMineAmortisation(),rHelper.methods.INSRT_totalMineCount(rHelper.methods.CALC_totalMineCount()),rHelper.methods.EVNT_buildGraph("material")})},EVNT_warehouseInput:function EVNT_warehouseInput(id,type){$("#warehouse-"+type+"-calc-2-"+id).on("input",function(){var value=parseInt(this.value);isNaN(value)&&(value=0),rHelper.methods.INSRT_warehouseUpgradeCost(id,type,value)}),$("#warehouse-"+type+"-calc-1-"+id).on("change",function(){$("#warehouse-"+type+"-upgrade-cost-"+id).empty(),$("#warehouse-"+type+"-calc-2-"+id).val(0)}),$("#warehouse-"+type+"-stock-current-"+id).on("input",function(){var value=parseInt(this.value);isNaN(value)&&(value=0);var newFillStatus=value/rHelper.data[type][id].warehouse.contingent;rHelper.methods.SET_globalObject(type,id,["warehouse","fillAmount"],value),rHelper.methods.SET_globalObject(type,id,["warehouse","fillStatus"],newFillStatus);var fns=["INSRT_warehouseWorth","INSRT_warehouseFillStatus","INSRT_warehouseRemainingTimeToFull"];$.each(fns,function(i,fn){rHelper.methods[fn](id,type)}),rHelper.methods.INSRT_warehouseTotalWorth()}),$("#warehouse-"+type+"-level-"+id).on("input",function(){var value=parseInt(this.value);isNaN(value)&&(value=0);var el=rHelper.data[type][id].warehouse;rHelper.methods.SET_globalObject(type,id,["warehouse","level"],value),rHelper.methods.SET_globalObject(type,id,["warehouse","contingent"],rHelper.methods.CALC_warehouseContingent(value)),rHelper.methods.SET_globalObject(type,id,["warehouse","fillStatus"],el.fillAmount/el.contingent);var fns=["INSRT_warehouseCapacity","INSRT_warehouseFillStatus","INSRT_warehouseRemainingTimeToFull"];$.each(fns,function(i,fn){rHelper.methods[fn](id,type)}),rHelper.methods.INSRT_warehouseTotalLevel()})},EVNT_buildingChange:function EVNT_buildingChange(buildingId){$("#buildings-level-"+buildingId).on("change",function(){var value=parseInt(this.value);rHelper.methods.SET_globalObject("buildings",buildingId,"level",value),9==buildingId?rHelper.methods.SET_transportCost():5==buildingId&&rHelper.methods.SET_recyclingPlantLevel(),3!=buildingId&&4!=buildingId&&9!=buildingId||$.each(rHelper.data.units,function(unitId){rHelper.methods.INSRT_unitsPricePerStrength(unitId)});var fns=["INSRT_buildingData","INSRT_buildingToLevel10","SET_buildingBackgroundColor"];$.each(fns,function(i,fn){rHelper.methods[fn](buildingId)}),rHelper.methods.INSRT_gaugeGraph("buildings")})},EVNT_buildGraph:function EVNT_buildGraph(type){rHelper.graphs=rHelper.graphs||{};var parentGraphObj=rHelper.graphs.material;rHelper.graphs.material.reference.mineCount=rHelper.methods.CALC_totalMineCount(),rHelper.graphs.material.reference.mineIncome=rHelper.methods.CALC_totalMineWorth(),$.each(rHelper.data.material,function(i,material){var iteration={y:0,color:"",drilldown:{categories:[],data:[],color:""}},mineAmountPercent=parseFloat((material.amountOfMines/rHelper.graphs.material.reference.mineCount*100).toFixed(2)),mineIncomePercent=parseFloat((rHelper.methods.CALC_materialRateWorth(i)/rHelper.graphs.material.reference.mineIncome*100).toFixed(2)),materialName=material.name;isNaN(mineAmountPercent)?iteration.y=0:iteration.y=mineAmountPercent;var mineDataObj={name:materialName,y:iteration.y,color:iteration.color};iteration.color=rHelper.graphs.material.colors[i],iteration.drilldown.color=rHelper.graphs.material.colors[i],iteration.drilldown.categories[i]=materialName,iteration.drilldown.name=materialName,isNaN(mineIncomePercent)?iteration.drilldown.data[i]=0:iteration.drilldown.data[i]=mineIncomePercent,JSON.stringify(rHelper.graphs.material.mineData[i])!==JSON.stringify(mineDataObj)&&(rHelper.graphs.material.mineData[i]=mineDataObj);for(var drillDataLen=iteration.drilldown.data.length,brightness=0,j=0;j<drillDataLen;j+=1)brightness=.2-j/drillDataLen/5,rHelper.graphs.material.incomeData[i]={name:iteration.drilldown.categories[j],y:iteration.drilldown.data[j],color:Highcharts.Color(iteration.color).brighten(brightness).get()};JSON.stringify(rHelper.graphs.material.data[i])!==JSON.stringify(iteration)&&(rHelper.graphs.material.data[i]=iteration)}),rHelper.methods.INSRT_polygonGraph(parentGraphObj.target,parentGraphObj.titleText,parentGraphObj.seriesNames,parentGraphObj.responsiveId,type)},EVNT_switchHeadquarter:function EVNT_switchHeadquarter(clickedHq){$(".hq-thumb-"+clickedHq).on("click",function(){var actualLevel=parseInt(clickedHq)+1;rHelper.data.headquarter.user=rHelper.data.headquarter.user||{},rHelper.data.headquarter.user.paid=rHelper.data.headquarter.user.paid||[0,0,0,0],rHelper.data.headquarter.user.level=rHelper.data.headquarter.user.level||actualLevel,rHelper.methods.SET_globalObject("headquarter","user","level",actualLevel),rHelper.methods.SET_hqSelectorClass(clickedHq),rHelper.methods.INSRT_gaugeGraph("headquarter"),rHelper.methods.INSRT_headquarterContentRequiredAmount(actualLevel),rHelper.methods.INSRT_headquarterPaid();for(var i=0;i<=3;i+=1)rHelper.methods.INSRT_headquarterMissing(i);rHelper.methods.INSRT_headquarterRemainingCost(actualLevel),rHelper.methods.INSRT_companyWorth()})},EVNT_headquarterInput:function EVNT_headquarterInput(){$.each($("[id*='hq-content-input-']"),function(i,el){$(el).on("input",function(){var thisId=parseInt(this.id.replace(/hq-content-input-/,"")),thisValue=parseInt(this.value);isNaN(thisValue)?thisValue=0:thisValue>5e7&&(thisValue=5e7),rHelper.methods.SET_globalObject("headquarter","user",["paid",thisId],thisValue),rHelper.methods.INSRT_headquarterMissing(i),rHelper.methods.INSRT_headquarterRemainingCost(rHelper.data.headquarter.user.level),rHelper.methods.INSRT_gaugeGraph("headquarter"),rHelper.methods.INSRT_companyWorth()})})},EVNT_priceHistoryOnChange:function EVNT_priceHistoryOnChange(){$("#pricehistory-selector").on("change",function(){var thisVal=parseInt(this.value),url="api/getPriceHistory.php?id="+thisVal,resource=rHelper.methods.CALC_convertId(thisVal),materialName='<span style="height: 25px; width: 25px;" class="'+resource.icon+'"></span> '+resource.name;rHelper.methods.EVNT_priceHistoryToggler("loading"),$.getJSON(url,function(response){var averageKI=response.avg.ki,averagePlayer=response.avg.player,timestamps=[],player=[],ki=[];$.each(response.data,function(i,dataset){var date=rHelper.methods.CALC_convertDateToIso(rHelper.methods.CALC_toMilliseconds(dataset.ts));timestamps.push(date),0==dataset.player&&(dataset.player=null),player.push(dataset.player),ki.push(dataset.ki)}),rHelper.methods.EVNT_priceHistoryToggler("finished"),rHelper.methods.INSRT_priceHistoryGraph(materialName,averageKI,averagePlayer,timestamps,player,ki)})})},EVNT_priceHistoryToggler:function EVNT_priceHistoryToggler(state){var _ref3=[$("#graph-pricehistory"),$("#pricehistory-selector")],container=_ref3[0],selector=_ref3[1];switch(state){case"loading":var svg='<svg id="pricehistory-svg" xmlns="http://www.w3.org/2000/svg" style="background:0 0" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><g transform="translate(50 50)"><g transform="matrix(.6 0 0 .6 -19 -19)"><g transform="rotate(242)"><animateTransform attributeName="transform" begin="0s" dur="3s" keyTimes="0;1" repeatCount="indefinite" type="rotate" values="0;360"/><path fill="#9acd32" d="M37.3496988-7h10V7h-10a38 38 0 0 1-1.50391082 5.61267157l8.66025404 5-7 12.12435565-8.66025404-5a38 38 0 0 1-4.10876076 4.10876076l5 8.66025404-12.12435565 7-5-8.66025404A38 38 0 0 1 7 37.34969879v10H-7v-10a38 38 0 0 1-5.61267157-1.50391081l-5 8.66025404-12.12435565-7 5-8.66025404a38 38 0 0 1-4.10876076-4.10876076l-8.66025404 5-7-12.12435565 8.66025404-5A38 38 0 0 1-37.34969879 7h-10V-7h10a38 38 0 0 1 1.50391081-5.61267157l-8.66025404-5 7-12.12435565 8.66025404 5a38 38 0 0 1 4.10876076-4.10876076l-5-8.66025404 12.12435565-7 5 8.66025404A38 38 0 0 1-7-37.34969879v-10H7v10a38 38 0 0 1 5.61267157 1.50391081l5-8.66025404 12.12435565 7-5 8.66025404a38 38 0 0 1 4.10876076 4.10876076l8.66025404-5 7 12.12435565-8.66025404 5A38 38 0 0 1 37.34969879-7M0-30a30 30 0 1 0 0 60 30 30 0 1 0 0-60"/></g></g><g transform="matrix(.6 0 0 .6 19 19)"><g transform="rotate(103)"><animateTransform attributeName="transform" begin="-0.125s" dur="3s" keyTimes="0;1" repeatCount="indefinite" type="rotate" values="360;0"/><path fill="coral" d="M37.3496988-7h10V7h-10a38 38 0 0 1-1.50391082 5.61267157l8.66025404 5-7 12.12435565-8.66025404-5a38 38 0 0 1-4.10876076 4.10876076l5 8.66025404-12.12435565 7-5-8.66025404A38 38 0 0 1 7 37.34969879v10H-7v-10a38 38 0 0 1-5.61267157-1.50391081l-5 8.66025404-12.12435565-7 5-8.66025404a38 38 0 0 1-4.10876076-4.10876076l-8.66025404 5-7-12.12435565 8.66025404-5A38 38 0 0 1-37.34969879 7h-10V-7h10a38 38 0 0 1 1.50391081-5.61267157l-8.66025404-5 7-12.12435565 8.66025404 5a38 38 0 0 1 4.10876076-4.10876076l-5-8.66025404 12.12435565-7 5 8.66025404A38 38 0 0 1-7-37.34969879v-10H7v10a38 38 0 0 1 5.61267157 1.50391081l5-8.66025404 12.12435565 7-5 8.66025404a38 38 0 0 1 4.10876076 4.10876076l8.66025404-5 7 12.12435565-8.66025404 5A38 38 0 0 1 37.34969879-7M0-30a30 30 0 1 0 0 60 30 30 0 1 0 0-60"/></g></g></g></svg>';container.html(svg),selector.attr("disabled",!0);break;case"finished":container.empty(),selector.attr("disabled",!1)}},EVNT_mapCreation:function EVNT_mapCreation(mapType){var _ref4=[,,,],container=_ref4[0],data=_ref4[1],infoNode=_ref4[2],errorText=_ref4[3];switch(mapType){case"personal":container=$("#personalmap"),data=rHelper.data.mineMap,infoNode=$("#personalmap-info"),errorText='Your mine map is empty! Please import "Mines - detailed" via API first.';break;case"world":container=$("#worldmap"),data=rHelper.data.worldMap,infoNode=$("#worldmap-info"),errorText="An error occured. If this problem persists, please report this issue via Discord or mail."}if(0!=data.length){var _ref5=[new Date,rHelper.methods.SET_newMap(container,3,"terrain"),[]],now=_ref5[0],map=_ref5[1],markerArr=_ref5[2];switch(map=rHelper.methods.SET_mapOptions(map,16,data.mines[0]),mapType){case"personal":rHelper.methods.SET_mapHQHandler(map,data.hq[0]);break;case"world":$.each(data.hqs,function(i,hqObj){rHelper.methods.SET_mapHQHandler(map,hqObj)})}$.each(data.mines,function(i,subObj){rHelper.methods.SET_mapMineHandler(now,subObj,map,mapType),markerArr.push(rHelper.methods.SET_mapMineHandler(now,subObj,map,mapType))}),new MarkerClusterer(map,markerArr,{imagePath:"assets/img/maps/cluster/m",maxZoom:15})}else infoNode.text(errorText)},EVNT_attackLogTrigger:function EVNT_attackLogTrigger(){$("#heading-defenselog a").on("click",function(e){e.preventDefault(),rHelper.methods.API_getAttackLog("defenseSimple")}),$("#heading-attacklog-1 a").on("click",function(e){e.preventDefault(),rHelper.methods.API_getAttackLog("attackSimple")}),$("#heading-attacklog-2 a").on("click",function(e){e.preventDefault(),rHelper.methods.API_getAttackLog("attackDetailed")})},INSRT_leaderboardTable:function INSRT_leaderboardTable(){var _ref6=[rHelper.data.leaderboard,$("#module-leaderboard tbody"),"text-md-right text-sm-left","class='text-right'",""],container=_ref6[0],tbody=_ref6[1],textOrientation=_ref6[2],textClass=_ref6[3],string=_ref6[4],returnPlayerTitle=function returnPlayerTitle(dataset){return"<table>\n                <tbody>\n                    <tr><td>Rank</td><td "+textClass+">"+dataset.general.rank.toLocaleString("en-US")+"</td></tr>\n                    <tr><td>Registered since</td><td "+textClass+">"+dataset.general.registeredGame+"</td></tr>\n                    <tr><td>Days playing</td><td "+textClass+">"+dataset.general.daysPlaying.toLocaleString("en-US")+"</td></tr>\n                </tbody>\n                </table>"},returnCompanyWorthTitle=function returnCompanyWorthTitle(dataset){return"<table>\n                <thead>\n                    <tr><th colspan='2'>Money spent on...</th></tr>\n                </thead>\n                <tbody>\n                    <tr><td>Mines</td><td "+textClass+">"+dataset.mineErectionSum.toLocaleString("en-US")+"</td></tr>\n                    <tr><td>Factories</td><td "+textClass+">"+dataset.factoryErectionSum.toLocaleString("en-US")+"</td></tr>\n                    <tr><td>Headquarter</td><td "+textClass+">"+dataset.headquarterSum.toLocaleString("en-US")+"</td></tr>\n                    <tr><td>Buildings</td><td "+textClass+">"+dataset.buildingsErectionSum.toLocaleString("en-US")+"</td></tr>\n                    <tr><td>Warehouse</td><td "+textClass+">"+dataset.warehouseErectionSum.toLocaleString("en-US")+"</td></tr>\n                </tbody>\n                </table>"},returnString=function returnString(dataset){return'\n                <tr>\n                    <td data-th="Player (hover for details)" title="'+returnPlayerTitle(dataset)+'">'+dataset.general.name+" ("+dataset.general.level.toLocaleString("en-US")+')</td>\n                    <td sorttable_customkey="'+dataset.general.points+'" data-th="Points per day (total points)" class="'+textOrientation+'">'+dataset.general.pointsPerDay.toLocaleString("en-US")+" ("+dataset.general.points.toLocaleString("en-US")+')</td>\n                    <td data-th="Factory upgrades" class="'+textOrientation+'">'+dataset.factoryTotalUpgrades.toLocaleString("en-US")+'</td>\n                    <td data-th="Amount of mines" class="'+textOrientation+'">'+dataset.totalMineCount.toLocaleString("en-US")+'</td>\n                    <td data-th="Mines within HQ radius" class="'+textOrientation+'">'+dataset.headquarter.mineCount.toLocaleString("en-US")+'</td>\n                    <td data-th="Mine income" class="'+textOrientation+'">'+dataset.mineIncome.toLocaleString("en-US")+'</td>\n                    <td data-th="Trade income per day" class="'+textOrientation+'">'+dataset.tradeData.tradeIncomePerDay.toLocaleString("en-US")+'</td>\n                    <td data-th="Bought goods for" class="'+textOrientation+'">'+dataset.tradeData.totalBuy.toLocaleString("en-US")+'</td>\n                    <td data-th="Sold goods for..." class="'+textOrientation+'">'+dataset.tradeData.totalSell.toLocaleString("en-US")+'</td>\n                    <td data-th="Sold goods to KI for..." class="'+textOrientation+'">'+dataset.tradeData.sumKISell.toLocaleString("en-US")+'</td>\n                    <td data-th="Company worth" class="'+textOrientation+'" title="'+returnCompanyWorthTitle(dataset)+'">'+dataset.companyWorth.toLocaleString("en-US")+"</td>\n                </tr>\n                "};$.each(container,function(i,dataset){string+=returnString(dataset)}),tbody.empty().html(string),sorttable.makeSortable($("#module-leaderboard table")[0]),sorttable.innerSortFunction.apply($("#module-leaderboard th")[10],[]),$.each($("#module-leaderboard td[title]"),function(i,el){applyTippyOnNewElement($(el))})},INSRT_leaderboard:function INSRT_leaderboard(){rHelper.data.leaderboard=rHelper.data.leaderboard||{},$.isEmptyObject(rHelper.data.leaderboard)&&$.getJSON("api/leaderboard.php",function(result){rHelper.data.leaderboard=result,rHelper.methods.INSRT_leaderboardTable()})},INSRT_tradeLog:function INSRT_tradeLog(){var container=rHelper.data.tradeLog;if(0!=container.length){var showTradeLogHabits,setSkipCount=function setSkipCount(){var currentDaysFilter=_daysFilterSelect.val();null!=currentDaysFilter&&$.each(_daysFilterSelect.children("option"),function(i,el){$(el).val()==currentDaysFilter&&(rHelper.data.tradeLog.skipCount=i-1)})},appendOptions=function appendOptions(){_daysFilterSelect.empty().prepend("<option selected disabled>jump to day X</option>"),$.each(container.days,function(i,dataset){_daysFilterSelect.append('<option value="'+dataset.date+'">'+dataset.date+" ("+dataset.entries.toLocaleString("en-US")+" entries)</option>")})},appendDetailedTR=function appendDetailedTR(dataset){var obj=rHelper.methods.CALC_convertId(dataset.itemId),datasetSum=dataset.price*dataset.amount,action="Selling to ",profitClass="success",trClass="";0==dataset.event&&(datasetSum*=-1,action="Buying from ",profitClass="danger"),_sum+=datasetSum,"KI"==dataset.actor&&(trClass='class="ki-sell"');var template="\n          <tr "+trClass+'>\n            <td data-th="Trade partner"><span class="text-'+profitClass+'">'+action+"</span><kbd>"+dataset.actor+" ("+dataset.actorLevel.toLocaleString("en-US")+')</kbd></td>\n            <td data-th="Timestamp" class="'+_textOrientation+'">'+rHelper.methods.CALC_convertDateToIso(1e3*dataset.timestamp)+'</td>\n            <td data-th="Amount" class="'+_textOrientation+'">'+dataset.amount.toLocaleString("en-US")+'x <span class="'+obj.icon+'"></span></td>\n            <td data-th="Price" class="'+_textOrientation+'">'+dataset.price.toLocaleString("en-US")+'</td>\n            <td data-th="Sum" class="'+_textOrientation+" text-"+profitClass+'">'+datasetSum.toLocaleString("en-US")+"</td>\n          </tr>\n          ";_tradeLogDetailedTbody.append(template)},appendTFoot=function appendTFoot(){var profitClass="success";_sum<0&&(profitClass="danger"),$("#tradelog-detailed-tfoot").empty().append('<tr><td data-th="daily profit" colspan="5" class="'+_textOrientation+" text-"+profitClass+'">'+_sum.toLocaleString("en-US")+' <a href="#">back to top</a></td></tr>'),$("#tradelog-simple-tfoot").empty().append('<tr><td data-th="daily profit" colspan="5" class="'+_textOrientation+" text-"+profitClass+'">'+_sum.toLocaleString("en-US")+' <a href="#">back to top</a></td></tr>')},showGraphs=function showGraphs(target,data,title){Highcharts.chart(target,{chart:{type:"pie",backgroundColor:"transparent"},title:{text:title,style:{color:"#dedede"}},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}% ({point.y:,.0f})</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} % ({point.y:,.0f})",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"#dedede",textOutline:"none"}}}},series:[{name:"Percentage",colorByPoint:!0,data:data}],exporting:{chartOptions:{chart:{backgroundColor:"#5f473e"}}}})},fillEventArray=function fillEventArray(container){var _ref7=[[],container.max()],arr=_ref7[0],containerMax=_ref7[1];return $.each(container,function(i,amount){var itemObj=rHelper.methods.CALC_convertId(i);if(null!=amount){var obj={name:itemObj.name,y:amount};containerMax==amount&&(obj.sliced=!0,obj.selected=!0),arr.push(obj)}}),arr},appendSimpleTR=function appendSimpleTR(dataset){var obj=rHelper.methods.CALC_convertId(dataset.itemId),profitClass="success";dataset.sum<0&&(profitClass="danger");var template='\n          <tr>\n            <td data-th="Type" class="'+_textOrientation+'"><span class="'+obj.icon+'"></span></td>\n            <td data-th="Bought for..." class="'+_textOrientation+' text-danger"> '+dataset.bought.toLocaleString("en-US")+'</td>\n            <td data-th="Sold for..." class="'+_textOrientation+' text-success"> '+dataset.sold.toLocaleString("en-US")+'</td>\n            <td data-th="Profit of selected day" class="'+_textOrientation+" text-"+profitClass+'">'+dataset.sum.toLocaleString("en-US")+"</td>\n          </tr>\n          ";_tradeLogSimpleTbody.append(template)};(function showTradeLogHabits(hours){Highcharts.chart("graph-tradelog-habits",{chart:{type:"column",backgroundColor:"transparent",height:200},title:{text:"Selling habits per hour",style:{color:"#dedede"}},xAxis:{type:"category",labels:{rotation:-45,style:{fontSize:"13px",fontFamily:"Verdana, sans-serif",color:"#dedede"}}},yAxis:{min:0,title:{text:"Amount of trades completed",style:{color:"#dedede"}},labels:{style:{color:"#dedede"}}},legend:{enabled:!1},tooltip:{pointFormat:"Sell actions performed at this hour: <b>{point.y}</b>"},series:[{name:"Sell action",data:hours,dataLabels:{enabled:!0,rotation:-90,color:"#dedede",align:"right",y:10,style:{fontSize:"13px",fontFamily:"Verdana, sans-serif",color:"#dedede"}}}],exporting:{chartOptions:{chart:{backgroundColor:"#5f473e"}}}})})(container.timestamps),showGraphs("graph-tradelog-buying",fillEventArray(container.buying.valuesById),"Buy values (total: "+container.buying.total.toLocaleString("en-US")+")"),showGraphs("graph-tradelog-selling",fillEventArray(container.selling.valuesById),"Sell values (total: "+container.selling.total.toLocaleString("en-US")+")");var _ref8=[$("#tradelog-detailed-tbody"),"text-md-right text-sm-left",$("#tradelog-filter-day"),$("#tradelog-simple-tbody")],_tradeLogDetailedTbody=_ref8[0],_textOrientation=_ref8[1],_daysFilterSelect=_ref8[2],_tradeLogSimpleTbody=_ref8[3];_tradeLogDetailedTbody.empty(),_tradeLogSimpleTbody.empty();var _sum=0;setSkipCount(),appendOptions(),$.each(container.log,function(i,dataset){appendDetailedTR(dataset)}),$.each(container.overview,function(i,dataset){appendSimpleTR(dataset)}),appendTFoot()}},INSRT_attackLogDetailedGeneralInformation:function INSRT_attackLogDetailedGeneralInformation(dataContainer){$("#attacklog-detailed-units-lost-avg").html(rHelper.methods.CALC_attackLogDetailedUnitStringInsertion("offense",dataContainer.avg.unitsLost)),$("#attacklog-detailed-units-lost-total").html(rHelper.methods.CALC_attackLogDetailedUnitStringInsertion("offense",dataContainer.total.unitsLost)),$("#attacklog-detailed-factor-avg").text(dataContainer.avg.factor+"%"),$("#attacklog-detailed-profit-avg").text(dataContainer.avg.profit.toLocaleString("en-US")),$("#attacklog-detailed-profit-total").text(dataContainer.total.profit.toLocaleString("en-US"))},INSRT_attackLogDetailed:function INSRT_attackLogDetailed(type,dataContainer){var _ref9=[$("#attacklog-tbody-detailed"),$("#attacklog-detailed-selector"),$("#collapse-attacklog-detailed table")[1],["Attacked player (level)","Timestamp & position","Units lost","Units destroyed","Lootfactor","Loot","Profit"]],target=_ref9[0],select=_ref9[1],sortableTable=_ref9[2],dataTHs=_ref9[3];target.empty(),2==select[0].children.length&&$.each(dataContainer.validTargets,function(i,target){select.append('<option value="'+target+'">'+target+"</option>")}),$.each(dataContainer.data,function(i,dataset){target.append(rHelper.methods.CALC_attackLogDetailedDatasetIteration(i,dataset,dataTHs))}),rHelper.methods.INSRT_attackLogDetailedGeneralInformation(dataContainer),["last","next"].forEach(function(type){rHelper.methods.CALC_attackLogDetailedPageButtonToggler(type,dataContainer)}),sorttable.makeSortable(sortableTable)},INSRT_ADLogSimple:function INSRT_ADLogSimple(type,data){var _ref10=[$("#attacklog-tbody-simple"),["Attacked player (last known level)","Last attacked","Total attacks","Win","Loss","Average loot factor","Average amount of units used","Profit"],[0,2,3],"text-md-right text-sm-left",$("#collapse-attacklog-simple table")[0]],target=_ref10[0],dataTHs=_ref10[1],unitIndices=_ref10[2],textOrientation=_ref10[3],sortableTable=_ref10[4];target.empty(),"defenseSimple"==type&&(dataTHs[0]="Attacking player (last known level)",sortableTable=$("#collapse-defenselog-simple table")[0],target=$("#defenselog-tbody-simple")),$.each(data,function(i,dataset){for(var _ref11=[$(crEl("tr")),"bg-success-25"],tr=_ref11[0],factorBgColorClass=_ref11[1],index=0;index<=7;index+=1){var _ref12=[$(crEl("td")).attr("data-th",dataTHs[index]),0,0,0,""],td=_ref12[0],loss=_ref12[1],winPercent=_ref12[2],factor=_ref12[3],unitsContent=_ref12[4];switch(index){case 0:td.text(dataset.targetName+" ("+dataset.targetLevel+")");break;case 1:td.text(rHelper.methods.CALC_convertDateToIso(dataset.lastAttacked));break;case 2:winPercent=(dataset.sumWin/dataset.sumAttacks*100).toFixed(2),td.text(dataset.sumAttacks.toLocaleString("en-US")+" ("+winPercent+"%)").addClass(textOrientation);break;case 3:"defenseSimple"==type?(loss=dataset.sumAttacks-dataset.sumWin,td.text(loss.toLocaleString("en-US")).addClass(textOrientation)):"attackSimple"==type&&td.text(dataset.sumWin.toLocaleString("en-US")).addClass(textOrientation);break;case 4:"defenseSimple"==type?td.text(dataset.sumWin.toLocaleString("en-US")).addClass(textOrientation):"attackSimple"==type&&(loss=dataset.sumAttacks-dataset.sumWin,td.text(loss.toLocaleString("en-US")).addClass(textOrientation));break;case 5:dataset.factor<1&&(factorBgColorClass="bg-warning-25"),factor=(100*dataset.factor).toFixed(2),td.text(factor+"%").addClass(textOrientation+" "+factorBgColorClass);break;case 6:for(var k=0;k<=2;k+=1){var span=$(crEl("span"));span.addClass("resources-unit-"+unitIndices[k]);var unitAmount=dataset["unit"+k];null==unitAmount&&(unitAmount=0),unitsContent+=span[0].outerHTML+" "+unitAmount.toLocaleString("en-US")+" "}td.html(unitsContent);break;case 7:var profit=dataset.profit;null==profit&&(profit=0);var unitLossValue=dataset.unitLossValue;null!=unitLossValue&&(profit-=unitLossValue),td.text(profit.toLocaleString("en-US")).addClass(textOrientation)}tr.addClass(rHelper.methods.CALC_attackLogSetTRColor(dataset.profit)).append(td)}target.append(tr)}),sorttable.makeSortable(sortableTable)},INSRT_attackLog:function INSRT_attackLog(type){var data=rHelper.data.attackLog,fn=void 0;switch(type){case"attackSimple":case"defenseSimple":fn="INSRT_ADLogSimple";break;case"attackDetailed":fn="INSRT_attackLogDetailed"}rHelper.methods[fn](type,data)},INSRT_materialData:function INSRT_materialData(materialId,api){var fns=["INSRT_materialRate","INSRT_materialAmountOfMines","INSRT_materialNewMinePrice","INSRT_materialRateWorth","INSRT_materialNewMinePerfectIncome"];$.each(fns,function(i,fn){rHelper.methods[fn](materialId)}),api&&rHelper.methods.CALC_dependantFactories(materialId,"material"),rHelper.methods.INSRT_flowRate(materialId,"material")},INSRT_factoryDiamondData:function INSRT_factoryDiamondData(factoryId,type){var fns=["INSRT_factoryLevel","INSRT_factoryOutput","INSRT_factoryUpgradeCost","INSRT_factoryDependencies","INSRT_factoryWorkload","INSRT_factoryTurnover","INSRT_factoryTurnoverPerUpgrade","INSRT_factoryROI","INSRT_diamondFactoryOutput","INSRT_diamondFactoryOutputWarehouse","INSRT_diamondDependencies","INSRT_diamondEfficiency","INSRT_diamondProfit"];$.each(fns,function(i,fn){rHelper.methods[fn](factoryId)}),rHelper.methods.INSRT_flowRate(factoryId,type)},INSRT_recycling:function INSRT_recycling(index){var fns=["INSRT_recyclingRequirement","INSRT_recyclingProducts","INSRT_recyclingOutputWorth","INSRT_recyclingInputWorth"];$.each(fns,function(i,fn){rHelper.methods[fn](index)}),rHelper.methods.INSRT_unitsRecyclingProfit("recycling",index)},INSRT_warehouseData:function INSRT_warehouseData(index,type){var fns=["INSRT_warehouseFillAmount","INSRT_warehouseLevel","INSRT_warehouseFillStatus","INSRT_warehouseCapacity","INSRT_warehouseWorth","EVNT_warehouseInput"];$.each(fns,function(i,fn){rHelper.methods[fn](index,type)}),"products"!=type&&"material"!=type||rHelper.methods.INSRT_warehouseRemainingTimeToFull(index,type)},INSRT_priceHistoryGraph:function INSRT_priceHistoryGraph(materialName,averageKI,averagePlayer,timestamps,player,ki){Highcharts.chart("graph-pricehistory",{chart:{type:"spline",zoomType:"x"},title:{useHTML:!0,text:"Price history for "+materialName},subtitle:{text:"last 28 days"},xAxis:{categories:timestamps},yAxis:{title:{text:"Price"},labels:{formatter:function formatter(){return this.value.toLocaleString("en-US")}},plotLines:[{color:"red",value:averageKI,width:"1",zIndex:5,label:{text:"average KI price of "+averageKI.toLocaleString("en-US"),align:"right",style:{color:"darkgreen"}}},{color:"darkgreen",value:averagePlayer,width:"1",zIndex:5,label:{text:"average player price of "+averagePlayer.toLocaleString("en-US"),align:"right",style:{color:"orange"}}}]},legend:{enabled:!1},tooltip:{crosshairs:!0,shared:!0},plotOptions:{spline:{marker:{radius:4,lineColor:"#666666",lineWidth:1}}},series:[{name:"KI",marker:{symbol:"square"},color:"darkgreen",data:ki},{name:"Player",marker:{symbol:"diamond"},color:"orange",data:player}],exporting:{chartOptions:{chart:{backgroundColor:"#5f473e"}}}})},INSRT_polygonGraph:function INSRT_polygonGraph(target,titleText,seriesNames,responsiveId,targetObj){var dataObj=rHelper.graphs[targetObj];Highcharts.chart(target,{chart:{type:"pie",backgroundColor:"transparent"},title:{text:titleText,style:{color:"#dedede"}},plotOptions:{pie:{shadow:!1,center:["50%","50%"]}},tooltip:{valueSuffix:"%"},series:[{name:seriesNames[0],data:dataObj.mineData,colors:dataObj.colors,size:"60%",dataLabels:{formatter:function formatter(){return this.y>5?this.point.name:null},color:"#dedede",distance:-30}},{name:seriesNames[1],data:dataObj.incomeData,colors:dataObj.colors,size:"80%",innerSize:"60%",dataLabels:{formatter:function formatter(){return this.y>1?"<b> "+this.point.name+" :</b> "+this.y+" %":null},style:{color:"white",textOutline:"none"}},id:responsiveId}],responsive:{rules:[{condition:{maxWidth:400},chartOptions:{series:[{id:responsiveId,dataLabels:{enabled:!1}}]}}]},exporting:{chartOptions:{chart:{backgroundColor:"#5f473e"}}}})},INSRT_gaugeGraph:function INSRT_gaugeGraph(type){"buildings"==type?Highcharts.chart("graph-buildings",Highcharts.merge(rHelper.graphs.gaugeOptions,{yAxis:{min:0,max:rHelper.methods.CALC_perfectWorth("buildings"),title:{text:"total building worth"}},series:[{name:"total building worth",data:[rHelper.methods.CALC_totalBuildingErectionSum()]}]})):"headquarter"==type&&Highcharts.chart("graph-headquarter",Highcharts.merge(rHelper.graphs.gaugeOptions,{yAxis:{min:0,max:rHelper.methods.CALC_perfectWorth("headquarter"),title:{text:"total headquarter worth"}},series:[{name:"total headquarter worth",data:[rHelper.methods.CALC_totalHeadquarterErectionSum()]}]}))},INSRT_totalMineWorth:function INSRT_totalMineWorth(totalMineWorth){$("#material-total-worth").text(totalMineWorth.toLocaleString("en-US"))},INSRT_totalMineCount:function INSRT_totalMineCount(totalMineCount){$("#material-total-mine-count").text(totalMineCount.toLocaleString("en-US"))},INSRT_materialRate:function INSRT_materialRate(materialId){$("#material-rate-"+materialId).val(rHelper.data.material[materialId].perHour)},INSRT_materialAmountOfMines:function INSRT_materialAmountOfMines(materialId){$("#material-amount-of-mines-"+materialId).val(rHelper.data.material[materialId].amountOfMines)},INSRT_userSettings:function INSRT_userSettings(){var userInfo=rHelper.data.userInformation;$("#security-token").text(userInfo.securityToken),""!=userInfo.realKey&&void 0!==_typeof(userInfo.realKey)&&($("#api-key").val(userInfo.realKey),rHelper.methods.INSRT_API_remainingCredits(userInfo.remainingCredits)),""!=userInfo.name&&$("#api-player-anonymity")[0].parentNode.remove(),$.each(rHelper.data.settings,function(index,setting){var value=0;switch(setting.setting){case"lang":switch(setting.value){case"de":value=0;break;case"en":value=1;break;case"fr":value=2;break;case"in":value=3;break;case"jp":value=4;break;case"ru":value=5}$("#settings-language").val(value);break;case"customTU":for(var i=0;i<=3;i+=1)$("#settings-custom-tu-"+(i+1)).val(setting.value[i]);break;case"idealCondition":1===setting.value&&$("#settings-ideal-conditions").prop("checked",!0);break;case"transportCostInclusion":1===setting.value&&$("#settings-toggle-transport-cost-inclusion").prop("checked",!0);break;case"mapVisibleHQ":1===setting.value&&$("#settings-hq-visibility").val(1);break;case"priceAge":$("#settings-price-age").val(setting.value)}})},INSRT_materialNewMinePrice:function INSRT_materialNewMinePrice(materialId){$("#material-new-price-"+materialId).text(rHelper.methods.CALC_materialNewMinePrice(rHelper.methods.CALC_totalMineCount(),materialId).toLocaleString("en-US"))},INSRT_materialRateWorth:function INSRT_materialRateWorth(materialId){$("#material-worth-"+materialId).text(rHelper.methods.CALC_materialRateWorth(materialId).toLocaleString("en-US"))},INSRT_materialMineAmortisation:function INSRT_materialMineAmortisation(){var roi100Array=rHelper.methods.CALC_materialMineROI("100"),roi500Array=rHelper.methods.CALC_materialMineROI("505"),roiXArray=rHelper.methods.CALC_materialMineROI("505hq");$.each(roi100Array,function(i,value){$("#material-roi-100-"+i).text(value.toFixed(2).toLocaleString("en-US"))}),$.each(roi500Array,function(i,value){$("#material-roi-500-"+i).text(value.toFixed(2).toLocaleString("en-US"))}),$.each(roiXArray,function(i,value){$("#material-roi-x-"+i).text(value.toFixed(2).toLocaleString("en-US"))}),rHelper.methods.INSRT_materialHighlightColumns(roi100Array,"#material-roi-100-","text-success","text-danger"),rHelper.methods.INSRT_materialHighlightColumns(roi500Array,"#material-roi-500-","text-success","text-danger"),rHelper.methods.INSRT_materialHighlightColumns(roiXArray,"#material-roi-x-","text-success","text-danger")},INSRT_materialNewMinePerfectIncome:function INSRT_materialNewMinePerfectIncome(materialId){$("#material-perfect-income-"+materialId).text(rHelper.methods.CALC_materialMinePerfectIncome(materialId).toLocaleString("en-US"))},INSRT_materialHighlightMinePerfectIncome:function INSRT_materialHighlightMinePerfectIncome(){var array=[];$.each(rHelper.data.material,function(materialId){array.push(rHelper.methods.CALC_materialMinePerfectIncome(materialId))}),rHelper.methods.INSRT_materialHighlightColumns(array,"#material-perfect-income-","text-danger","text-success")},INSRT_materialHighlightColumns:function INSRT_materialHighlightColumns(array,target,minClass,maxClass){var _ref13=[["min","max"],0,,],selectors=_ref13[0],value=_ref13[1],addClass=_ref13[2],rmvClass=_ref13[3];$.each(selectors,function(i,selector){switch(selector){case"min":value=array.min(),addClass=minClass,rmvClass=maxClass;break;case"max":value=array.max(),addClass=maxClass,rmvClass=minClass}var el;$(target+array.indexOf(value)).removeClass(rmvClass).addClass(addClass)})},INSRT_factoryLevel:function INSRT_factoryLevel(factoryId){var factoryLevel=rHelper.data.products[factoryId].factoryLevel;$("#factories-level-"+factoryId).val(factoryLevel),$("#diamond-level-"+factoryId).text(factoryLevel)},INSRT_factoryOutput:function INSRT_factoryOutput(factoryId){$("#factories-product-"+factoryId).text(rHelper.methods.CALC_factoryOutput(factoryId).toLocaleString("en-US"))},INSRT_factoryUpgradeCost:function INSRT_factoryUpgradeCost(factoryId){var target=$("#factories-upgrade-cost-"+factoryId),calculateFactoryUpgradeCostObj=rHelper.methods.CALC_factoryUpgradeCost(factoryId);target.text(calculateFactoryUpgradeCostObj.sum.toLocaleString("en-US")),target.attr("title",calculateFactoryUpgradeCostObj.title),applyTippyOnNewElement(target)},INSRT_totalFactoryUpgrades:function INSRT_totalFactoryUpgrades(){$("#factories-total-upgrades").text(rHelper.methods.CALC_totalFactoryUpgrades().toLocaleString("en-US"))},INSRT_factoryDependencies:function INSRT_factoryDependencies(factoryId){var product,dependencies=rHelper.data.products[factoryId].dependencies,dependencyString="";if($.isArray(dependencies))$.each(dependencies,function(dependencyIndex,dependency){var dependantObj=rHelper.methods.CALC_convertId(dependency),price=rHelper.methods.CALC_returnPriceViaId(dependency).toLocaleString("en-US"),requiredAmount=rHelper.methods.CALC_factoryDependencyRequiredAmount(factoryId,dependencyIndex),existingAmount=rHelper.methods.CALC_factoryDependencyExistingAmount(dependantObj,dependencyIndex),addClass=rHelper.methods.CALC_factoryComparatorRequiredVsExistingAmount(requiredAmount,existingAmount),_ref14=[$(crEl("span")),$(crEl("span")),$(crEl("span"))],outerSpan=_ref14[0],imgSpan=_ref14[1],innerSpan=_ref14[2];imgSpan.addClass(dependantObj.icon).attr("title",price.toLocaleString("en-US")),innerSpan.addClass(addClass).text(requiredAmount.toLocaleString("en-US")),outerSpan.append(imgSpan[0].outerHTML+" "+innerSpan[0].outerHTML+" "),dependencyString+=outerSpan[0].outerHTML});else{var dependantObj=rHelper.methods.CALC_convertId(dependencies),price=rHelper.methods.CALC_returnPriceViaId(dependencies).toLocaleString("en-US"),requiredAmount=rHelper.methods.CALC_factoryDependencyRequiredAmount(factoryId,0),existingAmount=rHelper.methods.CALC_factoryDependencyExistingAmount(dependantObj,0),addClass=rHelper.methods.CALC_factoryComparatorRequiredVsExistingAmount(requiredAmount,existingAmount),_ref15=[$(crEl("span")),$(crEl("span")),$(crEl("span"))],outerSpan=_ref15[0],imgSpan=_ref15[1],innerSpan=_ref15[2];imgSpan.addClass(dependantObj.icon).attr("title",price.toLocaleString("en-US")),innerSpan.addClass(addClass).text(requiredAmount.toLocaleString("en-US")),outerSpan.append(imgSpan[0].outerHTML+" "+innerSpan[0].outerHTML+" "),dependencyString+=outerSpan[0].outerHTML}$("#factories-dependencies-"+factoryId).html(dependencyString)},INSRT_factoryAmortisation:function INSRT_factoryAmortisation(factoryId){var _ref16=["#factories-roi-"+factoryId,rHelper.methods.CALC_factoryAmortisation(factoryId)],target=_ref16[0],amortisation=_ref16[1];amortisation=amortisation<0||amortisation==1/0?"∞":amortisation.toFixed(2),$(target).text(amortisation)},INSRT_factoryWorkload:function INSRT_factoryWorkload(factoryId){var _ref17=[$("#factories-workload-"+factoryId),rHelper.data.products[factoryId].dependencies],target=_ref17[0],dependencies=_ref17[1];if(rHelper.data.products[factoryId].dependencyWorkload=[],$.isArray(dependencies))$.each(dependencies,function(dependencyIndex){var dependencyWorkload=rHelper.methods.CALC_factoryDepedencyWorkload(factoryId,dependencyIndex);rHelper.data.products[factoryId].dependencyWorkload.push(dependencyWorkload)});else{var dependencyWorkload=rHelper.methods.CALC_factoryDepedencyWorkload(factoryId,0);rHelper.data.products[factoryId].dependencyWorkload.push(dependencyWorkload)}var _ref18=[rHelper.methods.CALC_factoryWorkloadMinNonSanitized(factoryId),,],workload=_ref18[0],removeClass=_ref18[1],addClass=_ref18[2];workload>=1?(removeClass="text-danger",addClass="text-success"):(removeClass="text-success",addClass="text-danger"),target.removeClass(removeClass).addClass(addClass),target.text((100*workload).toFixed(2)+" %")},INSRT_factoryTurnover:function INSRT_factoryTurnover(factoryId){var _ref19=[$("#factories-turnover-"+factoryId),rHelper.methods.CALC_factoryTurnover(factoryId),,],target=_ref19[0],turnover=_ref19[1],removeClass=_ref19[2],addClass=_ref19[3];turnover<=0?(removeClass="text-success",addClass="text-danger"):(removeClass="text-danger",addClass="text-success"),rHelper.data.products[factoryId].turnover=turnover,target.removeClass(removeClass).addClass(addClass),target.text(turnover.toLocaleString("en-US"))},INSRT_factoryHighlightColumns:function INSRT_factoryHighlightColumns(){var subArray,columns=["#factories-upgrade-cost-","#factories-increase-per-upgrade-","#factories-roi-","#diamond-profit-"];$.each(columns,function(i,column){switch(i){case 0:subArray="upgradeCost";break;case 1:subArray="turnoverIncrease";break;case 2:subArray="roi";break;case 3:subArray=[]}var valueArray=[],idArray=[];$.each(rHelper.data.products,function(k,factory){$(column+k).removeClass("text-success text-danger");var value=0;value="object"==(void 0===subArray?"undefined":_typeof(subArray))?factory.diamond.profit:factory[subArray],rHelper.data.products[k].turnover>0&&value!=-1/0&&value!=1/0&&value>0&&(valueArray.push(value),idArray.push(k))});var _ref20=[idArray[valueArray.indexOf(valueArray.min())],idArray[valueArray.indexOf(valueArray.max())]],arrayMin=_ref20[0],arrayMax=_ref20[1];switch(i){case 0:case 2:$(column+arrayMin).addClass("text-success"),arrayMin!=arrayMax&&$(column+arrayMax).addClass("text-danger");break;case 1:case 3:$(column+arrayMax).addClass("text-success"),arrayMin!=arrayMax&&$(column+arrayMin).addClass("text-danger")}})},INSRT_factoryROI:function INSRT_factoryROI(factoryId){var _ref21=[$("#factories-roi-"+factoryId),rHelper.methods.CALC_factoryROI(factoryId)],target=_ref21[0],roi=_ref21[1];rHelper.data.products[factoryId].roi=roi,roi=roi<0||roi===1/0?"∞":roi.toFixed(2),target.text(roi.toLocaleString("en-US"))},INSRT_factoryTurnoverPerUpgrade:function INSRT_factoryTurnoverPerUpgrade(factoryId){var _ref22=[$("#factories-increase-per-upgrade-"+factoryId),rHelper.methods.CALC_factoryTurnoverPerUpgrade(factoryId)],target=_ref22[0],turnoverPerUpgrade=_ref22[1];rHelper.data.products[factoryId].turnoverIncrease=turnoverPerUpgrade,target.text(turnoverPerUpgrade.toLocaleString("en-US"))},INSRT_API_remainingCredits:function INSRT_API_remainingCredits(value){value&&$("#api-credits").text(value.toLocaleString("en-US")+" Credits left")},INSRT_diamondFactoryOutput:function INSRT_diamondFactoryOutput(factoryId){$("#diamond-product-"+factoryId).text(rHelper.methods.CALC_diamondFactoryOutput(factoryId).toLocaleString("en-US"))},INSRT_diamondFactoryOutputWarehouse:function INSRT_diamondFactoryOutputWarehouse(factoryId){var diamondFactoryOutput=rHelper.methods.CALC_diamondFactoryOutput(factoryId),requiredWarehouseLevel=rHelper.methods.CALC_nextGreaterWarehouseLevel(diamondFactoryOutput);$("#diamond-product-warehouse-"+factoryId).text(requiredWarehouseLevel.toLocaleString("en-US"))},INSRT_diamondDependenciesHelper:function INSRT_diamondDependenciesHelper(dependantObj,price,requiredAmount,factoryId,warehouseIconSpan){var requiredWarehouseLevel=rHelper.methods.CALC_nextGreaterWarehouseLevel(requiredAmount);rHelper.data.products[factoryId].diamond.dependenciesWorth+=price*requiredAmount;var imgSpan=$(crEl("span")).addClass(dependantObj.icon).attr("title",price.toLocaleString("en-US")),innerSpan=$(crEl("span")).text(requiredAmount.toLocaleString("en-US")),warehouseSamp=$(crEl("span")).text(requiredWarehouseLevel),kbd=$(crEl("kbd")).append(warehouseIconSpan[0].outerHTML+" "+warehouseSamp[0].outerHTML),outerSpan;return $(crEl("span")).append(imgSpan[0].outerHTML+" "+innerSpan[0].outerHTML+" "+kbd[0].outerHTML+" ")[0].outerHTML},INSRT_diamondDependencies:function INSRT_diamondDependencies(factoryId){var product,_ref23=[rHelper.data.products[factoryId].dependencies,"",$(crEl("span")).addClass("nav-icon-warehouses")],dependencies=_ref23[0],dependencyString=_ref23[1],warehouseIconSpan=_ref23[2];if($.isArray(dependencies))$.each(dependencies,function(dependencyIndex,dependency){var _ref24=[rHelper.methods.CALC_convertId(dependency),rHelper.methods.CALC_returnPriceViaId(dependency),5*rHelper.methods.CALC_factoryDependencyRequiredAmount(factoryId,dependencyIndex)*24],dependantObj=_ref24[0],price=_ref24[1],requiredAmount=_ref24[2];dependencyString+=rHelper.methods.INSRT_diamondDependenciesHelper(dependantObj,price,requiredAmount,factoryId,warehouseIconSpan)});else{var _ref25=[rHelper.methods.CALC_convertId(dependencies),rHelper.methods.CALC_returnPriceViaId(dependencies),5*rHelper.methods.CALC_factoryDependencyRequiredAmount(factoryId,0)*24],dependantObj=_ref25[0],price=_ref25[1],requiredAmount=_ref25[2];dependencyString+=rHelper.methods.INSRT_diamondDependenciesHelper(dependantObj,price,requiredAmount,factoryId,warehouseIconSpan)}$("#diamond-dependencies-"+factoryId).html(dependencyString)},INSRT_diamondEfficiency:function INSRT_diamondEfficiency(factoryId){$("#diamond-efficiency-"+factoryId).text((100*rHelper.methods.CALC_diamondEfficiency(factoryId)).toFixed(2).toLocaleString("en-US")+"%")},INSRT_diamondProfit:function INSRT_diamondProfit(factoryId){$("#diamond-profit-"+factoryId).text(rHelper.methods.CALC_diamondProfit(factoryId).toLocaleString("en-US"))},INSRT_diamondFactoryLevel:function INSRT_diamondFactoryLevel(factoryId){$("#diamond-level-"+factoryId).text(rHelper.data.products[factoryId].factoryLevel)},INSRT_diamondTop10Profit:function INSRT_diamondTop10Profit(){var top10Profit=rHelper.methods.CALC_diamondTop10Profit().toLocaleString("en-US");$("#diamond-top-10").text(top10Profit)},INSRT_diamondTotalProfit:function INSRT_diamondTotalProfit(){var totalProfit=rHelper.methods.CALC_diamondTotalProfit().toLocaleString("en-US");$("#diamond-total").text(totalProfit)},INSRT_flowRate:function INSRT_flowRate(id,type){var _ref26=[$("#flow-"+type+"-rate-"+id),rHelper.methods.CALC_flowRate(id,type)],target=_ref26[0],rate=_ref26[1];"product"==type&&rHelper.data.products[id].turnover<0&&(rate=0),target.text(rate.toLocaleString("en-US"))},INSRT_flowDistributionGlobal:function INSRT_flowDistributionGlobal(){var materialTotal=0,productsTotal=0,materialColor="yellowgreen",productColor="yellowgreen";$.each(rHelper.data.material,function(materialId){materialTotal+=rHelper.methods.INSRT_flowDistributionSingle(materialId,"material")});var calculationOrder=rHelper.methods.GET_calculationOrder();$.each(calculationOrder,function(index,factoryId){productsTotal+=rHelper.methods.INSRT_flowDistributionSingle(factoryId,"product")}),materialTotal<0&&(materialColor="coral"),productsTotal<0&&(productColor="coral"),rHelper.data.material.totalIncomePerHour=materialTotal,rHelper.data.products.totalIncomePerHour=productsTotal,$("#flow-material-total").text(materialTotal.toLocaleString("en-US")).css("color",materialColor),$("#flow-products-total").text(productsTotal.toLocaleString("en-US")).css("color",productColor),$("#effective-hourly-income").text((materialTotal+productsTotal).toLocaleString("en-US"))},INSRT_flowSurplus:function INSRT_flowSurplus(id,type,remainingAmount){var surplusTarget=$("#flow-"+type+"-surplus-"+id),color="#dedede";remainingAmount<=0&&(color="coral"),surplusTarget.css("color",color),surplusTarget.html('<span class="resources-'+type+"-"+id+'"></span> '+remainingAmount.toLocaleString("en-US"))},INSRT_flowDistributionSingle:function INSRT_flowDistributionSingle(id,type){var _ref27=[$("#flow-"+type+"-worth-"+id),0,0,"yellowgreen",0,rHelper.methods.CALC_flowDistribution(id,type)],worthTarget=_ref27[0],price=_ref27[1],worth=_ref27[2],color=_ref27[3],productionCost=_ref27[4],remainingAmount=_ref27[5];switch(type){case"material":price=rHelper.methods.CALC_returnPriceViaId(id);break;case"product":price=rHelper.methods.CALC_returnPriceViaId(id+14)}switch("product"==type&&(rHelper.data.products[id].turnover<0?(remainingAmount*=-1,""==rHelper.data.products[id].dependantFactories&&(remainingAmount=0)):productionCost=rHelper.methods.CALC_factoryCashCostPerHour(id)),worth=remainingAmount*price,remainingAmount<0&&(worth*=rHelper.data.buildings[9].transportCost,color="coral"),worth=Math.round(worth-productionCost),type){case"material":rHelper.data.material[id].effectiveTurnover=worth;break;case"product":rHelper.data.products[id].effectiveTurnover=worth}return worthTarget.css("color",color).text(worth.toLocaleString("en-US")),rHelper.methods.INSRT_flowSurplus(id,type,remainingAmount),worth},INSRT_warehouseFillAmount:function INSRT_warehouseFillAmount(id,type){$("#warehouse-"+type+"-stock-current-"+id).val(rHelper.data[type][id].warehouse.fillAmount)},INSRT_warehouseLevel:function INSRT_warehouseLevel(id,type){var warehouseLevel=rHelper.data[type][id].warehouse.level;$("#warehouse-"+type+"-level-"+id).val(warehouseLevel),$("#warehouse-"+type+"-stock-current-"+id).attr("max",rHelper.methods.CALC_warehouseContingent(warehouseLevel))},INSRT_warehouseFillStatus:function INSRT_warehouseFillStatus(id,type){var target=$("#warehouse-"+type+"-fill-percent-"+id),percent=(100*rHelper.data[type][id].warehouse.fillStatus).toFixed(2),color="rgb(255, 38, 41)";percent<75?color="rgb(70, 252, 6)":percent>=75&&percent<90?color="rgb(255, 252, 38)":percent>=90&&percent<95&&(color="rgb(255, 155, 38)"),target.text(percent).css("color",color)},INSRT_warehouseCapacity:function INSRT_warehouseCapacity(id,type){$("#warehouse-"+type+"-stock-cap-"+id).text(rHelper.data[type][id].warehouse.contingent.toLocaleString("en-US"))},INSRT_warehouseWorth:function INSRT_warehouseWorth(id,type){var price,worth=rHelper.methods.CALC_warehouseWorth(id,type)*rHelper.data[type][id].warehouse.fillAmount;$("#warehouse-"+type+"-worth-"+id).text(worth.toLocaleString("en-US"))},INSRT_warehouseTotalWorth:function INSRT_warehouseTotalWorth(){var warehouseTotalWorth=rHelper.methods.CALC_warehouseTotalWorth();$("#warehouse-total-worth").text(warehouseTotalWorth.toLocaleString("en-US"))},INSRT_warehouseTotalLevel:function INSRT_warehouseTotalLevel(){var warehouseTotalLevel=rHelper.methods.CALC_warehouseTotalLevel();$("#warehouse-total-level").text(warehouseTotalLevel.toLocaleString("en-US"))},INSRT_warehouseRemainingTimeToFull:function INSRT_warehouseRemainingTimeToFull(id,type){var remainingTime=rHelper.methods.CALC_warehouseRemainingTimeToFull(id,type);$("#warehouse-"+type+"-remaining-"+id).text(remainingTime)},INSRT_warehouseUpgradeCost:function INSRT_warehouseUpgradeCost(id,type,value){var target=$("#warehouse-"+type+"-upgrade-cost-"+id),upgradeCost=rHelper.methods.CALC_warehouseUpgradeCostOnInput(id,type,value);target.text(upgradeCost.toLocaleString("en-US"))},INSRT_buildingName:function INSRT_buildingName(buildingId){$("#buildings-name-"+buildingId).text(rHelper.data.buildings[buildingId].name)},INSRT_buildingData:function INSRT_buildingData(buildingId){var building=rHelper.data.buildings[buildingId],buildingLevel=building.level,dropdown=$("#buildings-level-"+buildingId);parseInt(dropdown.val())!=buildingLevel&&$(dropdown[0][buildingLevel]).attr("selected","true");var materialWorthSum=0,materialTransportationSum=0;if(10!=buildingLevel){rHelper.methods.SET_buildingTableVisibility(buildingId,"show");for(var i=0;i<=3;i+=1)if(0===i){var cashTarget=$("#buildings-cash-"+buildingId),cash=building.materialAmount0[buildingLevel];void 0===cash&&(cash=0),materialWorthSum+=cash,cashTarget.text(cash.toLocaleString("en-US"))}else{var selector="materialAmount"+i,material=rHelper.methods.CALC_convertId(building.material[i]);$("#buildings-mat-"+i+"-"+buildingId).addClass(material.icon);var materialAmount=building[selector][buildingLevel];if("number"==typeof materialAmount){$("#buildings-amount-"+i+"-"+buildingId).text(materialAmount.toLocaleString("en-US"));var materialPrice,materialWorth=rHelper.methods.CALC_returnPriceViaId(building.material[i])*materialAmount,transportation=(rHelper.data.buildings[9].transportCost-1)*materialWorth;materialWorthSum+=materialWorth,materialTransportationSum+=transportation,$("#buildings-worth-"+i+"-"+buildingId).text(materialWorth.toLocaleString("en-US")),$("#buildings-transportation-"+i+"-"+buildingId).text(transportation.toLocaleString("en-US"))}}}else rHelper.methods.SET_buildingTableVisibility(buildingId,"hide");$("#buildings-sum-"+buildingId).text(materialWorthSum.toLocaleString("en-US")),$("#buildings-transportation-sum-"+buildingId).text(Math.round(materialTransportationSum).toLocaleString("en-US"))},INSRT_buildingToLevel10:function INSRT_buildingToLevel10(buildingId){var buildingToLevel10=rHelper.methods.CALC_buildingToLevel10(buildingId);$("#buildings-cap-"+buildingId).text(buildingToLevel10.level10Cost.toLocaleString("en-US")),$("#buildings-transportation-cap-"+buildingId).text(buildingToLevel10.level10Transportation.toLocaleString("en-US"))},INSRT_techUpgradeRows:function INSRT_techUpgradeRows(tu4Trigger){var iterateTUData=function iterateTUData(){$.each(rHelper.tu,function(index,combination){if(void 0!==tu4Trigger||0==combination.tu4){for(var tr=$(crEl("tr")),i=0;i<=6;i+=1){var td=$(crEl("td"));td.addClass("text-md-right text-sm-left");var tus=[combination.tu1,combination.tu2,combination.tu3,combination.tu4];switch(i){case 0:case 1:case 2:case 3:td.text(tus[i]).attr("data-th","Tech-Upgrade "+i);break;case 4:td.text(combination.factor).attr("data-th","Boost");break;case 5:for(var price=0,k=0;k<tus.length;k+=1)price+=tus[k]*prices[k];td.text(price.toLocaleString("en-US")).attr("data-th","Price");break;case 6:var count=1*tus[0]+2*tus[1]+3*tus[2]+5*tus[3];td.text(count).attr("data-th","Pimp my mine count")}tr.append(td[0])}techUpgradeTbody.append(tr[0])}})},techUpgradeTbody=$("#techupgrades-combinations-tbl tbody");techUpgradeTbody[0].childNodes.length>0&&techUpgradeTbody.empty();for(var prices=[],i=46;i<=49;i+=1)prices.push(rHelper.methods.CALC_returnPriceViaId(i,0));0==rHelper.tu.length?$.getJSON("api/tu.json",function(data){rHelper.tu=data,iterateTUData()}):iterateTUData()},INSRT_techUpgradeCalculator:function INSRT_techUpgradeCalculator(value,tu4Inclusion){toggleTechUpgradeInfo("start");var table=$("#techupgrades-calc-tbl");"none"==table.css("display")&&table.css("display","table");var target=$("#techupgrades-calc-tbl tbody");target.empty();var url="api/getTechCombination.php?factor="+value;"string"==typeof tu4Inclusion&&(url+="&tu4=allowed"),$.getJSON(url,function(data){for(var prices=[],i=46;i<=49;i+=1)prices.push(rHelper.methods.CALC_returnPriceViaId(i,0));$.each(data,function(i,combination){for(var tr=$(crEl("tr")),k=0;k<=6;k+=1){var td=$(crEl("td"));td.addClass("text-md-right text-sm-left"),td.attr("data-th","missing Tech-Upgrade "+(k+1));var tus=[combination.tu1,combination.tu2,combination.tu3,combination.tu4];switch(k){case 0:case 1:case 2:case 3:td.text(tus[k]);break;case 4:td.text(combination.factor).attr("data-th","resulting Boost");break;case 5:for(var price=0,l=0;l<tus.length;l+=1)price+=tus[l]*prices[l];td.text(price.toLocaleString("en-US")).attr("data-th","Price");break;case 6:var count=1*tus[0]+2*tus[1]+3*tus[2]+5*tus[3];td.text(count).attr("data-th","remaining Pimp my mine count")}tr.append(td)}target.append(tr)}),sorttable.makeSortable(table[0]),sorttable.innerSortFunction.apply($("#techupgrades-calc-tbl th")[5],[]),sorttable.innerSortFunction.apply($("#techupgrades-calc-tbl th")[5],[]),toggleTechUpgradeInfo("end")}).fail(function(){var tr=$(crEl("tr")),td=$(crEl("td"));td.addClass("text-warning text-center").attr("data-th","Attention").attr("colspan",7).text("No entries found or invalid value. Try to lower the value a bit – up to 5 decimals are allowed (e.g. 3.00005)."),tr.append(td),target.append(tr),toggleTechUpgradeInfo("end")})},INSRT_recyclingRequirement:function INSRT_recyclingRequirement(lootId){$("#recycling-requirement-"+lootId).text(rHelper.methods.CALC_recyclingRequirement(lootId).toLocaleString("en-US"))},INSRT_recyclingProducts:function INSRT_recyclingProducts(lootId){var recyclingPlantLevel=rHelper.data.buildings[5].level,recyclingProducts=rHelper.methods.CALC_recyclingProducts(lootId,recyclingPlantLevel);$("#recycling-products-"+lootId).html(recyclingProducts)},INSRT_recyclingOutputWorth:function INSRT_recyclingOutputWorth(lootId){var recyclingPlantLevel=rHelper.data.buildings[5].level;$("#recycling-output-"+lootId).text(rHelper.methods.CALC_recyclingOutputWorth(lootId,recyclingPlantLevel).toLocaleString("en-US"))},INSRT_recyclingInputWorth:function INSRT_recyclingInputWorth(lootId){$("#recycling-input-"+lootId).text(rHelper.methods.CALC_recyclingInputWorth(lootId).toLocaleString("en-US"))},INSRT_unitsRecyclingProfit:function INSRT_unitsRecyclingProfit(type,id){var target=$("#"+type+"-profit-"+id),profit=0,result=void 0,color=void 0;"recycling"==type?profit=rHelper.methods.CALC_recyclingProfit(id):"units"==type&&(profit=rHelper.methods.CALC_unitsProfit(id)),color=profit>0?"#9acd3225":"#ff7f5025",$(target[0].parentNode).css("background-color",color),result=profit.toFixed(2).toLocaleString("en-US")+"%",target.text(result)},INSRT_unitsCraftingPrice:function INSRT_unitsCraftingPrice(unitId){$("#units-crafting-"+unitId).text(rHelper.methods.CALC_unitsCraftingPrice(unitId).toLocaleString("en-US"))},INSRT_unitsPricePerStrength:function INSRT_unitsPricePerStrength(unitId){$("#units-pps-"+unitId).text(rHelper.methods.CALC_unitsPricePerStrength(unitId).toLocaleString("en-US"))},INSRT_unitsMarketPrice:function INSRT_unitsMarketPrice(unitId){var convertedId=unitId+52,marketPrice=rHelper.methods.CALC_returnPriceViaId(convertedId);rHelper.data.units[unitId].profit.marketPrice=marketPrice,$("#units-market-"+unitId).text(marketPrice.toLocaleString("en-US"))},INSRT_companyWorth:function INSRT_companyWorth(){var companyWorth=rHelper.methods.CALC_companyWorth();$("#company-worth").text(companyWorth.toLocaleString("en-US"))},INSRT_headquarterOvwTransportation:function INSRT_headquarterOvwTransportation(level){var hqLevel=rHelper.data.headquarter[level];if($.isArray(hqLevel.material)){var hqCost=rHelper.methods.CALC_headquarterLevelCost(level),transportation=Math.round(hqCost*(rHelper.data.buildings[9].transportCost-1));$("#hq-ovw-transportation-"+level).text(transportation.toLocaleString("en-US"))}},INSRT_headquarterOvwCost:function INSRT_headquarterOvwCost(level){var hqCost=rHelper.methods.CALC_headquarterLevelCost(level);$("#hq-ovw-sum-"+level).text(hqCost.toLocaleString("en-US"))},INSRT_headquarterOvwRadius:function INSRT_headquarterOvwRadius(level){var hqLevel=rHelper.data.headquarter[level];$("#hq-ovw-radius-"+level).text(hqLevel.radius+" m | "+rHelper.methods.CALC_convertMeterToYards(hqLevel.radius)+" yards")},INSRT_headquarterOvwBoost:function INSRT_headquarterOvwBoost(level){var hqLevel=rHelper.data.headquarter[level];$("#hq-ovw-boost-"+level).text(hqLevel.boost)},INSRT_headquarterOvwString:function INSRT_headquarterOvwString(level){var hqLevel=rHelper.data.headquarter[level];if($.isArray(hqLevel.material)){var string=rHelper.methods.CALC_headquarterOvwMaterial(level)+" x "+hqLevel.amount.toLocaleString("en-US");$("#hq-ovw-mat-"+level).html(string)}},INSRT_headquarterContentRequiredAmount:function INSRT_headquarterContentRequiredAmount(level){var hqContent=$("#hq-content");if(10!=level){hqContent.css("display","block");var headquarter=rHelper.data.headquarter[level],amount=headquarter.amount;$.each(headquarter.material,function(i,material){var icon=rHelper.methods.CALC_headquarterContentIcon(material),span=rHelper.methods.CALC_headquarterContentRequiredAmount(amount);$("#hq-content-icon-"+i).html(icon),$("#hq-content-requirement-"+i).html(span)})}else hqContent.css("display","none")},INSRT_headquarterPaid:function INSRT_headquarterPaid(){var paid=rHelper.data.headquarter.user.paid;$.each(paid,function(i,amount){$("#hq-content-input-"+i).val(amount)})},INSRT_headquarterMissing:function INSRT_headquarterMissing(i){var userHqLevel=rHelper.data.headquarter.user.level;if(10!=userHqLevel){var requiredAmount,paid,missing=rHelper.data.headquarter[userHqLevel].amount-rHelper.data.headquarter.user.paid[i];missing<0&&(missing=0),$("#hq-content-missing-"+i).text(missing.toLocaleString("en-US"))}},INSRT_headquarterRemainingCost:function INSRT_headquarterRemainingCost(userHqLevel){if(10!=userHqLevel){var headquarter=rHelper.data.headquarter[userHqLevel],totalCost=0,totalTransportation=0;$.each(headquarter.material,function(i,material){var worth=rHelper.methods.CALC_headquarterRemainingCost(i,material,userHqLevel);totalCost+=worth;var transportation=Math.round(worth*(rHelper.data.buildings[9].transportCost-1));totalTransportation+=transportation,$("#hq-content-cost-"+i).text(worth.toLocaleString("en-US")),$("#hq-content-transportation-"+i).text(transportation.toLocaleString("en-US"))}),rHelper.methods.INSRT_headquarterTotalCost(totalCost),rHelper.methods.INSRT_headquarterTotalTransportation(totalTransportation)}},INSRT_headquarterTotalCost:function INSRT_headquarterTotalCost(sum){$("#hq-content-cost-sum").text(sum.toLocaleString("en-US"))},INSRT_headquarterTotalTransportation:function INSRT_headquarterTotalTransportation(sum){$("#hq-content-transportation-sum").text(sum.toLocaleString("en-US"))},INSRT_priceHistoryName:function INSRT_priceHistoryName(type,id){$("#pricehistory-"+type+"-"+id).text(rHelper.data[type][id].name)},INSRT_qualityComparator:function INSRT_qualityComparator(type,quality){type&&null!=type||(type=0),quality?quality/=100:quality=1;var price,worth=rHelper.methods.CALC_returnPriceViaId(type)*rHelper.data.material[type].maxRate*quality;$("#qualitycomparator-income").text(worth.toLocaleString("en-US")),$.each(rHelper.data.material,function(i,material){var qualityTarget=$("#qualitycomparator-"+i),parentElement=$(qualityTarget[0].parentNode.parentNode),thisPrice=rHelper.methods.CALC_returnPriceViaId(i),thisMaxRate=material.maxRate,thisResourcesRequiredAmount=worth/thisPrice;if(i==type||thisResourcesRequiredAmount>thisMaxRate)parentElement.css("opacity",.1);else{parentElement.css("opacity",1);var percent=(thisResourcesRequiredAmount/thisMaxRate*100).toFixed(2);qualityTarget.text(percent+" %")}})},INSRT_missions:function INSRT_missions(){var missionContainer=rHelper.data.missions;if(0!=missionContainer.length){var now=Math.round(Date.now()/1e3),calculateMissionCost=function calculateMissionCost(i,mission){var uncalculatableMissions,requirementId=0,materialCost=0,missionCost=0;if(-1==[9,12,17,21,22,25,30,31,32,35,37,38,41,42,43,44,50,55].indexOf(i))switch(i){case 10:missionCost+=rHelper.data.units[5].profit.craftingPrice*mission.goal;break;case 11:case 26:case 28:case 31:case 39:26==i?requirementId=29:28==i?requirementId=21:31==i?requirementId=20:39==i&&(requirementId=25),missionCost+=(materialCost=rHelper.methods.CALC_returnPriceViaId(requirementId)*mission.goal)*rHelper.data.buildings[9].transportCost-materialCost;break;case 14:missionCost+=rHelper.methods.CALC_currentScanCost()*mission.goal;break;case 33:var calcSmallestUnitPrice;missionCost+=function calcSmallestUnitPrice(){var min=1/0;return $.each(rHelper.data.units,function(i,unit){if(1==i||4==i||5==i){var _ref28=[unit.profit.craftingPrice,unit.profit.marketPrice*rHelper.data.buildings[9].transportCost,0],craftingPrice=_ref28[0],marketPrice=_ref28[1],result=_ref28[2];(result=marketPrice>craftingPrice?craftingPrice:marketPrice)<min&&(min=result)}}),min}()*mission.goal;break;case 45:missionCost+=mission.goal/5*100}return missionCost},calculateMissionReward=function calculateMissionReward(i,mission){var _ref29=[mission.rewardId,0],rewardId=_ref29[0],rewardWorth=_ref29[1];if(-1!=rewardId){$("#mission-reward-"+i).addClass(rHelper.methods.CALC_convertId(rewardId).icon);var price=rHelper.methods.CALC_returnPriceViaId(rewardId);rewardWorth+=mission.rewardAmount*price}else $("#mission-reward-"+i).html('<img src="assets/img/cash.png" alt="Cash" />'),rewardWorth+=mission.rewardAmount;return rewardWorth},returnWorthColor=function returnWorthColor(missionWorth){var color="coral";return missionWorth>0&&(color="yellowgreen"),color},insertMissionReward=function insertMissionReward(i,mission){var parsedI=parseInt(i),rewardWorth,missionCost,missionWorth=calculateMissionReward(i,mission)-calculateMissionCost(parsedI,mission),color=returnWorthColor(missionWorth);isNaN(missionWorth)&&(missionWorth=0),50!=parsedI&&55!=parsedI&&31!=parsedI&&$("#mission-profit-"+i).text(missionWorth.toLocaleString("en-US")).css("color",color)},colorProgress=function colorProgress(progressPercent){var color="coral";return progressPercent>33&&progressPercent<66?color="orange":progressPercent>=66&&(color="yellowgreen"),color},returnMissionProgress=function returnMissionProgress(progress,goal){return progress/goal*100},calculateRemainingDuration=function calculateRemainingDuration(now,finish){var remainingDuration=finish-now;return remainingDuration<60?remainingDuration+"s":remainingDuration>=60&&remainingDuration<3600?(remainingDuration/60).toFixed(2)+"m":remainingDuration>=3600&&remainingDuration<86400?(remainingDuration/3600).toFixed(2)+"h":(remainingDuration/86400).toFixed(2)+"d"},fadeOutMission=function fadeOutMission(i,mission){var cooldown=calculateRemainingDuration(now,mission.cooldown);$("#mission-progress-"+i).attr("colspan",3).html('Mission on cooldown for <span style="color: orange;">'+cooldown+"</span>").css("text-align","center"),$("#mission-start-"+i).remove(),$("#mission-end-"+i).remove(),$("#mission-"+i).addClass("faded-mission")},highlightAvailableMission=function highlightAvailableMission(i){$("#mission-"+i).addClass("yellowgreen-10")},insertMissionConstants=function insertMissionConstants(i,mission){$("#mission-duration-"+i).text(mission.duration/24),$("#mission-interval-"+i).text(mission.intervalDays),mission.goal&&($("#mission-goal-"+i).text(mission.goal.toLocaleString("en-US")),$("#mission-penalty-"+i).text(mission.penalty.toLocaleString("en-US")),$("#mission-reward-amount-"+i).text(mission.rewardAmount.toLocaleString("en-US")))},onActiveMission=function onActiveMission(i,mission){var progressPercent=returnMissionProgress(mission.progress,mission.goal);$("#mission-progress-bar-"+i).css({width:progressPercent+"%","background-color":colorProgress(progressPercent)}),$("#mission-start-"+i).text(rHelper.methods.CALC_convertDateToIso(rHelper.methods.CALC_toMilliseconds(mission.startTimestamp))),$("#mission-end-"+i).text(calculateRemainingDuration(now,mission.endTimestamp))},onPassiveMission=function onPassiveMission(i){$("#mission-progress-wrap-"+i).css("display","none")},checkForMissionStatus=function checkForMissionStatus(i,mission){1==mission.status?onActiveMission(i,mission):onPassiveMission(i,mission)};$.each(missionContainer,function(i,mission){insertMissionReward(i,mission),insertMissionConstants(i,mission),mission.cooldown>now?fadeOutMission(i,mission):highlightAvailableMission(i),checkForMissionStatus(i,mission)})}},CALC_attackLogDetailedUnitStringInsertion:function CALC_attackLogDetailedUnitStringInsertion(type,container){var _ref30=[""],content=_ref30[0],unitArray=_ref30[1];return"offense"==type?unitArray=[0,2,3]:"defense"==type&&(unitArray=[5,4,1]),$.each(container,function(i,unitAmount){0!=unitAmount&&(content+=' <span class="resources-unit-'+unitArray[i]+'"></span> '+unitAmount.toLocaleString("en-US"))}),content},CALC_attackLogDetailedDatasetIteration:function CALC_attackLogDetailedDatasetIteration(i,dataset,dataTHs){for(var _ref31=[$(crEl("tr")).addClass(rHelper.methods.CALC_attackLogSetTRColor(dataset.result)),"text-md-right text-sm-left","bg-success-25"],tr=_ref31[0],textOrientation=_ref31[1],factorBgColorClass=_ref31[2],index=0;index<=6;index+=1){var td=$(crEl("td")).attr("data-th",dataTHs[index]);switch(index){case 0:td.text(dataset.target+" ("+dataset.targetLevel+")");break;case 1:td.html(rHelper.methods.CALC_attackLogDetailedCoordsTimestampString(dataset));break;case 2:td.html(rHelper.methods.CALC_attackLogDetailedUnitStringInsertion("offense",dataset.offense.units)).addClass("text-sm-left text-md-center");break;case 3:td.html(rHelper.methods.CALC_attackLogDetailedUnitStringInsertion("defense",dataset.defense.units)).addClass("text-sm-left text-md-center");break;case 4:dataset.factor<100&&(factorBgColorClass="bg-warning-25"),td.text(dataset.factor.toLocaleString("en-US")+"%").addClass(textOrientation+" "+factorBgColorClass);break;case 5:td.html(rHelper.methods.CALC_attackLogDetailedLootString(dataset.loot));break;case 6:var _ref32=[dataset.profit,dataset.result,"#dedede"],profit=_ref32[0],result=_ref32[1],profitColor=_ref32[2];(profit<0&&result||!result)&&(profitColor="coral"),td.text(profit.toLocaleString("en-US")).addClass(textOrientation).css("color",profitColor)}tr.append(td)}return tr},CALC_attackLogSetTRColor:function CALC_attackLogSetTRColor(result){var colorClass="bg-success-25";return(!result||result<0)&&(colorClass="bg-warning-25"),colorClass},CALC_attackLogDetailedCoordsTimestampString:function CALC_attackLogDetailedCoordsTimestampString(dataset){var _ref33=[dataset.coordinates.lat+", "+dataset.coordinates.lon,rHelper.methods.CALC_convertDateToIso(dataset.attackedAt)],coords=_ref33[0],timestamp,a;return _ref33[1]+" | "+('<a href="https://www.google.com/maps/search/'+coords+'" target="_blank" rel="noopener nofollow noreferrer">'+coords+"</a>")},CALC_attackLogDetailedPageButtonToggler:function CALC_attackLogDetailedPageButtonToggler(type,dataContainer){var _ref34=[$("#attacklog-detailed-"+type),"btn-success"],button=_ref34[0],success=_ref34[1];"last"==type?0==dataContainer.skipCount?button.attr("disabled",!0).removeClass(success):button.attr("disabled",!1).addClass(success):"next"==type&&(dataContainer.maxLength>dataContainer.skipCount+100?button.addClass(success).attr("disabled",!1):button.removeClass(success).attr("disabled",!0))},CALC_attackLogDetailedLootString:function CALC_attackLogDetailedLootString(lootContainer){var lootString="";return $.each(lootContainer,function(index,iteration){var _ref35=[iteration.type,""],type=_ref35[0],icon=_ref35[1];icon=-1==type?'<img src="assets/img/cash.png" alt="Cash" />':'<span class="'+rHelper.methods.CALC_convertId(type).icon+'"></span>',lootString+=icon+" "+iteration.amount.toLocaleString("en-US")+" "}),lootString},CALC_convertDateToIso:function CALC_convertDateToIso(milliseconds){var tzoffset=6e4*new Date(milliseconds).getTimezoneOffset(),date=new Date(milliseconds-tzoffset).toISOString().slice(0,-1).match(/(\d{4}\-\d{2}\-\d{2})T(\d{2}:\d{2}:\d{2})/);return date[1]+" "+date[2]},CALC_currentScanCost:function CALC_currentScanCost(){var _ref36=[rHelper.data.buildings[0].level,rHelper.methods.CALC_totalMineCount()],techCenterLevel=_ref36[0],mineCount=_ref36[1];return 5e3*Math.round(1e4*Math.pow(2.4,techCenterLevel)*(1+mineCount/1e3)/5e3)},CALC_toMilliseconds:function CALC_toMilliseconds(unix){return 1e3*unix},CALC_mineEstRevenue:function CALC_mineEstRevenue(subObj,type,age){return Math.round(subObj.fullRate*rHelper.methods.CALC_returnPriceViaId(type,8)*age*24*subObj.HQBoost)},CALC_createMapContentString:function CALC_createMapContentString(relObj,buildDate,age,estRevenue,subObj){var quality=100*subObj.quality;return'<div>\n        <h1 class="firstHeading">'+relObj.name+"</h1>\n        <div>\n        <p><strong>Built:</strong> "+buildDate+"</p>\n        <p><strong>Age (days)</strong>: "+age.toFixed(2)+"</p>\n        <p><strong>Estimated revenue (condition always 100%):</strong> "+estRevenue.toLocaleString("en-US")+'</p>\n        <table class="table table-break-medium mb-3 text-center">\n        <thead>\n        <tr>\n          <th>Raw rate</th>\n          <th>Full rate</th>\n          <th>Tech factor</th>\n          <th>Quality</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr>\n          <td>'+subObj.rawRate.toLocaleString("en-US")+"</td>\n          <td>"+subObj.fullRate.toLocaleString("en-US")+"</td>\n          <td>"+subObj.techFactor.toLocaleString("en-US")+"</td>\n          <td>"+quality.toFixed(2)+"% => "+(quality*subObj.techFactor).toFixed(2)+" %</td>\n        </tr>\n        </tbody>\n        </table>\n        </div>\n        </div>"},CALC_headquarterRemainingCost:function CALC_headquarterRemainingCost(i,material,userHqLevel){var _ref37=[rHelper.methods.CALC_returnPriceViaId(material),rHelper.data.headquarter[userHqLevel].amount-rHelper.data.headquarter.user.paid[i]],price,missing=_ref37[1];return missing<0&&(missing=0),_ref37[0]*missing},CALC_headquarterContentIcon:function CALC_headquarterContentIcon(material){var container=$(crEl("span"));return container.addClass(rHelper.methods.CALC_convertId(material).icon),container[0].outerHTML},CALC_headquarterContentRequiredAmount:function CALC_headquarterContentRequiredAmount(amount){var span;return $(crEl("span")).html(amount.toLocaleString("en-US"))[0].outerHTML},CALC_convertMeterToYards:function CALC_convertMeterToYards(meter){return Math.round(1.09361*meter)},CALC_headquarterLevelCost:function CALC_headquarterLevelCost(level){var _ref38=[0,rHelper.data.headquarter[level]],cost=_ref38[0],hqLevel=_ref38[1];return $.isArray(hqLevel.material)&&$.each(hqLevel.material,function(k,material){cost+=hqLevel.amount*rHelper.methods.CALC_returnPriceViaId(material)}),cost},CALC_headquarterOvwMaterial:function CALC_headquarterOvwMaterial(level){var _ref39=[rHelper.data.headquarter[level],""],hqLevel=_ref39[0],string=_ref39[1];return $.isArray(hqLevel.material)&&$.each(hqLevel.material,function(k,material){var addClass=void 0;material<=13?addClass=rHelper.data.material[material].icon:material>=14&&material<=35?(material-=14,addClass=rHelper.data.products[material].icon):material>=36&&material<=51?(material-=36,addClass=rHelper.data.loot[material].icon):(material-=52,addClass=rHelper.data.units[material].icon);var span=$(crEl("span")).addClass(addClass);string+=span[0].outerHTML+" "}),string},CALC_totalBuildingErectionSum:function CALC_totalBuildingErectionSum(){var total=0;return $.each(rHelper.data.buildings,function(i,building){for(var _loop2=function _loop2(level){$.each(building.material,function(k,material){var materialAmount="materialAmount"+k;total+=-1!=material?rHelper.methods.CALC_returnPriceViaId(material)*building[materialAmount][level]:building[materialAmount][level]})},level=0;level<building.level;level+=1)_loop2(level)}),total},CALC_perfectWorth:function CALC_perfectWorth(type){var total=0;return"headquarter"==type?$.each(rHelper.data.headquarter,function(i,hqLevel){$.each(hqLevel.material,function(k,material){total+=hqLevel.amount*rHelper.methods.CALC_returnPriceViaId(material)})}):"buildings"==type&&$.each(rHelper.data.buildings,function(i,building){for(var _loop3=function _loop3(level){$.each(building.material,function(k,material){var materialAmount="materialAmount"+k;total+=-1!=material?rHelper.methods.CALC_returnPriceViaId(material)*building[materialAmount][level]:building[materialAmount][level]})},level=0;level<10;level+=1)_loop3(level)}),total},CALC_companyWorth:function CALC_companyWorth(){var companyWorth=0,fns=["CALC_totalHeadquarterErectionSum","CALC_totalBuildingErectionSum","CALC_totalFactoryErectionWorth","CALC_totalWarehouseErectionWorth","CALC_totalMineErectionSum"];return $.each(fns,function(i,fn){companyWorth+=rHelper.methods[fn]()}),companyWorth},CALC_totalHeadquarterErectionSum:function CALC_totalHeadquarterErectionSum(){var total=0,headquarter=rHelper.data.headquarter;if(headquarter.user){for(var userHq=headquarter.user,userHqLevel=userHq.level,_loop4=function _loop4(i){var hqLevel=rHelper.data.headquarter[i];$.each(hqLevel.material,function(k,material){total+=hqLevel.amount*rHelper.methods.CALC_returnPriceViaId(material)})},i=userHqLevel-1;i>=1;i-=1)_loop4(i);10!=userHqLevel&&$.each(userHq.paid,function(i,paid){if(0!=paid){var material=rHelper.data.headquarter[userHqLevel-1].material[i];total+=paid*rHelper.methods.CALC_returnPriceViaId(material)}})}return total},CALC_totalMineErectionSum:function CALC_totalMineErectionSum(){var total=0,totalMines=rHelper.methods.CALC_totalMineCount();return $.each(rHelper.data.material,function(i,material){total+=material.basePrice*(1+.01*totalMines)*material.amountOfMines}),Math.round(total)},CALC_totalWarehouseErectionWorth:function CALC_totalWarehouseErectionWorth(){var total=0,subArrays=["material","products","loot","units"];return $.each(subArrays,function(i,index){$.each(rHelper.data[index],function(k,obj){for(var _k=1;_k<=obj.warehouse.level;_k+=1)total+=125e4*Math.pow(_k-1,2)})}),total},CALC_totalFactoryErectionWorth:function CALC_totalFactoryErectionWorth(){var total=0;return $.each(rHelper.data.products,function(i,factory){for(var _loop5=function _loop5(level){$.each(factory.upgradeMaterial,function(k,material){var value=Math.pow(level,2)*factory.upgradeMaterialAmount[k];total+=-1!=material?value*rHelper.methods.CALC_returnPriceViaId(material):value})},level=0;level<=factory.factoryLevel;level+=1)_loop5(level)}),total},CALC_unitsCraftingPrice:function CALC_unitsCraftingPrice(unitId){var unit=rHelper.data.units[unitId],worth=unit.prices.current.ai,requiredAmount=unit.requiredAmount,requirements=unit.requirements;$.each(requirements,function(index,requirement){var price=rHelper.methods.CALC_returnPriceViaId(requirement);worth+=price*requiredAmount[index]});var settings=rHelper.data.settings[3],transportCostInclusion=1;return void 0!==(void 0===settings?"undefined":_typeof(settings))&&(transportCostInclusion=rHelper.data.settings[3].value),1==transportCostInclusion&&(worth*=rHelper.data.buildings[9].transportCost),worth=Math.round(worth),unit.profit.craftingPrice=worth,worth},CALC_unitsPricePerStrength:function CALC_unitsPricePerStrength(unitId){var buildingLevel=0,strength=0,pricePerStrength=0,referencePrice=0,profitObj=rHelper.data.units[unitId].profit;switch(unitId){case 0:case 2:case 3:buildingLevel=rHelper.data.buildings[3].level;break;case 1:case 4:case 5:buildingLevel=rHelper.data.buildings[4].level}strength=rHelper.data.units[unitId].baseStrength*buildingLevel;var marketPriceIncludingTransportation=profitObj.marketPrice*rHelper.data.buildings[9].transportCost;return referencePrice=marketPriceIncludingTransportation>=profitObj.craftingPrice?profitObj.craftingPrice:marketPriceIncludingTransportation,pricePerStrength=Math.round(referencePrice/strength)},CALC_unitsProfit:function CALC_unitsProfit(unitId){var profitObj=rHelper.data.units[unitId].profit,profit=100*(1-profitObj.marketPrice/profitObj.craftingPrice);return profit*=-1,profitObj.profit=profit,profit},CALC_recyclingProfit:function CALC_recyclingProfit(lootId){var profitObj=rHelper.data.loot[lootId].profit,profit=100*(1-profitObj.outputWorth/profitObj.inputWorth);return profit*=-1},CALC_recyclingInputWorth:function CALC_recyclingInputWorth(lootId){var loot=rHelper.data.loot[lootId],amount=loot.recyclingDivisor,convertedId=lootId+36,price,worth=rHelper.methods.CALC_returnPriceViaId(convertedId,0)*amount,settings=rHelper.data.settings[3],transportCostInclusion=1;return void 0!==(void 0===settings?"undefined":_typeof(settings))&&(transportCostInclusion=rHelper.data.settings[3].value),1==transportCostInclusion&&(worth*=rHelper.data.buildings[9].transportCost),worth=Math.round(worth),loot.profit.inputWorth=worth,worth},CALC_recyclingOutputWorth:function CALC_recyclingOutputWorth(lootId,recyclingPlantLevel){var resultingAmount=rHelper.data.loot[lootId].recyclingAmount,resultingProducts=rHelper.data.loot[lootId].recyclingProduct,worth=0;return $.isArray(resultingProducts)?$.each(resultingProducts,function(index,resultingProduct){worth+=rHelper.methods.CALC_recyclingOutputWorthHelper(recyclingPlantLevel,resultingProduct,resultingAmount,index)}):worth+=rHelper.methods.CALC_recyclingOutputWorthHelper(recyclingPlantLevel,resultingProducts,resultingAmount),worth=Math.round(worth),rHelper.data.loot[lootId].profit.outputWorth=worth,worth},CALC_recyclingOutputWorthHelper:function CALC_recyclingOutputWorthHelper(recyclingPlantLevel,resultingProduct,resultingAmount,index){var price=rHelper.methods.CALC_returnPriceViaId(resultingProduct,0),amount=resultingAmount*recyclingPlantLevel,worth;return $.isArray(resultingAmount)&&(amount=resultingAmount[index]*recyclingPlantLevel),amount*price},CALC_recyclingRequirement:function CALC_recyclingRequirement(lootId){return rHelper.data.loot[lootId].recyclingDivisor},CALC_recyclingProducts:function CALC_recyclingProducts(lootId,recyclingPlantLevel){var resultingAmount=rHelper.data.loot[lootId].recyclingAmount,resultingProducts=rHelper.data.loot[lootId].recyclingProduct,string="";return $.isArray(resultingProducts)?$.each(resultingProducts,function(index,resultingProduct){string+=rHelper.methods.CALC_recyclingProductsHelper(recyclingPlantLevel,resultingProduct,resultingAmount,index)}):string+=rHelper.methods.CALC_recyclingProductsHelper(recyclingPlantLevel,resultingProducts,resultingAmount),string},CALC_recyclingProductsHelper:function CALC_recyclingProductsHelper(recyclingPlantLevel,resultingProduct,resultingAmount,index){var product=rHelper.methods.CALC_convertId(resultingProduct),icon=$(crEl("span")).addClass(product.icon),amount=resultingAmount*recyclingPlantLevel,string;return $.isArray(resultingAmount)&&(amount=resultingAmount[index]*recyclingPlantLevel),icon[0].outerHTML+" "+amount.toLocaleString("en-US")+" "},CALC_buildingToLevel10:function CALC_buildingToLevel10(buildingId){for(var building=rHelper.data.buildings[buildingId],buildingLevel,level10Cost=0,level10Transportation=0,level=building.level;level<10;level+=1)for(var i=0;i<=3;i+=1)if(0===i){var cash;level10Cost+=building.materialAmount0[level]}else{var selector,materialAmount=building["materialAmount"+i][level];if("number"==typeof materialAmount){var materialPrice,materialWorth=rHelper.methods.CALC_returnPriceViaId(building.material[i])*materialAmount,transportation;level10Cost+=materialWorth,level10Transportation+=(rHelper.data.buildings[9].transportCost-1)*materialWorth}}return{level10Cost:level10Cost,level10Transportation:Math.round(level10Transportation)}},CALC_warehouseUpgradeCost:function CALC_warehouseUpgradeCost(targetLevel){return 125e4*Math.pow(targetLevel-1,2)},CALC_warehouseCostFromTo:function CALC_warehouseCostFromTo(start,end){for(var warehouseCost=0,i=end;i>start;i-=1)warehouseCost+=rHelper.methods.CALC_warehouseUpgradeCost(i);return warehouseCost},CALC_warehouseContingent:function CALC_warehouseContingent(level){return 5e3*Math.pow(level,2)},CALC_warehouseUpgradeCostContigentBased:function CALC_warehouseUpgradeCostContigentBased(startLevel,endContingent){var warehouseCost=0,nextBiggerTargetLevel=Math.ceil(Math.sqrt(endContingent/5e3));return warehouseCost+=rHelper.methods.CALC_warehouseCostFromTo(startLevel,nextBiggerTargetLevel)},CALC_warehouseUpgradeCostOnInput:function CALC_warehouseUpgradeCostOnInput(id,type,value){var mode=$("#warehouse-"+type+"-calc-1-"+id).val(),currentWarehouseLevel=rHelper.data[type][id].warehouse.level,upgradeCost=0;switch(mode){case"level":upgradeCost=rHelper.methods.CALC_warehouseCostFromTo(currentWarehouseLevel,value);break;case"contingent":upgradeCost=rHelper.methods.CALC_warehouseUpgradeCostContigentBased(currentWarehouseLevel,value)}return upgradeCost},CALC_warehouseWorth:function CALC_warehouseWorth(id,type){var price=0,priceId=0;switch(type){case"material":priceId=id;break;case"products":priceId=id+14;break;case"loot":priceId=id+36;break;case"units":priceId=id+51}return price=rHelper.methods.CALC_returnPriceViaId(priceId)},CALC_warehouseRemainingTimeToFull:function CALC_warehouseRemainingTimeToFull(id,type){var el=rHelper.data[type][id],remainingCapacity=el.warehouse.contingent-el.warehouse.fillAmount,remainingTime=0,divisor=1;return"material"==type?divisor=el.perHour:"products"==type&&(divisor=el.scaling*el.factoryLevel*rHelper.methods.CALC_factoryMinWorkload(id)),remainingTime=remainingCapacity/divisor,remainingTime=isNaN(remainingTime)||"products"==type&&el.turnover<=0||"loot"==type||"units"==type?"∞":remainingTime>24?"> "+(remainingTime/24).toFixed(2)+" days":"> "+remainingTime.toFixed(2)+" hours"},CALC_warehouseTotalLevel:function CALC_warehouseTotalLevel(){var total=0,arr=["material","products","loot","units"];return $.each(arr,function(index,pointer){$.each(rHelper.data[pointer],function(index,el){total+=el.warehouse.level})}),total},CALC_warehouseTotalWorth:function CALC_warehouseTotalWorth(){var total=0,arr=["material","products","loot","units"];return $.each(arr,function(index,pointer){$.each(rHelper.data[pointer],function(index,el){total+=rHelper.methods.CALC_warehouseWorth(index,pointer)*el.warehouse.fillAmount})}),total},CALC_flowDistributionHelper:function CALC_flowDistributionHelper(type,dependantFactory,id,i){var originalIndex=0,dependantIconIndex=0,requiredAmountPerLevel=0,dependantObj={},requiredAmount=0,string="",arrow='<svg xmlns="http://www.w3.org/2000/svg" width="15" fill="#fff" viewBox="0 0 31.49 31.49"><path d="M21.205 5.007c-.429-.444-1.143-.444-1.587 0-.429.429-.429 1.143 0 1.571l8.047 8.047H1.111C.492 14.626 0 15.118 0 15.737c0 .619.492 1.127 1.111 1.127h26.554l-8.047 8.032c-.429.444-.429 1.159 0 1.587.444.444 1.159.444 1.587 0l9.952-9.952c.444-.429.444-1.143 0-1.571l-9.952-9.953z"/></svg>';"material"==type?(dependantIconIndex=dependantFactory-14,dependantObj=rHelper.data.products[dependantIconIndex],$.isArray(dependantObj.dependencies)?(originalIndex=dependantObj.dependencies.indexOf(id),requiredAmountPerLevel=dependantObj.requiredAmount[originalIndex]):(originalIndex=dependantObj.dependencies,requiredAmountPerLevel=dependantObj.requiredAmount)):(dependantIconIndex=dependantFactory,dependantObj=rHelper.data.products[dependantFactory],$.isArray(dependantObj.dependencies)?(originalIndex=dependantObj.dependencies.indexOf(id+14),requiredAmountPerLevel=dependantObj.requiredAmount[originalIndex]):(originalIndex=dependantObj.dependencies,requiredAmountPerLevel=dependantObj.requiredAmount)),dependantObj.turnover>0&&(requiredAmount=dependantObj.factoryLevel*requiredAmountPerLevel),string+='<span class="resources-'+type+"-"+id+'"></span> '+requiredAmount.toLocaleString("en-US")+" "+arrow+' <span class="resources-product-'+dependantIconIndex+'"></span>';var name1="",name2=dependantObj.name;switch(type){case"material":name1=rHelper.data.material[id].name;break;case"product":name1=rHelper.data.products[id].name}return $("#flow-"+type+"-distribution-"+id+"-"+i).html(string).attr("data-th",name1+" to "+name2),requiredAmount},CALC_flowDistribution:function CALC_flowDistribution(id,type){var perHour=0,obj={},requiredAmount=0;switch(type){case"material":perHour=(obj=rHelper.data.material[id]).perHour;break;case"product":var factoryLevel,scaling,workload;perHour=(obj=rHelper.data.products[id]).factoryLevel*obj.scaling*rHelper.methods.CALC_factoryMinWorkload(id)}var dependantFactories=obj.dependantFactories;return $.isArray(dependantFactories)?$.each(dependantFactories,function(i,dependantFactory){requiredAmount+=rHelper.methods.CALC_flowDistributionHelper(type,dependantFactory,id,i)}):""!=dependantFactories&&(requiredAmount+=rHelper.methods.CALC_flowDistributionHelper(type,dependantFactories,id,0)),perHour-requiredAmount},CALC_flowRate:function CALC_flowRate(id,type){var rate=0;switch(type){case"material":rate=rHelper.data.material[id].perHour;break;case"product":var factory=rHelper.data.products[id],workload=rHelper.methods.CALC_factoryMinWorkload(id);rate=factory.factoryLevel*factory.scaling*workload}return rate},CALC_factoryMinWorkload:function CALC_factoryMinWorkload(factoryId){var workload=rHelper.data.products[factoryId].dependencyWorkload.min();return workload>1&&(workload=1),1==rHelper.data.settings[2].value&&(workload=1),workload},CALC_diamondTotalProfit:function CALC_diamondTotalProfit(){var val=0;return $.each(rHelper.data.products,function(i,factory){var diamondProfit=factory.diamond.profit;diamondProfit>0&&(val+=diamondProfit)}),val},CALC_diamondTop10Profit:function CALC_diamondTop10Profit(){var arr=[];$.each(rHelper.data.products,function(i,factory){var diamondProfit=factory.diamond.profit;diamondProfit>0&&arr.push(diamondProfit)});var sum=0;arr=arr.sort(function(a,b){return b-a});for(var i=0;i<=9;i+=1)arr[i]&&(sum+=arr[i]);return sum},CALC_diamondEfficiency:function CALC_diamondEfficiency(factoryId){var factoryDiamond=rHelper.data.products[factoryId].diamond,efficiency=factoryDiamond.outputWorth/(factoryDiamond.dependenciesWorth+factoryDiamond.productionCost);return isNaN(efficiency)&&(efficiency=0),factoryDiamond.efficiency=efficiency,efficiency},CALC_diamondProfit:function CALC_diamondProfit(factoryId){var factoryDiamond=rHelper.data.products[factoryId].diamond;return factoryDiamond.profit=factoryDiamond.outputWorth-(factoryDiamond.dependenciesWorth+factoryDiamond.productionCost),factoryDiamond.profit},CALC_nextGreaterWarehouseLevel:function CALC_nextGreaterWarehouseLevel(amount){return Math.ceil(Math.sqrt(amount/5e3))},CALC_diamondFactoryOutput:function CALC_diamondFactoryOutput(factoryId){var factory=rHelper.data.products[factoryId],outputAmount=factory.factoryLevel*factory.scaling*5*24,productionCost=120*factory.cashPerHour;return 0==factory.factoryLevel&&(productionCost=0),rHelper.data.products[factoryId].diamond={outputWorth:outputAmount*rHelper.methods.CALC_returnPriceViaId(factoryId+14),dependenciesWorth:0,productionCost:productionCost,efficiency:0,profit:0},factory.factoryLevel*factory.scaling*5*24},CALC_dependantFactoriesHelper:function CALC_dependantFactoriesHelper(dependantFactory,type){"material"==type&&(dependantFactory-=14);var fns=["INSRT_factoryDependencies","INSRT_factoryWorkload","INSRT_factoryTurnover","INSRT_factoryTurnoverPerUpgrade","INSRT_factoryROI"];$.each(fns,function(i,fn){rHelper.methods[fn](dependantFactory)}),rHelper.methods.INSRT_factoryHighlightColumns(),""!=rHelper.data.products[dependantFactory].dependantFactories&&rHelper.methods.CALC_dependantFactories(dependantFactory,"product")},CALC_dependantFactories:function CALC_dependantFactories(id,type){var dependantFactories="";switch(type){case"material":dependantFactories=rHelper.data.material[id].dependantFactories;break;case"product":dependantFactories=rHelper.data.products[id].dependantFactories}$.isArray(dependantFactories)?$.each(dependantFactories,function(k,dependantFactory){rHelper.methods.CALC_dependantFactoriesHelper(dependantFactory,type)}):""!=dependantFactories&&rHelper.methods.CALC_dependantFactoriesHelper(dependantFactories,type)},CALC_factoryTurnoverPerUpgrade:function CALC_factoryTurnoverPerUpgrade(factoryId){var value=0,nextLevelWorkloadArray=[],dependencies=rHelper.data.products[factoryId].dependencies;if($.isArray(dependencies))$.each(dependencies,function(dependencyIndex){var dependencyWorkload=rHelper.methods.CALC_factoryDepedencyWorkload(factoryId,dependencyIndex,"nextLevel");nextLevelWorkloadArray.push(dependencyWorkload)});else{var dependencyWorkload=rHelper.methods.CALC_factoryDepedencyWorkload(factoryId,0,"nextLevel");nextLevelWorkloadArray.push(dependencyWorkload)}var nextLevelWorkload=nextLevelWorkloadArray.min();return nextLevelWorkload>1&&(nextLevelWorkload=1),(value=parseInt(rHelper.methods.CALC_factoryTurnover(factoryId,"nextLevel",nextLevelWorkload)-rHelper.data.products[factoryId].turnover))<10&&value>-10&&(value=0),value},CALC_factoryDependencyExistingAmount:function CALC_factoryDependencyExistingAmount(dependantObj,dependencyIndex){return dependantObj.perHour?dependantObj.perHour:dependantObj.factoryLevel*dependantObj.scaling},CALC_factoryWorkloadMinNonSanitized:function CALC_factoryWorkloadMinNonSanitized(factoryId){var workload=rHelper.data.products[factoryId].dependencyWorkload.min();return 1==rHelper.data.settings[2].value&&(workload=1),workload},CALC_factoryCashCostPerHour:function CALC_factoryCashCostPerHour(factoryId,nextLevel){var factory=rHelper.data.products[factoryId],factoryLevel=factory.factoryLevel;return nextLevel&&(factoryLevel+=1),factory.cashPerHour*factoryLevel},CALC_factoryTurnover:function CALC_factoryTurnover(factoryId,nextLevel,nextLevelWorkload){var factory=rHelper.data.products[factoryId],price=rHelper.methods.CALC_returnPriceViaId(factoryId+14),factoryLevel=factory.factoryLevel,cashCost=rHelper.methods.CALC_factoryCashCostPerHour(factoryId,nextLevel),workload=rHelper.methods.CALC_factoryMinWorkload(factoryId),materialWorth=0;nextLevel&&(factoryLevel+=1,workload=nextLevelWorkload);var outputWorth=factory.scaling*factoryLevel*price;if(1==rHelper.data.settings[2].value&&(workload=1),$.isArray(factory.dependencies))$.each(factory.dependencies,function(index){var dependencyWorth=rHelper.methods.CALC_factoryDependencyWorth(factoryId,index,nextLevel);materialWorth+=dependencyWorth});else{var dependencyWorth=rHelper.methods.CALC_factoryDependencyWorth(factoryId,0,nextLevel);materialWorth+=dependencyWorth}return Math.round((outputWorth-materialWorth-cashCost)*workload)},CALC_factoryDependencyWorth:function CALC_factoryDependencyWorth(factoryId,dependencyIndex,nextLevel){var factory=rHelper.data.products[factoryId],factoryLevel=factory.factoryLevel,requiredAmount=0,dependencyPrice=0;return nextLevel&&(factoryLevel+=1),$.isArray(factory.dependencies)?(requiredAmount=factory.requiredAmount[dependencyIndex],dependencyPrice=rHelper.methods.CALC_returnPriceViaId(factory.dependencies[dependencyIndex])):(requiredAmount=factory.requiredAmount,dependencyPrice=rHelper.methods.CALC_returnPriceViaId(factory.dependencies)),factoryLevel*requiredAmount*dependencyPrice},CALC_factoryDepedencyWorkload:function CALC_factoryDepedencyWorkload(factoryId,dependencyIndex,nextLevel){var factory=rHelper.data.products[factoryId],factoryLevel=factory.factoryLevel,_ref40=[0,0,,],workload=_ref40[0],existingAmount=_ref40[1],thisDependency=_ref40[2],baseAmountRequirement=_ref40[3];nextLevel&&(factoryLevel+=1),$.isArray(factory.dependencies)?(thisDependency=factory.dependencies[dependencyIndex],baseAmountRequirement=factory.requiredAmount[dependencyIndex]):(thisDependency=factory.dependencies,baseAmountRequirement=factory.requiredAmount);var requiredAmount=baseAmountRequirement*factoryLevel;if(thisDependency<=13)existingAmount=rHelper.data.material[thisDependency].perHour;else{var actualFactory=rHelper.methods.CALC_convertId(thisDependency),minDependencyWorkload=actualFactory.dependencyWorkload.min();minDependencyWorkload>1&&(minDependencyWorkload=1),existingAmount=actualFactory.factoryLevel*actualFactory.scaling*minDependencyWorkload}return workload=existingAmount/requiredAmount,(isNaN(workload)||workload===1/0)&&(workload=0),1==rHelper.data.settings[2].value&&(workload=1),workload},CALC_factoryROI:function CALC_factoryROI(factoryId){return rHelper.data.products[factoryId].upgradeCost/rHelper.data.products[factoryId].turnoverIncrease/24},CALC_factoryComparatorRequiredVsExistingAmount:function CALC_factoryComparatorRequiredVsExistingAmount(requiredAmount,existingAmount){var addClass=void 0;return isNaN(existingAmount)&&(existingAmount=0),addClass=existingAmount<requiredAmount?'class="faulty-dependency"':""},CALC_factoryDependencyRequiredAmount:function CALC_factoryDependencyRequiredAmount(factoryId,dependencyIndex){var factory=rHelper.data.products[factoryId],requiredAmount=0;return(requiredAmount=$.isArray(factory.requiredAmount)?factory.requiredAmount[dependencyIndex]:factory.requiredAmount)*factory.factoryLevel},CALC_totalFactoryUpgrades:function CALC_totalFactoryUpgrades(){var totalFactoryUpgrades=0;return $.each(rHelper.data.products,function(i,factory){totalFactoryUpgrades+=factory.factoryLevel}),totalFactoryUpgrades},CALC_factoryUpgradeCost:function CALC_factoryUpgradeCost(factoryId){var factoryLevel=rHelper.data.products[factoryId].factoryLevel;void 0!==factoryLevel&&factoryLevel||(factoryLevel=0);var nextLevel=factoryLevel+1,_ref41=[0,0,,,$(crEl("table")),$(crEl("tbody"))],sum=_ref41[0],sumTransportation=_ref41[1],td=_ref41[2],small=_ref41[3],table=_ref41[4],tbody=_ref41[5],result;$.each(rHelper.data.products[factoryId].upgradeMaterialAmount,function(i,amount){var _ref42=[$(crEl("tr")),0],tr=_ref42[0],k=_ref42[1];if(0===i)for(sum+=amount*Math.pow(nextLevel,2),k=0;k<=2;k+=1){switch(td=$(crEl("td")),k){case 0:var img=$(crEl("img")).attr("src","assets/img/cash.png").attr("alt","Cash");td.append(img[0]);break;case 1:td.addClass("text-right").attr("colspan",3).text(sum.toLocaleString("en-US"));break;case 2:small=$(crEl("small")).text("Transportation"),td.addClass("text-right text-warning").append(small[0])}tr.append(td[0])}else{var upgradeMaterial=rHelper.data.products[factoryId].upgradeMaterial[i],upgradeMaterialAmount=amount*Math.pow(nextLevel,2),price,materialWorth=rHelper.methods.CALC_returnPriceViaId(upgradeMaterial)*upgradeMaterialAmount,transportation=(rHelper.data.buildings[9].transportCost-1)*materialWorth,className=void 0;for(sum+=materialWorth,sumTransportation+=transportation,(upgradeMaterial+=1)<=13?className="material":upgradeMaterial>=14&&upgradeMaterial<=35?(upgradeMaterial-=14,className="product"):upgradeMaterial>=36&&upgradeMaterial<=51?(upgradeMaterial-=36,className="loot"):(upgradeMaterial-=51,className="units"),k=0;k<=4;k+=1){switch(td=$(crEl("td")),k){case 0:td.addClass("resources-"+className+"-"+(upgradeMaterial-1));break;case 1:td.addClass("text-right").text(upgradeMaterialAmount.toLocaleString("en-US"));break;case 2:td.text("≙");break;case 3:td.addClass("text-right").text(materialWorth.toLocaleString("en-US"));break;case 4:small=$(crEl("small")).addClass("text-warning").text(transportation.toLocaleString("en-US")),td.addClass("text-right").append(small[0])}tr.append(td[0])}}tbody.append(tr[0])});for(var tr=$(crEl("tr")),k=0;k<=1;k+=1)td=$(crEl("td")).addClass("text-right"),0===k?td.attr("colspan",4).text(sum.toLocaleString("en-US")):(small=$(crEl("small")).addClass("text-warning").text(sumTransportation.toLocaleString("en-US")),td.append(small[0])),tr.append(td[0]);return tbody.append(tr[0]),table.append(tbody[0]),rHelper.data.products[factoryId].upgradeCost=sum,{sum:sum,title:table[0].outerHTML}},CALC_factoryOutput:function CALC_factoryOutput(factoryId){var factory=rHelper.data.products[factoryId];return factory.factoryLevel*factory.scaling},CALC_totalMineCount:function CALC_totalMineCount(){var totalMineCount=0;return $.each(rHelper.data.material,function(i,material){totalMineCount+=material.amountOfMines}),totalMineCount},CALC_totalMineWorth:function CALC_totalMineWorth(){var totalMineWorth=0;return $.each(rHelper.data.material,function(i){totalMineWorth+=rHelper.methods.CALC_materialRateWorth(i)}),totalMineWorth},CALC_returnPriceViaId:function CALC_returnPriceViaId(id,period){var possiblePrices=["current","1day","3days","7days","4weeks","3months","6months","1year","max"],index=0;if(void 0===period){var settings=rHelper.data.settings[5],priceAgeSetting=2;void 0!==(void 0===settings?"undefined":_typeof(settings))&&(priceAgeSetting=rHelper.data.settings[5].value),index=possiblePrices[priceAgeSetting]}else"number"==typeof period&&(index=possiblePrices[period]);var target,targetPrices=rHelper.methods.CALC_convertId(id).prices[index];return targetPrices.ai>=targetPrices.player?targetPrices.ai:targetPrices.player},CALC_convertId:function CALC_convertId(id){return id<=13?rHelper.data.material[id]:id>=14&&id<=35?(id-=14,rHelper.data.products[id]):id>=36&&id<=51?(id-=36,rHelper.data.loot[id]):(id-=52,rHelper.data.units[id])},CALC_materialNewMinePrice:function CALC_materialNewMinePrice(totalMineCount,materialId){return Math.round(rHelper.data.material[materialId].basePrice*(1+totalMineCount/50))},CALC_materialRateWorth:function CALC_materialRateWorth(materialId){return rHelper.data.material[materialId].perHour*rHelper.methods.CALC_returnPriceViaId(materialId)},CALC_materialMinePerfectIncome:function CALC_materialMinePerfectIncome(materialId){return rHelper.data.material[materialId].maxRate*rHelper.methods.CALC_returnPriceViaId(materialId)},CALC_materialMineROI:function CALC_materialMineROI(type){for(var array=[],i=0;i<=13;i+=1){var newMinePrice=rHelper.methods.CALC_materialNewMinePrice(rHelper.methods.CALC_totalMineCount(),i),perfectIncome=rHelper.methods.CALC_materialMinePerfectIncome(i),customTUPrice=rHelper.methods.CALC_customTUPrice();switch(type){case"100":array.push(newMinePrice/perfectIncome/24);break;case"505":array.push((newMinePrice+customTUPrice)/perfectIncome/24/5.05);break;case"505hq":var userHQLevel=1;rHelper.data.headquarter.user&&(userHQLevel=rHelper.data.headquarter.user.level);var hqBoost=rHelper.data.headquarter[userHQLevel-1].boost-.9;array.push((newMinePrice+customTUPrice)/perfectIncome/24/5.05/hqBoost)}}return array},CALC_customTUPrice:function CALC_customTUPrice(){var customTUPrice=0,tuIndex=46,settings=rHelper.data.settings[1],customTUCombination=[111,26,0,0];void 0!==(void 0===settings?"undefined":_typeof(settings))&&(customTUCombination=settings.value);for(var i=0;i<=3;i+=1)customTUPrice+=customTUCombination[i]*rHelper.methods.CALC_returnPriceViaId(46+i);return customTUPrice}},graphs:{gaugeOptions:{chart:{type:"solidgauge",backgroundColor:"transparent"},title:null,pane:{center:["50%","85%"],size:"140%",startAngle:-90,endAngle:90,background:{backgroundColor:"#EEE",innerRadius:"60%",outerRadius:"100%",shape:"arc"}},tooltip:{enabled:!1},yAxis:{minColor:"rgba(255, 127, 80, 0.75)",maxColor:"rgba(154, 205, 50, 0.75)",lineWidth:0,minorTickInterval:null,title:{y:-70},labels:{y:16}},plotOptions:{solidgauge:{dataLabels:{y:5,borderWidth:0,style:{color:"#dedede"},useHTML:!0}}},exporting:{chartOptions:{chart:{backgroundColor:"#5f473e"}}}},material:{target:"graph-material",categories:[],mineData:[],incomeData:[],data:[],colors:["#8a4f3e","#a4938e","#aba59a","#2d2c2b","#8a5a3a","#d8d8d8","#b58359","#b87259","#9b7953","#c4b9ab","#957e60","#cccbc2","#b28b3d","#b0a17d"],reference:{mineCount:0,mineIncome:0},seriesNames:["Mines","Mine income"],responsiveId:"income",titleText:"mine distribution vs mine income"}},data:{},tu:[]};$("#loading-text").text("fetching data"),void 0!==localStorage.rGame&&1!=getCookie("loggedIn")?(rHelper.data=JSON.parse(localStorage.getItem("rGame")),loadingAnimToggler("hide"),console.log("Found existing data!"),rHelper.init.core()):$.get({url:"api/core.php",success:function success(response){switch(rHelper.data=response,localStorage.setItem("rGame",JSON.stringify(response)),loadingAnimToggler("hide"),parseInt(getCookie("loggedIn"))){case 1:console.log("Returning user - fetched existing data!");break;default:console.log("New user - fetched basic data!")}rHelper.init.user()},error:function error(response){swal("Error fetching data","Error message:<br />"+response+"<br /> Please try again.","error")}});var openedWindow=void 0;