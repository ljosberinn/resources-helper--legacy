const rHelper={init:{user(){"use strict";rHelper.methods.INSRT_userSettings(),rHelper.init.core()},core(){"use strict";removeSaveButton(),rHelper.methods.SET_tabSwitcherAnchorBased(),rHelper.methods.SET_transportCost("init"),$.each(rHelper.data.material,materialId=>{rHelper.methods.EVNT_materialInput(materialId),rHelper.methods.INSRT_materialData(materialId),rHelper.methods.INSRT_warehouseData(materialId,"material"),rHelper.methods.INSRT_priceHistoryName("material",materialId)}),rHelper.methods.INSRT_totalMineWorth(rHelper.methods.CALC_totalMineWorth()),rHelper.methods.INSRT_totalMineCount(rHelper.methods.CALC_totalMineCount());let calculationOrder=rHelper.methods.GET_calculationOrder();$.each(calculationOrder,(index,factoryId)=>{rHelper.methods.EVNT_factoryInput(factoryId),rHelper.methods.INSRT_factoryDiamondData(factoryId,"product"),rHelper.methods.INSRT_warehouseData(factoryId,"products"),rHelper.methods.INSRT_priceHistoryName("products",factoryId)}),$.each(rHelper.data.loot,index=>{rHelper.methods.INSRT_warehouseData(index,"loot"),rHelper.methods.INSRT_priceHistoryName("loot",index),4==index||index>=10&&index<=13||(rHelper.methods.SET_recyclingProfitObj(index),rHelper.methods.INSRT_recycling(index))});let unitsFns=["SET_UnitProfitObj","INSRT_unitsCraftingPrice","INSRT_unitsMarketPrice","INSRT_unitsPricePerStrength"];$.each(rHelper.data.units,index=>{rHelper.methods.INSRT_warehouseData(index,"units"),$.each(unitsFns,(i,fn)=>{rHelper.methods[fn](index)}),rHelper.methods.INSRT_unitsRecyclingProfit("units",index),rHelper.methods.INSRT_priceHistoryName("units",index)});let buildingFns=["INSRT_buildingName","SET_buildingBackgroundColor","INSRT_buildingData","INSRT_buildingToLevel10","EVNT_buildingChange"];$.each(rHelper.data.buildings,buildingId=>{$.each(buildingFns,(i,fn)=>{rHelper.methods[fn](buildingId)})});let hqFns=["INSRT_headquarterOvwString","INSRT_headquarterOvwRadius","INSRT_headquarterOvwCost","INSRT_headquarterOvwBoost","INSRT_headquarterOvwTransportation","EVNT_switchHeadquarter"];$.each(rHelper.data.headquarter,headquarterLevel=>{$.each(hqFns,(i,fn)=>{rHelper.methods[fn](headquarterLevel)})});let pieGraphs=["material"];$.each(pieGraphs,(i,val)=>{rHelper.methods.EVNT_buildGraph(val)});let gaugeGraphs=["buildings","headquarter"];$.each(gaugeGraphs,(i,val)=>{rHelper.methods.INSRT_gaugeGraph(val)});let nonParamBoundMethods=["INSRT_materialMineAmortisation","INSRT_materialHighlightMinePerfectIncome","INSRT_totalFactoryUpgrades","INSRT_factoryHighlightColumns","INSRT_diamondTop10Profit","INSRT_diamondTotalProfit","INSRT_flowDistributionGlobal","INSRT_warehouseTotalLevel","INSRT_warehouseTotalWorth","EVNT_priceHistoryOnChange","SET_hqLevel","EVNT_headquarterInput","INSRT_missions","INSRT_techUpgradeRows","EVNT_attackLogTrigger","INSRT_companyWorth","EVNT_sortableTables","EVNT_assignTitleToIcons","EVNT_enableTippy"];$.each(nonParamBoundMethods,(i,fn)=>{rHelper.methods[fn]()})}},methods:{GET_calculationOrder(){"use strict";return[0,1,2,3,4,7,8,9,10,15,17,18,5,6,13,19,11,12,14,16,20,21]},API_toggleLoadSuccessorHelper(target){"use strict";let fns=["API_toggleLoader","API_toggleSuccessor","API_toggleSuccessorHelper"];$.each(fns,(i,fn)=>{rHelper.methods[fn](target)})},API_toggleLoader(selector){"use strict";let el=$(`#api-${selector}-loading`);"none"==el.css("display")?el.fadeIn("fast").css("display","flex"):el.fadeOut("fast")},API_toggleSuccessor(selector){"use strict";let el=$(`#api-${selector}-finished`);"none"==el.css("display")?el.fadeIn("fast"):el.fadeOut("fast")},API_toggleSuccessorHelper(selector){"use strict";setTimeout(()=>{rHelper.methods.API_toggleSuccessor(selector)},15e3)},API_getFactories(key){"use strict";rHelper.methods.API_toggleLoader("factories"),$.get(`api/core.php?query=1&key=${key}`,data=>{$.each(data,(i,value)=>{rHelper.data.products[i].factoryLevel=value});let calculationOrder=rHelper.methods.GET_calculationOrder();$.each(calculationOrder,(index,factoryId)=>{rHelper.methods.INSRT_factoryDiamondData(factoryId,"product")}),rHelper.methods.INSRT_totalFactoryUpgrades(),rHelper.methods.INSRT_factoryHighlightColumns(),rHelper.methods.INSRT_diamondTop10Profit(),rHelper.methods.INSRT_diamondTotalProfit(),rHelper.methods.INSRT_flowDistributionGlobal(),rHelper.methods.API_toggleLoadSuccessorHelper("factories"),sorttable.innerSortFunction.apply($("#module-diamond th")[4],[]),sorttable.innerSortFunction.apply($("#module-diamond th")[5],[]),rHelper.methods.SET_save()})},API_getWarehouse(key){"use strict";rHelper.methods.API_toggleLoader("warehouse"),$.getJSON(`api/core.php?query=2&key=${key}`,data=>{$.each(data,function(i,warehouseInfo){let iterator=i,targetObj="material";i>=14&&i<36?(iterator-=14,targetObj="products"):i>=36&&i<52?(iterator-=36,targetObj="loot"):i>=52&&(iterator-=52,targetObj="units");let contingent=5e3*Math.pow(warehouseInfo.level,2),fillStatus=warehouseInfo.amount/contingent;isNaN(fillStatus)&&(fillStatus=0),rHelper.data[targetObj][iterator].warehouse.level=warehouseInfo.level,rHelper.data[targetObj][iterator].warehouse.fillAmount=warehouseInfo.amount,rHelper.data[targetObj][iterator].warehouse.contingent=contingent,rHelper.data[targetObj][iterator].warehouse.fillStatus=fillStatus,rHelper.methods.SET_save()}),$.each(rHelper.data.material,materialId=>{rHelper.methods.INSRT_warehouseData(materialId,"material")});let calculationOrder=rHelper.methods.GET_calculationOrder();$.each(calculationOrder,index=>{rHelper.methods.INSRT_warehouseData(index,"products")}),$.each(rHelper.data.loot,index=>{rHelper.methods.INSRT_warehouseData(index,"loot")}),$.each(rHelper.data.units,index=>{rHelper.methods.INSRT_warehouseData(index,"units")}),rHelper.methods.INSRT_warehouseTotalLevel(),rHelper.methods.INSRT_warehouseTotalWorth(),rHelper.methods.API_toggleLoadSuccessorHelper("warehouse")})},API_getMineSummary(key){rHelper.methods.API_toggleLoader("mines-summary"),$.get(`api/core.php?query=51&key=${key}`,data=>{$.each(data,(i,obj)=>{rHelper.data.material[i].perHour=obj.perHour,rHelper.data.material[i].amountOfMines=obj.amountOfMines}),$.each(rHelper.data.material,materialId=>{rHelper.methods.INSRT_materialData(materialId,"api")});const fns=["INSRT_materialMineAmortisation","INSRT_materialHighlightMinePerfectIncome","INSRT_flowDistributionGlobal"];$.each(fns,(i,fn)=>{rHelper.methods[fn]()}),rHelper.methods.INSRT_totalMineWorth(rHelper.methods.CALC_totalMineWorth()),rHelper.methods.INSRT_totalMineCount(rHelper.methods.CALC_totalMineCount()),rHelper.methods.EVNT_buildGraph("material"),rHelper.methods.API_toggleLoadSuccessorHelper("mines-summary"),rHelper.methods.SET_save()})},API_getMineMap(){"use strict";$.getJSON("api/core.php?mineMap",data=>{rHelper.data.mineMap=data,rHelper.methods.API_toggleLoadSuccessorHelper("mines-detailed"),rHelper.methods.EVNT_mapCreation("personal"),rHelper.methods.SET_overTimeGraph()})},API_getMineMapInitiator(key){"use strict";rHelper.methods.API_toggleLoader("mines-detailed"),$.getJSON(`api/core.php?query=5&key=${key}`,data=>{"rHelper.methods.API_getMineMap()"==data.callback?rHelper.methods.API_getMineMap():swal("Error","Couldn't fetch mine details - API potentially unavailable!","error")})},API_getPlayerInfo(key,anonymity){"use strict";rHelper.methods.API_toggleLoader("player");let url=`api/core.php?query=7&key=${key}`;anonymity&&(url+="&anonymity=true"),$.getJSON(url,data=>{rHelper.data.userInformation.level=data.lvl,rHelper.data.userInformation.points=data.points,rHelper.data.userInformation.rank=data.worldrank,data.name&&(rHelper.data.userInformation.name=data.name),rHelper.data.userInformation.registeredGame=rHelper.methods.CALC_convertDateToIso(data.registerdate),rHelper.methods.API_toggleLoadSuccessorHelper("player")})},API_getAttackLog(type,target,skipCount){"use strict";void 0===type&&(type="attackSimple");let url=`api/core.php?attackLog&type=${type}`;target&&(url+=`&target=${target}`),skipCount&&(url+=`&skip=${skipCount}`),$.getJSON(url,data=>{rHelper.data.attackLog=data,rHelper.methods.API_toggleLoadSuccessorHelper("attack-log"),rHelper.methods.INSRT_attackLog(type)})},API_getAttackLogInitiator(key){"use strict";rHelper.methods.API_toggleLoader("attack-log"),$.getJSON(`api/core.php?query=9&key=${key}`,data=>{'rHelper.methods.API_getAttackLog("attackSimple")'!=data.callback?swal("Error","Couldn't fetch attack log - API potentially unavailable!","error"):rHelper.methods.API_toggleLoadSuccessorHelper("attack-log")})},API_getTradeLog(skipCount,filter,dateFilter){"use strict";let url="api/core.php?tradeLog";skipCount&&(url+=`&skipCount=${skipCount}`),filter&&(url+=`&filter=${filter}`),dateFilter&&(url+=`&day=${dateFilter}`);const buttons=[$("#tradelog-next"),$("#tradelog-previous")];$.each(buttons,(i,btn)=>{btn.attr("disabled",!0)}),$.getJSON(url,data=>{rHelper.data.tradeLog=data,rHelper.methods.API_toggleLoadSuccessorHelper("trade-log"),rHelper.methods.INSRT_tradeLog(),$.each(buttons,(i,btn)=>{btn.attr("disabled",!1)})})},API_getTradeLogInitiator(key){"use strict";rHelper.methods.API_toggleLoader("trade-log"),$.getJSON(`api/core.php?query=6&key=${key}`,data=>{"rHelper.methods.API_getTradeLog()"==data.callback?rHelper.methods.API_getTradeLog():swal("Error","Couldn't fetch trade log - API potentially unavailable!","error")})},API_getMissions(){"use strict";$.getJSON("api/core.php?missions",data=>{rHelper.data.missions=data,rHelper.methods.API_toggleLoadSuccessorHelper("missions"),rHelper.methods.INSRT_missions()})},API_getMissionsInitiator(key){"use strict";rHelper.methods.API_toggleLoader("missions"),$.getJSON(`api/core.php?query=10&key=${key}`,data=>{"rHelper.methods.API_getMissions()"==data.callback&&rHelper.methods.API_getMissions()})},API_getBuildings(key){"use strict";rHelper.methods.API_toggleLoader("buildings"),$.getJSON(`api/core.php?query=3&key=${key}`,data=>{let fns=["INSRT_buildingName","SET_buildingBackgroundColor","INSRT_buildingData","INSRT_buildingToLevel10"];$.each(data,(i,buildingLevel)=>{rHelper.data.buildings[i].level=buildingLevel,$.each(fns,(k,fn)=>{rHelper.methods[fn](i)})}),rHelper.methods.INSRT_gaugeGraph("buildings"),rHelper.methods.API_toggleLoadSuccessorHelper("buildings"),rHelper.methods.SET_save()})},API_getHeadquarter(key){"use strict";rHelper.methods.API_toggleLoader("headquarter"),$.getJSON(`api/core.php?query=4&key=${key}`,data=>{rHelper.data.headquarter.user=rHelper.data.headquarter.user||{hqPosition:{lon:0,lat:0},level:0,paid:[0,0,0,0]},rHelper.data.headquarter.user.hqPosition.lat=data.lat,rHelper.data.headquarter.user.hqPosition.lon=data.lon,rHelper.data.headquarter.user.level=data.level,$.each(data.paid,(i,paid)=>{rHelper.data.headquarter.user.paid[i]=paid}),rHelper.methods.INSRT_gaugeGraph("headquarter"),rHelper.methods.SET_hqLevel(),rHelper.methods.API_toggleLoadSuccessorHelper("headquarter"),rHelper.methods.SET_save()})},API_getCreditInformation(key){"use strict";$("#api-credits").html('<span id="api-credits-loading" class="circles-to-rhombuses-spinner"><span class="rhombuses-circle"></span><span class="rhombuses-circle"></span><span class="rhombuses-circle"></span></span>'),$("#api-credits-loading").css("display","flex"),$.get(`api/core.php?query=0&key=${key}`,data=>{let remainingCredits=parseInt(data[0].creditsleft);rHelper.data.userInformation.remainingCredits=remainingCredits,rHelper.methods.INSRT_API_remainingCredits(remainingCredits),$("#api-submit").attr("disabled",!1),$("#api-credits-loading").css("display","none")})},API_init(key,queries,anonymity){"use strict";$.isArray(queries)&&$.each(queries,(i,query)=>{switch(query){case 1:rHelper.methods.API_getFactories(key);break;case 2:rHelper.methods.API_getWarehouse(key);break;case 3:rHelper.methods.API_getBuildings(key);break;case 4:rHelper.methods.API_getHeadquarter(key);break;case 5:rHelper.methods.API_getMineMapInitiator(key);break;case 51:rHelper.methods.API_getMineSummary(key);break;case 6:rHelper.methods.API_getTradeLogInitiator(key);break;case 7:rHelper.methods.API_getPlayerInfo(key,anonymity);break;case 9:rHelper.methods.API_getAttackLogInitiator(key);break;case 10:rHelper.methods.API_getMissionsInitiator(key);break;default:rHelper.methods.API_getCreditInformation(key)}})},API_getWorldMap(type){"use strict";$.getJSON(`api/core.php?worldMap=${type}`,data=>{rHelper.data.worldMap=rHelper.data.worldMap||{},rHelper.data.worldMap=data,rHelper.methods.EVNT_mapCreation("world")})},SET_globalObject(selector,index,key,value){"use strict";$.isArray(key)?rHelper.data[selector][index][key[0]][key[1]]=value:rHelper.data[selector][index][key]=value,rHelper.methods.SET_save()},SET_save(){"use strict";const loggedInCookie=parseInt(getCookie("loggedIn")),hasAPIKeyAttached=typeof rHelper.data.userInformation.realKey;1==loggedInCookie&&"undefined"==hasAPIKeyAttached&&(localStorage.setItem("rGame",JSON.stringify(rHelper.data)),swal("Data has been saved remotely!","<not implemented yet>","error"))},SET_tabSwitcherAnchorBased(){"use strict";let anchor=`#${window.location.hash.substr(1)}`;"#"==anchor&&(anchor=1!=getCookie("loggedIn")?"#registrationlogin":"#factories"),"#leaderboard"==anchor&&rHelper.methods.INSRT_leaderboard(),"#tradelog"==anchor&&rHelper.methods.API_getTradeLog(),$(".nav-link").each((i,navLink)=>{let navEl=$(navLink),target=$(`#${navLink.dataset.target}`);navEl.attr("href")==anchor?(target.css("display","block"),navEl.addClass("active")):(target.css("display","none"),navEl.removeClass("active"))})},SET_transportCost(init){"use strict";if(rHelper.data.buildings[9].transportCost=1+(15-rHelper.data.buildings[9].level)/100,!init){$.each(rHelper.data.buildings,buildingId=>{let fns=["SET_buildingBackgroundColor","INSRT_buildingData","INSRT_buildingToLevel10"];$.each(fns,(i,fn)=>{rHelper.methods[fn](buildingId)})});let calculationOrder=rHelper.methods.GET_calculationOrder();$.each(calculationOrder,(index,factoryId)=>{let fns=["INSRT_factoryUpgradeCost","INSRT_factoryROI"];$.each(fns,(i,fn)=>{rHelper.methods[fn](factoryId)}),rHelper.methods.INSRT_flowDistributionGlobal()}),$.each(rHelper.data.headquarter,headquarterLevel=>{rHelper.methods.INSRT_headquarterOvwTransportation(headquarterLevel)})}},SET_buildingBackgroundColor(buildingId){"use strict";const buildingLevel=rHelper.data.buildings[buildingId].level,r=255-10*buildingLevel,g=127+7*buildingLevel,b=80-3*buildingLevel;$(`#building-${buildingId}`).css("background-color",`rgba(${r},${g},${b}, 0.25)`)},SET_buildingTableVisibility(buildingId,state){"use strict";const[tbody,tfoot]=[$(`#building-${buildingId} tbody`),$(`#building-${buildingId} tfoot`)];$.each([tbody,tfoot],(i,el)=>{switch(state){case"show":"none"==el.css("display")&&el.css("display","table-row-group");break;case"hide":"none"!=el.css("display")&&el.css("display","none")}})},SET_recyclingProfitObj(lootId){"use strict";rHelper.data.loot[lootId].profit={outputWorth:0,inputWorth:0,profit:0}},SET_recyclingPlantLevel(){"use strict";$.each(rHelper.data.loot,lootId=>{if(4==lootId||lootId>=10&&lootId<=13)return;let fns=["INSRT_recyclingProducts","INSRT_recyclingOutputWorth","INSRT_recyclingInputWorth"];$.each(fns,(i,fn)=>{rHelper.methods[fn](lootId)}),rHelper.methods.INSRT_unitsRecyclingProfit("recycling",lootId)})},SET_UnitProfitObj(unitId){"use strict";rHelper.data.units[unitId].profit={craftingPrice:0,marketPrice:0,profit:0}},SET_hqLevel(){"use strict";const headquarter=rHelper.data.headquarter;if(headquarter.user){let userHqLevel=headquarter.user.level;rHelper.methods.SET_hqSelectorClass(userHqLevel-1),rHelper.methods.INSRT_headquarterPaid();let fns=["INSRT_headquarterContentRequiredAmount","INSRT_headquarterMissing","INSRT_headquarterRemainingCost"];$.each(fns,(i,fn)=>{rHelper.methods[fn](userHqLevel)})}},SET_hqSelectorClass(userHqLevel){"use strict";for(let i=0;i<=9;i+=1)userHqLevel!=i?$(`.hq-thumb-${i}`).addClass("disabled-hq"):$(`.hq-thumb-${i}`).removeClass("disabled-hq")},SET_newMap(container,zoom,type){"use strict";return new google.maps.Map(container[0],{zoom:zoom,mapTypeId:type})},SET_mapOptions(map,maxZoom,primaryMine){"use strict";return map.setOptions({maxZoom:maxZoom,center:new google.maps.LatLng(primaryMine.lat,primaryMine.lon)}),map},SET_mapImg(folder,icon,size){"use strict";return{url:`assets/img/maps/${folder}/${icon}.png`,scaledSize:new google.maps.Size(size,size)}},SET_mapInfoWindow(contentString){"use strict";return new google.maps.InfoWindow({content:contentString})},SET_mapFolderRelation(relation){"use strict";let folder="foe";return"friend"==relation&&(folder="friend"),folder},SET_mapHQHandler(map,hqObj){"use strict";const hqLevel=hqObj.level,[hqSize,radius,center]=[12.5*hqLevel,rHelper.data.headquarter[hqLevel-1].radius,{lat:hqObj.lat,lng:hqObj.lon}];rHelper.methods.SET_mapHqCircle(map,center,radius,hqObj.relation),new google.maps.Marker({map:map,position:center,icon:rHelper.methods.SET_mapImg("hq",hqLevel,hqSize)})},SET_mapHqCircle(map,hqCenter,radius,relation){let color="#FF0000";return"friend"==relation&&(color="#00FF00"),new google.maps.Circle({strokeColor:color,strokeOpacity:.8,strokeWeight:2,fillColor:color,fillOpacity:.35,map:map,center:hqCenter,radius:radius,draggable:!0})},SET_mapMineHandler(now,subObj,map,mapType){let type=subObj.type,relObj=rHelper.data.material[type],buildMilliseconds=rHelper.methods.CALC_toMilliseconds(subObj.builddate),buildDate=rHelper.methods.CALC_convertDateToIso(buildMilliseconds),age=(now-buildMilliseconds)/1e3/86400,estRevenue=rHelper.methods.CALC_mineEstRevenue(subObj,type,age),contentString=rHelper.methods.CALC_createMapContentString(relObj,buildDate,age,estRevenue,subObj),infoWindow=rHelper.methods.SET_mapInfoWindow(contentString),marker=new google.maps.Marker({map:map,position:{lat:subObj.lat,lng:subObj.lon},icon:rHelper.methods.SET_mapImg(rHelper.methods.SET_mapFolderRelation(subObj.relation),type,20)});return"personal"==mapType&&subObj.builddate==rHelper.data.mineMap.mines[0].builddate&&marker.setAnimation(google.maps.Animation.BOUNCE),google.maps.event.addListener(marker,"click",()=>{openedWindow&&openedWindow.close(),openedWindow=infoWindow,infoWindow.open(map,marker)}),marker},SET_overTimeGraph(){"use strict";const data=rHelper.data.mineMap.mines;let[timestamps,mineCount,avgMinePrice,income,hours]=[[],[],[],[],[]];for(let hour=0;hour<=23;hour+=1)hours.push([`${hour} to ${hour+1}`,0]);$.each(data,(index,subObj)=>{let buildHour=new Date(rHelper.methods.CALC_toMilliseconds(subObj.builddate)).getHours();hours[buildHour][1]+=1}),Highcharts.chart("graph-buildinghabits",{chart:{type:"column",backgroundColor:"transparent"},title:{text:"Building habits per hour",style:{color:"#dedede"}},xAxis:{type:"category",labels:{rotation:-45,style:{fontSize:"13px",fontFamily:"Verdana, sans-serif",color:"#dedede"}}},yAxis:{min:0,title:{text:"Amount of mines",style:{color:"#dedede"}},labels:{style:{color:"#dedede"}}},legend:{enabled:!1},tooltip:{pointFormat:"Mines built at this hour: <b>{point.y}</b>"},series:[{name:"Mines",data:hours,dataLabels:{enabled:!0,rotation:-90,color:"#dedede",align:"right",y:10,style:{fontSize:"13px",fontFamily:"Verdana, sans-serif",color:"#dedede"}}}]});let firstMine=data[0].builddate,lastMine,daysSinceFirstMine=(data[data.length-1].builddate-firstMine)/86400;timestamps.push(rHelper.methods.CALC_toMilliseconds(firstMine));for(let i=0;i<=daysSinceFirstMine;i+=1){let date=rHelper.methods.CALC_toMilliseconds(firstMine+86400*i);timestamps.push(date)}$.each(timestamps,(i,ts)=>{let mineCountAtGivenTS=0,sum=0,totalIncomeAtGivenTS=0;$.each(data,(index,subObj)=>{let builddate;rHelper.methods.CALC_toMilliseconds(subObj.builddate)<=ts&&(mineCountAtGivenTS+=1,totalIncomeAtGivenTS+=rHelper.methods.CALC_returnPriceViaId(subObj.type)*subObj.fullRate)}),$.each(rHelper.data.material,k=>{sum+=rHelper.methods.CALC_materialNewMinePrice(mineCountAtGivenTS,k)}),income.push(Math.round(totalIncomeAtGivenTS)),mineCount.push(mineCountAtGivenTS),avgMinePrice.push(Math.round(sum/14)),timestamps[i]=rHelper.methods.CALC_convertDateToIso(ts)}),Highcharts.chart("graph-overtime",{chart:{type:"spline",zoomType:"x",backgroundColor:"transparent"},title:{useHTML:!0,text:"Progress graph",style:{color:"#dedede"}},xAxis:{categories:timestamps,labels:{style:{color:"#dedede"}}},yAxis:{title:{text:"Price or mine count over time",style:{color:"#dedede"}},labels:{formatter:function(){return this.value.toLocaleString("en-US")},style:{color:"#dedede"}}},legend:{enabled:!0,backgroundColor:"#dedede"},tooltip:{crosshairs:!0,shared:!0},plotOptions:{spline:{marker:{radius:4,lineColor:"#666666",lineWidth:1}}},series:[{name:"Mine count",marker:{symbol:"square"},data:mineCount,color:"orange"},{name:"Average cost of a new mine",marker:{symbol:"diamond"},data:avgMinePrice,color:"coral"},{name:"Average income at given time",marker:{symbol:"triangle"},data:income,color:"yellowgreen"}]})},EVNT_enableTippy(){"use strict";$.each($("[title]"),(i,el)=>{el._tippy||tippy(el,{dynamicTitle:!0})})},EVNT_assignTitleToIconsHelper(min,max,subSelector,incrementor){"use strict";for(let i=min;i<=max;i+=1)$.each($(`.resources-${subSelector}-${i}`),(k,el)=>{if(!$(el).attr("title")){let convertedId=i+incrementor;$(el).attr("title",rHelper.methods.CALC_returnPriceViaId(convertedId).toLocaleString("en-US"))}})},EVNT_assignTitleToIcons(){"use strict";rHelper.methods.EVNT_assignTitleToIconsHelper(0,13,"material",0),rHelper.methods.EVNT_assignTitleToIconsHelper(0,21,"product",14),rHelper.methods.EVNT_assignTitleToIconsHelper(0,16,"loot",36),rHelper.methods.EVNT_assignTitleToIconsHelper(0,5,"unit",52)},EVNT_sortableTables(){"use strict";let tables=[$("#module-mines table")[0],$("#module-factories table")[0],$("#module-diamond table")[0],$("#techupgrades-combinations-tbl")[0],$("#recycling-tbl")[0],$("#units-tbl")[0]];$.each(tables,(index,table)=>{sorttable.makeSortable(table),2==index?sorttable.innerSortFunction.apply($("#module-diamond th")[5],[]):4==index&&(sorttable.innerSortFunction.apply($("#techupgrades-combinations-tbl th")[5],[]),sorttable.innerSortFunction.apply($("#techupgrades-combinations-tbl th")[5],[]))})},EVNT_factoryInput(factoryId){"use strict";$(`#factories-level-${factoryId}`).on("input",function(){let factoryId=parseInt(this.id.replace("factories-level-","")),factoryLevel=parseInt(this.value);rHelper.methods.SET_globalObject("products",factoryId,"factoryLevel",factoryLevel);let fns=["INSRT_factoryOutput","INSRT_factoryUpgradeCost","INSRT_factoryDependencies","INSRT_factoryWorkload","INSRT_factoryTurnover","INSRT_factoryTurnoverPerUpgrade","INSRT_factoryROI","INSRT_diamondFactoryLevel","INSRT_diamondFactoryOutput","INSRT_diamondFactoryOutputWarehouse","INSRT_diamondDependencies","INSRT_diamondEfficiency","INSRT_diamondProfit"];$.each(fns,(i,fn)=>{rHelper.methods[fn](factoryId)}),rHelper.methods.CALC_dependantFactories(factoryId,"product"),rHelper.methods.INSRT_diamondTop10Profit(),rHelper.methods.INSRT_diamondTotalProfit(),rHelper.methods.INSRT_flowRate(factoryId,"product"),rHelper.methods.INSRT_flowDistributionGlobal(),rHelper.methods.INSRT_factoryHighlightColumns()})},EVNT_materialInput(materialId){"use strict";$(`#material-rate-${materialId}`).on("input",function(){let materialId=this.id.replace("material-rate-",""),materialAmount=parseInt(this.value);rHelper.methods.SET_globalObject("material",materialId,"perHour",materialAmount),rHelper.methods.INSRT_materialRateWorth(materialId),rHelper.methods.INSRT_totalMineWorth(rHelper.methods.CALC_totalMineWorth()),rHelper.methods.CALC_dependantFactories(materialId,"material"),rHelper.methods.INSRT_flowRate(materialId,"material"),rHelper.methods.INSRT_flowDistributionGlobal(),rHelper.methods.EVNT_buildGraph("material")}),$(`#material-amount-of-mines-${materialId}`).on("input",function(){let materialId=this.id.replace("material-amount-of-mines-",""),materialAmountOfMines=parseInt(this.value);rHelper.methods.SET_globalObject("material",materialId,"amountOfMines",materialAmountOfMines),$.each(rHelper.data.material,materialId=>{rHelper.methods.INSRT_materialNewMinePrice(materialId)}),rHelper.methods.INSRT_warehouseRemainingTimeToFull(materialId,"material"),rHelper.methods.INSRT_materialMineAmortisation(),rHelper.methods.INSRT_totalMineCount(rHelper.methods.CALC_totalMineCount()),rHelper.methods.EVNT_buildGraph("material")})},EVNT_warehouseInput(id,type){"use strict";$(`#warehouse-${type}-calc-2-${id}`).on("input",function(){let value=parseInt(this.value);isNaN(value)&&(value=0),rHelper.methods.INSRT_warehouseUpgradeCost(id,type,value)}),$(`#warehouse-${type}-calc-1-${id}`).on("change",()=>{$(`#warehouse-${type}-upgrade-cost-${id}`).empty(),$(`#warehouse-${type}-calc-2-${id}`).val(0)}),$(`#warehouse-${type}-stock-current-${id}`).on("input",function(){let value=parseInt(this.value);isNaN(value)&&(value=0);let newFillStatus=value/rHelper.data[type][id].warehouse.contingent;rHelper.methods.SET_globalObject(type,id,["warehouse","fillAmount"],value),rHelper.methods.SET_globalObject(type,id,["warehouse","fillStatus"],newFillStatus);let fns=["INSRT_warehouseWorth","INSRT_warehouseFillStatus","INSRT_warehouseRemainingTimeToFull"];$.each(fns,(i,fn)=>{rHelper.methods[fn](id,type)}),rHelper.methods.INSRT_warehouseTotalWorth()}),$(`#warehouse-${type}-level-${id}`).on("input",function(){let value=parseInt(this.value);isNaN(value)&&(value=0);let el=rHelper.data[type][id].warehouse;rHelper.methods.SET_globalObject(type,id,["warehouse","level"],value),rHelper.methods.SET_globalObject(type,id,["warehouse","contingent"],rHelper.methods.CALC_warehouseContingent(value)),rHelper.methods.SET_globalObject(type,id,["warehouse","fillStatus"],el.fillAmount/el.contingent);let fns=["INSRT_warehouseCapacity","INSRT_warehouseFillStatus","INSRT_warehouseRemainingTimeToFull"];$.each(fns,(i,fn)=>{rHelper.methods[fn](id,type)}),rHelper.methods.INSRT_warehouseTotalLevel()})},EVNT_buildingChange(buildingId){"use strict";$(`#buildings-level-${buildingId}`).on("change",function(){let value=parseInt(this.value);rHelper.methods.SET_globalObject("buildings",buildingId,"level",value),9==buildingId?rHelper.methods.SET_transportCost():5==buildingId&&rHelper.methods.SET_recyclingPlantLevel(),3!=buildingId&&4!=buildingId&&9!=buildingId||$.each(rHelper.data.units,unitId=>{rHelper.methods.INSRT_unitsPricePerStrength(unitId)});let fns=["INSRT_buildingData","INSRT_buildingToLevel10","SET_buildingBackgroundColor"];$.each(fns,(i,fn)=>{rHelper.methods[fn](buildingId)}),rHelper.methods.INSRT_gaugeGraph("buildings")})},EVNT_buildGraph(type){"use strict";rHelper.graphs=rHelper.graphs||{};let parentGraphObj=rHelper.graphs.material;rHelper.graphs.material.reference.mineCount=rHelper.methods.CALC_totalMineCount(),rHelper.graphs.material.reference.mineIncome=rHelper.methods.CALC_totalMineWorth(),$.each(rHelper.data.material,(i,material)=>{let iteration={y:0,color:"",drilldown:{categories:[],data:[],color:""}},mineAmountPercent=parseFloat((material.amountOfMines/rHelper.graphs.material.reference.mineCount*100).toFixed(2)),mineIncomePercent=parseFloat((rHelper.methods.CALC_materialRateWorth(i)/rHelper.graphs.material.reference.mineIncome*100).toFixed(2)),materialName=material.name;isNaN(mineAmountPercent)?iteration.y=0:iteration.y=mineAmountPercent;let mineDataObj={name:materialName,y:iteration.y,color:iteration.color};iteration.color=rHelper.graphs.material.colors[i],iteration.drilldown.color=rHelper.graphs.material.colors[i],iteration.drilldown.categories[i]=materialName,iteration.drilldown.name=materialName,isNaN(mineIncomePercent)?iteration.drilldown.data[i]=0:iteration.drilldown.data[i]=mineIncomePercent,JSON.stringify(rHelper.graphs.material.mineData[i])!==JSON.stringify(mineDataObj)&&(rHelper.graphs.material.mineData[i]=mineDataObj);let drillDataLen=iteration.drilldown.data.length,brightness=0;for(let j=0;j<drillDataLen;j+=1)brightness=.2-j/drillDataLen/5,rHelper.graphs.material.incomeData[i]={name:iteration.drilldown.categories[j],y:iteration.drilldown.data[j],color:Highcharts.Color(iteration.color).brighten(brightness).get()};JSON.stringify(rHelper.graphs.material.data[i])!==JSON.stringify(iteration)&&(rHelper.graphs.material.data[i]=iteration)}),rHelper.methods.INSRT_polygonGraph(parentGraphObj.target,parentGraphObj.titleText,parentGraphObj.seriesNames,parentGraphObj.responsiveId,type)},EVNT_switchHeadquarter(clickedHq){"use strict";$(`.hq-thumb-${clickedHq}`).on("click",()=>{let actualLevel=parseInt(clickedHq)+1;rHelper.data.headquarter.user=rHelper.data.headquarter.user||{},rHelper.data.headquarter.user.paid=rHelper.data.headquarter.user.paid||[0,0,0,0],rHelper.data.headquarter.user.level=rHelper.data.headquarter.user.level||actualLevel,rHelper.methods.SET_globalObject("headquarter","user","level",actualLevel),rHelper.methods.SET_hqSelectorClass(clickedHq),rHelper.methods.INSRT_gaugeGraph("headquarter"),rHelper.methods.INSRT_headquarterContentRequiredAmount(actualLevel),rHelper.methods.INSRT_headquarterPaid();for(let i=0;i<=3;i+=1)rHelper.methods.INSRT_headquarterMissing(i);rHelper.methods.INSRT_headquarterRemainingCost(actualLevel),rHelper.methods.INSRT_companyWorth()})},EVNT_headquarterInput(){"use strict";$.each($("[id*='hq-content-input-']"),(i,el)=>{$(el).on("input",function(){let thisId=parseInt(this.id.replace(/hq-content-input-/,"")),thisValue=parseInt(this.value);isNaN(thisValue)?thisValue=0:thisValue>5e7&&(thisValue=5e7),rHelper.methods.SET_globalObject("headquarter","user",["paid",thisId],thisValue),rHelper.methods.INSRT_headquarterMissing(i),rHelper.methods.INSRT_headquarterRemainingCost(rHelper.data.headquarter.user.level),rHelper.methods.INSRT_gaugeGraph("headquarter"),rHelper.methods.INSRT_companyWorth()})})},EVNT_priceHistoryOnChange(){"use strict";$("#pricehistory-selector").on("change",function(){let thisVal=parseInt(this.value),url=`api/getPriceHistory.php?id=${thisVal}`,resource=rHelper.methods.CALC_convertId(thisVal),materialName=`<span style="height: 25px; width: 25px;" class="${resource.icon}"></span> ${resource.name}`;rHelper.methods.EVNT_priceHistoryToggler("loading"),$.getJSON(url,response=>{let averageKI=response.avg.ki,averagePlayer=response.avg.player,timestamps=[],player=[],ki=[];$.each(response.data,(i,dataset)=>{let date=rHelper.methods.CALC_convertDateToIso(rHelper.methods.CALC_toMilliseconds(dataset.ts));timestamps.push(date),0==dataset.player&&(dataset.player=null),player.push(dataset.player),ki.push(dataset.ki)}),rHelper.methods.EVNT_priceHistoryToggler("finished"),rHelper.methods.INSRT_priceHistoryGraph(materialName,averageKI,averagePlayer,timestamps,player,ki)})})},EVNT_priceHistoryToggler(state){"use strict";let container=$("#graph-pricehistory"),selector=$("#pricehistory-selector");switch(state){case"loading":let svg='<svg id="pricehistory-svg" xmlns="http://www.w3.org/2000/svg" style="background:0 0" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><g transform="translate(50 50)"><g transform="matrix(.6 0 0 .6 -19 -19)"><g transform="rotate(242)"><animateTransform attributeName="transform" begin="0s" dur="3s" keyTimes="0;1" repeatCount="indefinite" type="rotate" values="0;360"/><path fill="#9acd32" d="M37.3496988-7h10V7h-10a38 38 0 0 1-1.50391082 5.61267157l8.66025404 5-7 12.12435565-8.66025404-5a38 38 0 0 1-4.10876076 4.10876076l5 8.66025404-12.12435565 7-5-8.66025404A38 38 0 0 1 7 37.34969879v10H-7v-10a38 38 0 0 1-5.61267157-1.50391081l-5 8.66025404-12.12435565-7 5-8.66025404a38 38 0 0 1-4.10876076-4.10876076l-8.66025404 5-7-12.12435565 8.66025404-5A38 38 0 0 1-37.34969879 7h-10V-7h10a38 38 0 0 1 1.50391081-5.61267157l-8.66025404-5 7-12.12435565 8.66025404 5a38 38 0 0 1 4.10876076-4.10876076l-5-8.66025404 12.12435565-7 5 8.66025404A38 38 0 0 1-7-37.34969879v-10H7v10a38 38 0 0 1 5.61267157 1.50391081l5-8.66025404 12.12435565 7-5 8.66025404a38 38 0 0 1 4.10876076 4.10876076l8.66025404-5 7 12.12435565-8.66025404 5A38 38 0 0 1 37.34969879-7M0-30a30 30 0 1 0 0 60 30 30 0 1 0 0-60"/></g></g><g transform="matrix(.6 0 0 .6 19 19)"><g transform="rotate(103)"><animateTransform attributeName="transform" begin="-0.125s" dur="3s" keyTimes="0;1" repeatCount="indefinite" type="rotate" values="360;0"/><path fill="coral" d="M37.3496988-7h10V7h-10a38 38 0 0 1-1.50391082 5.61267157l8.66025404 5-7 12.12435565-8.66025404-5a38 38 0 0 1-4.10876076 4.10876076l5 8.66025404-12.12435565 7-5-8.66025404A38 38 0 0 1 7 37.34969879v10H-7v-10a38 38 0 0 1-5.61267157-1.50391081l-5 8.66025404-12.12435565-7 5-8.66025404a38 38 0 0 1-4.10876076-4.10876076l-8.66025404 5-7-12.12435565 8.66025404-5A38 38 0 0 1-37.34969879 7h-10V-7h10a38 38 0 0 1 1.50391081-5.61267157l-8.66025404-5 7-12.12435565 8.66025404 5a38 38 0 0 1 4.10876076-4.10876076l-5-8.66025404 12.12435565-7 5 8.66025404A38 38 0 0 1-7-37.34969879v-10H7v10a38 38 0 0 1 5.61267157 1.50391081l5-8.66025404 12.12435565 7-5 8.66025404a38 38 0 0 1 4.10876076 4.10876076l8.66025404-5 7 12.12435565-8.66025404 5A38 38 0 0 1 37.34969879-7M0-30a30 30 0 1 0 0 60 30 30 0 1 0 0-60"/></g></g></g></svg>';container.html(svg),selector.attr("disabled",!0);break;case"finished":container.empty(),selector.attr("disabled",!1)}},EVNT_mapCreation(mapType){"use strict";let container,data,infoNode,errorText;switch(mapType){case"personal":container=$("#personalmap"),data=rHelper.data.mineMap,infoNode=$("#personalmap-info"),errorText='Your mine map is empty! Please import "Mines - detailed" via API first.';break;case"world":container=$("#worldmap"),data=rHelper.data.worldMap,infoNode=$("#worldmap-info"),errorText="An error occured. If this problem persists, please report this issue via Discord or mail."}if(0!=data.length){let now=new Date,map=rHelper.methods.SET_newMap(container,3,"terrain");map=rHelper.methods.SET_mapOptions(map,16,data.mines[0]);let markerArr=[];switch(mapType){case"personal":rHelper.methods.SET_mapHQHandler(map,data.hq[0]);break;case"world":$.each(data.hqs,(i,hqObj)=>{rHelper.methods.SET_mapHQHandler(map,hqObj)})}$.each(data.mines,(i,subObj)=>{rHelper.methods.SET_mapMineHandler(now,subObj,map,mapType),markerArr.push(rHelper.methods.SET_mapMineHandler(now,subObj,map,mapType))});let markerCluster=new MarkerClusterer(map,markerArr,{imagePath:"assets/img/maps/cluster/m",maxZoom:15})}else infoNode.text(errorText)},EVNT_attackLogTrigger(){$("#heading-defenselog a").on("click",e=>{e.preventDefault(),rHelper.methods.API_getAttackLog("defenseSimple")}),$("#heading-attacklog-1 a").on("click",e=>{e.preventDefault(),rHelper.methods.API_getAttackLog("attackSimple")}),$("#heading-attacklog-2 a").on("click",e=>{e.preventDefault(),rHelper.methods.API_getAttackLog("attackDetailed")})},INSRT_leaderboardTable(){let container=rHelper.data.leaderboard,tbody=$("#module-leaderboard tbody"),textOrientation="text-md-right text-sm-left",textClass="class='text-right'",string="",returnPlayerTitle=dataset=>`<table>\n                <tbody>\n                    <tr><td>Rank</td><td ${textClass}>${dataset.general.rank.toLocaleString("en-US")}</td></tr>\n                    <tr><td>Registered since</td><td ${textClass}>${dataset.general.registeredGame}</td></tr>\n                    <tr><td>Days playing</td><td ${textClass}>${dataset.general.daysPlaying.toLocaleString("en-US")}</td></tr>\n                </tbody>\n                </table>`,returnCompanyWorthTitle=dataset=>`<table>\n                <thead>\n                    <tr><th colspan='2'>Money spent on...</th></tr>\n                </thead>\n                <tbody>\n                    <tr><td>Mines</td><td ${textClass}>${dataset.mineErectionSum.toLocaleString("en-US")}</td></tr>\n                    <tr><td>Factories</td><td ${textClass}>${dataset.factoryErectionSum.toLocaleString("en-US")}</td></tr>\n                    <tr><td>Headquarter</td><td ${textClass}>${dataset.headquarterSum.toLocaleString("en-US")}</td></tr>\n                    <tr><td>Buildings</td><td ${textClass}>${dataset.buildingsErectionSum.toLocaleString("en-US")}</td></tr>\n                    <tr><td>Warehouse</td><td ${textClass}>${dataset.warehouseErectionSum.toLocaleString("en-US")}</td></tr>\n                </tbody>\n                </table>`,returnString=dataset=>`\n                <tr>\n                    <td data-th="Player (hover for details)" title="${returnPlayerTitle(dataset)}">${dataset.general.name} (${dataset.general.level.toLocaleString("en-US")})</td>\n                    <td sorttable_customkey="${dataset.general.points}" data-th="Points per day (total points)" class="${textOrientation}">${dataset.general.pointsPerDay.toLocaleString("en-US")} (${dataset.general.points.toLocaleString("en-US")})</td>\n                    <td data-th="Factory upgrades" class="${textOrientation}">${dataset.factoryTotalUpgrades.toLocaleString("en-US")}</td>\n                    <td data-th="Amount of mines" class="${textOrientation}">${dataset.totalMineCount.toLocaleString("en-US")}</td>\n                    <td data-th="Mines within HQ radius" class="${textOrientation}">${dataset.headquarter.mineCount.toLocaleString("en-US")}</td>\n                    <td data-th="Mine income" class="${textOrientation}">${dataset.mineIncome.toLocaleString("en-US")}</td>\n                    <td data-th="Trade income per day" class="${textOrientation}">${dataset.tradeData.tradeIncomePerDay.toLocaleString("en-US")}</td>\n                    <td data-th="Bought goods for" class="${textOrientation}">${dataset.tradeData.totalBuy.toLocaleString("en-US")}</td>\n                    <td data-th="Sold goods for..." class="${textOrientation}">${dataset.tradeData.totalSell.toLocaleString("en-US")}</td>\n                    <td data-th="Sold goods to KI for..." class="${textOrientation}">${dataset.tradeData.sumKISell.toLocaleString("en-US")}</td>\n                    <td data-th="Company worth" class="${textOrientation}" title="${returnCompanyWorthTitle(dataset)}">${dataset.companyWorth.toLocaleString("en-US")}</td>\n                </tr>\n                `;$.each(container,(i,dataset)=>{string+=returnString(dataset)}),tbody.empty().html(string),sorttable.makeSortable($("#module-leaderboard table")[0]),sorttable.innerSortFunction.apply($("#module-leaderboard th")[10],[]),$.each($("#module-leaderboard td[title]"),function(i,el){applyTippyOnNewElement($(el))})},INSRT_leaderboard(){rHelper.data.leaderboard=rHelper.data.leaderboard||{},$.isEmptyObject(rHelper.data.leaderboard)&&$.getJSON("api/leaderboard.php",result=>{rHelper.data.leaderboard=result,rHelper.methods.INSRT_leaderboardTable()})},INSRT_tradeLog(){const container=rHelper.data.tradeLog;if(0!=container.length){const[tradeLogTbody,textOrientation,daysFilterSelect]=[$("#tradelog-tbody"),"text-md-right text-sm-left",$("#tradelog-filter-day")];tradeLogTbody.empty();let sum=0;const currentDaysFilter=daysFilterSelect.val();null!=currentDaysFilter&&$.each(daysFilterSelect.children("option"),(i,el)=>{$(el).val()==currentDaysFilter&&(rHelper.data.tradeLog.skipCount=i-1)}),daysFilterSelect.empty().prepend("<option selected disabled>jump to day X</option>"),$.each(container.days,(i,dataset)=>{daysFilterSelect.append(`<option value="${dataset.date}">${dataset.date} (${dataset.entries.toLocaleString("en-US")} entries)</option>`)}),$.each(container.log,(i,dataset)=>{const obj=rHelper.methods.CALC_convertId(dataset.itemId);let[datasetSum,action,profitClass]=[dataset.price*dataset.amount,"Selling to ","success"];0==dataset.event&&(datasetSum*=-1,action="Buying from ",profitClass="danger"),sum+=datasetSum;const template=`\n                    <tr>\n                        <td data-th="Trade partner"><span class="text-${profitClass}">${action}</span><kbd>${dataset.actor}</kbd> (${dataset.actorLevel.toLocaleString("en-US")})</td>\n                        <td data-th="Timestamp" class="${textOrientation}">${rHelper.methods.CALC_convertDateToIso(1e3*dataset.timestamp)}</td>\n                        <td data-th="Amount" class="${textOrientation}">${dataset.amount.toLocaleString("en-US")}x <span class="${obj.icon}"></span></td>\n                        <td data-th="Price" class="${textOrientation}">${dataset.price.toLocaleString("en-US")}</td>\n                        <td data-th="Sum" class="${textOrientation} text-${profitClass}">${datasetSum.toLocaleString("en-US")}</td>\n                    </tr>\n                    `;tradeLogTbody.append(template)});let profitClass="success";sum<0&&(profitClass="danger"),$("#tradelog-tfoot").empty().append(`<tr><td data-th="daily profit" colspan="5" class="${textOrientation} text-${profitClass}">${sum.toLocaleString("en-US")} <a href="#">back to top</a></td></tr>`)}},INSRT_attackLogDetailedGeneralInformation(dataContainer){$("#attacklog-detailed-units-lost-avg").html(rHelper.methods.CALC_attackLogDetailedUnitStringInsertion("offense",dataContainer.avg.unitsLost)),$("#attacklog-detailed-units-lost-total").html(rHelper.methods.CALC_attackLogDetailedUnitStringInsertion("offense",dataContainer.total.unitsLost)),$("#attacklog-detailed-factor-avg").text(`${dataContainer.avg.factor}%`),$("#attacklog-detailed-profit-avg").text(dataContainer.avg.profit.toLocaleString("en-US")),$("#attacklog-detailed-profit-total").text(dataContainer.total.profit.toLocaleString("en-US"))},INSRT_attackLogDetailed(type,dataContainer){let target=$("#attacklog-tbody-detailed");target.empty();let select=$("#attacklog-detailed-selector");2==select[0].children.length&&$.each(dataContainer.validTargets,(i,target)=>{select.append(`<option value="${target}">${target}</option>`)});let sortableTable=$("#collapse-attacklog-detailed table")[1],dataTHs=["Attacked player (level)","Timestamp & position","Units lost","Units destroyed","Lootfactor","Loot","Profit"];$.each(dataContainer.data,(i,dataset)=>{target.append(rHelper.methods.CALC_attackLogDetailedDatasetIteration(i,dataset,dataTHs))}),rHelper.methods.INSRT_attackLogDetailedGeneralInformation(dataContainer),["last","next"].forEach(type=>{rHelper.methods.CALC_attackLogDetailedPageButtonToggler(type,dataContainer)}),sorttable.makeSortable(sortableTable)},INSRT_ADLogSimple(type,data){let target=$("#attacklog-tbody-simple");target.empty();let dataTHs=["Attacked player (last known level)","Last attacked","Total attacks","Win","Loss","Average loot factor","Average amount of units used","Profit"],unitIndices=[0,2,3],textOrientation="text-md-right text-sm-left",sortableTable=$("#collapse-attacklog-simple table")[0];"defenseSimple"==type&&(dataTHs[0]="Attacking player (last known level)",sortableTable=$("#collapse-defenselog-simple table")[0],target=$("#defenselog-tbody-simple")),$.each(data,(i,dataset)=>{let tr=$(crEl("tr")),factorBgColorClass="bg-success-25";for(let index=0;index<=7;index+=1){let td=$(crEl("td")).attr("data-th",dataTHs[index]),loss=0,winPercent=0,factor=0,unitsContent="";switch(index){case 0:td.text(`${dataset.targetName} (${dataset.targetLevel})`);break;case 1:td.text(rHelper.methods.CALC_convertDateToIso(dataset.lastAttacked));break;case 2:winPercent=(dataset.sumWin/dataset.sumAttacks*100).toFixed(2),td.text(`${dataset.sumAttacks.toLocaleString("en-US")} (${winPercent}%)`).addClass(textOrientation);break;case 3:"defenseSimple"==type?(loss=dataset.sumAttacks-dataset.sumWin,td.text(loss.toLocaleString("en-US")).addClass(textOrientation)):"attackSimple"==type&&td.text(dataset.sumWin.toLocaleString("en-US")).addClass(textOrientation);break;case 4:"defenseSimple"==type?td.text(dataset.sumWin.toLocaleString("en-US")).addClass(textOrientation):"attackSimple"==type&&(loss=dataset.sumAttacks-dataset.sumWin,td.text(loss.toLocaleString("en-US")).addClass(textOrientation));break;case 5:dataset.factor<1&&(factorBgColorClass="bg-warning-25"),factor=(100*dataset.factor).toFixed(2),td.text(`${factor}%`).addClass(`${textOrientation} ${factorBgColorClass}`);break;case 6:for(let k=0;k<=2;k+=1){let span=$(crEl("span"));span.addClass(`resources-unit-${unitIndices[k]}`);let unitAmount=dataset[`unit${k}`];null==unitAmount&&(unitAmount=0),unitsContent+=`${span[0].outerHTML} ${unitAmount.toLocaleString("en-US")} `}td.html(unitsContent);break;case 7:let profit=dataset.profit;null==profit&&(profit=0);let unitLossValue=dataset.unitLossValue;null!=unitLossValue&&(profit-=unitLossValue),td.text(profit.toLocaleString("en-US")).addClass(textOrientation)}tr.addClass(rHelper.methods.CALC_attackLogSetTRColor(dataset.profit)).append(td)}target.append(tr)}),sorttable.makeSortable(sortableTable)},INSRT_attackLog(type){let data=rHelper.data.attackLog,fn;switch(type){case"attackSimple":case"defenseSimple":fn="INSRT_ADLogSimple";break;case"attackDetailed":fn="INSRT_attackLogDetailed"}rHelper.methods[fn](type,data)},INSRT_materialData(materialId,api){"use strict";let fns=["INSRT_materialRate","INSRT_materialAmountOfMines","INSRT_materialNewMinePrice","INSRT_materialRateWorth","INSRT_materialNewMinePerfectIncome"];$.each(fns,(i,fn)=>{rHelper.methods[fn](materialId)}),api&&rHelper.methods.CALC_dependantFactories(materialId,"material"),rHelper.methods.INSRT_flowRate(materialId,"material")},INSRT_factoryDiamondData(factoryId,type){"use strict";let fns=["INSRT_factoryLevel","INSRT_factoryOutput","INSRT_factoryUpgradeCost","INSRT_factoryDependencies","INSRT_factoryWorkload","INSRT_factoryTurnover","INSRT_factoryTurnoverPerUpgrade","INSRT_factoryROI","INSRT_diamondFactoryOutput","INSRT_diamondFactoryOutputWarehouse","INSRT_diamondDependencies","INSRT_diamondEfficiency","INSRT_diamondProfit"];$.each(fns,(i,fn)=>{rHelper.methods[fn](factoryId)}),rHelper.methods.INSRT_flowRate(factoryId,type)},INSRT_recycling(index){"use strict";let fns=["INSRT_recyclingRequirement","INSRT_recyclingProducts","INSRT_recyclingOutputWorth","INSRT_recyclingInputWorth"];$.each(fns,(i,fn)=>{rHelper.methods[fn](index)}),rHelper.methods.INSRT_unitsRecyclingProfit("recycling",index)},INSRT_warehouseData(index,type){"use strict";let fns=["INSRT_warehouseFillAmount","INSRT_warehouseLevel","INSRT_warehouseFillStatus","INSRT_warehouseCapacity","INSRT_warehouseWorth","EVNT_warehouseInput"];$.each(fns,(i,fn)=>{rHelper.methods[fn](index,type)}),"products"!=type&&"material"!=type||rHelper.methods.INSRT_warehouseRemainingTimeToFull(index,type)},INSRT_priceHistoryGraph(materialName,averageKI,averagePlayer,timestamps,player,ki){"use strict";Highcharts.chart("graph-pricehistory",{chart:{type:"spline",zoomType:"x"},title:{useHTML:!0,text:`Price history for ${materialName}`},subtitle:{text:"last 28 days"},xAxis:{categories:timestamps},yAxis:{title:{text:"Price"},labels:{formatter:function(){return this.value.toLocaleString("en-US")}},plotLines:[{color:"red",value:averageKI,width:"1",zIndex:5,label:{text:`average KI price of ${averageKI.toLocaleString("en-US")}`,align:"right",style:{color:"darkgreen"}}},{color:"darkgreen",value:averagePlayer,width:"1",zIndex:5,label:{text:`average player price of ${averagePlayer.toLocaleString("en-US")}`,align:"right",style:{color:"orange"}}}]},legend:{enabled:!1},tooltip:{crosshairs:!0,shared:!0},plotOptions:{spline:{marker:{radius:4,lineColor:"#666666",lineWidth:1}}},series:[{name:"KI",marker:{symbol:"square"},color:"darkgreen",data:ki},{name:"Player",marker:{symbol:"diamond"},color:"orange",data:player}]})},INSRT_polygonGraph(target,titleText,seriesNames,responsiveId,targetObj){"use strict";let dataObj=rHelper.graphs[targetObj];Highcharts.chart(target,{chart:{type:"pie",backgroundColor:"transparent"},title:{text:titleText,style:{color:"#dedede"}},plotOptions:{pie:{shadow:!1,center:["50%","50%"]}},tooltip:{valueSuffix:"%"},series:[{name:seriesNames[0],data:dataObj.mineData,colors:dataObj.colors,size:"60%",dataLabels:{formatter:function(){return this.y>5?this.point.name:null},color:"#dedede",distance:-30}},{name:seriesNames[1],data:dataObj.incomeData,colors:dataObj.colors,size:"80%",innerSize:"60%",dataLabels:{formatter:function(){return this.y>1?`<b> ${this.point.name} :</b> ${this.y} %`:null},style:{color:"white",textOutline:"none"}},id:responsiveId}],responsive:{rules:[{condition:{maxWidth:400},chartOptions:{series:[{id:responsiveId,dataLabels:{enabled:!1}}]}}]}})},INSRT_gaugeGraph(type){"use strict";"buildings"==type?Highcharts.chart("graph-buildings",Highcharts.merge(rHelper.graphs.gaugeOptions,{yAxis:{min:0,max:rHelper.methods.CALC_perfectWorth("buildings"),title:{text:"total building worth"}},series:[{name:"total building worth",data:[rHelper.methods.CALC_totalBuildingErectionSum()]}]})):"headquarter"==type&&Highcharts.chart("graph-headquarter",Highcharts.merge(rHelper.graphs.gaugeOptions,{yAxis:{min:0,max:rHelper.methods.CALC_perfectWorth("headquarter"),title:{text:"total headquarter worth"}},series:[{name:"total headquarter worth",data:[rHelper.methods.CALC_totalHeadquarterErectionSum()]}]}))},INSRT_totalMineWorth(totalMineWorth){"use strict";$("#material-total-worth").text(totalMineWorth.toLocaleString("en-US"))},INSRT_totalMineCount(totalMineCount){"use strict";$("#material-total-mine-count").text(totalMineCount.toLocaleString("en-US"))},INSRT_materialRate(materialId){"use strict";$(`#material-rate-${materialId}`).val(rHelper.data.material[materialId].perHour)},INSRT_materialAmountOfMines(materialId){"use strict";$(`#material-amount-of-mines-${materialId}`).val(rHelper.data.material[materialId].amountOfMines)},INSRT_userSettings(){"use strict";let userInfo=rHelper.data.userInformation;$("#security-token").text(userInfo.securityToken),""!=userInfo.realKey&&void 0!==typeof userInfo.realKey&&($("#api-key").val(userInfo.realKey),rHelper.methods.INSRT_API_remainingCredits(userInfo.remainingCredits)),""!=userInfo.name&&$("#api-player-anonymity")[0].parentNode.remove(),$.each(rHelper.data.settings,(index,setting)=>{let value=0;switch(setting.setting){case"lang":switch(setting.value){case"de":value=0;break;case"en":value=1;break;case"fr":value=2;break;case"in":value=3;break;case"jp":value=4;break;case"ru":value=5}$("#settings-language").val(value);break;case"customTU":for(let i=0;i<=3;i+=1)$(`#settings-custom-tu-${i+1}`).val(setting.value[i]);break;case"idealCondition":1===setting.value&&$("#settings-ideal-conditions").prop("checked",!0);break;case"transportCostInclusion":1===setting.value&&$("#settings-toggle-transport-cost-inclusion").prop("checked",!0);break;case"mapVisibleHQ":1===setting.value&&$("#settings-hq-visibility").val(1);break;case"priceAge":$("#settings-price-age").val(setting.value)}})},INSRT_materialNewMinePrice(materialId){"use strict";$(`#material-new-price-${materialId}`).text(rHelper.methods.CALC_materialNewMinePrice(rHelper.methods.CALC_totalMineCount(),materialId).toLocaleString("en-US"))},INSRT_materialRateWorth(materialId){"use strict";$(`#material-worth-${materialId}`).text(rHelper.methods.CALC_materialRateWorth(materialId).toLocaleString("en-US"))},INSRT_materialMineAmortisation(){"use strict";let roi100Array=rHelper.methods.CALC_materialMineROI("100"),roi500Array=rHelper.methods.CALC_materialMineROI("505"),roiXArray=rHelper.methods.CALC_materialMineROI("505hq");$.each(roi100Array,(i,value)=>{$(`#material-roi-100-${i}`).text(value.toFixed(2).toLocaleString("en-US"))}),$.each(roi500Array,(i,value)=>{$(`#material-roi-500-${i}`).text(value.toFixed(2).toLocaleString("en-US"))}),$.each(roiXArray,(i,value)=>{$(`#material-roi-x-${i}`).text(value.toFixed(2).toLocaleString("en-US"))}),rHelper.methods.INSRT_materialHighlightColumns(roi100Array,"#material-roi-100-","text-success","text-danger"),rHelper.methods.INSRT_materialHighlightColumns(roi500Array,"#material-roi-500-","text-success","text-danger"),rHelper.methods.INSRT_materialHighlightColumns(roiXArray,"#material-roi-x-","text-success","text-danger")},INSRT_materialNewMinePerfectIncome(materialId){"use strict";$(`#material-perfect-income-${materialId}`).text(rHelper.methods.CALC_materialMinePerfectIncome(materialId).toLocaleString("en-US"))},INSRT_materialHighlightMinePerfectIncome(){"use strict";let array=[];$.each(rHelper.data.material,materialId=>{array.push(rHelper.methods.CALC_materialMinePerfectIncome(materialId))}),rHelper.methods.INSRT_materialHighlightColumns(array,"#material-perfect-income-","text-danger","text-success")},INSRT_materialHighlightColumns(array,target,minClass,maxClass){"use strict";let selectors=["min","max"],value=0,addClass,rmvClass;$.each(selectors,(i,selector)=>{switch(selector){case"min":value=array.min(),addClass=minClass,rmvClass=maxClass;break;case"max":value=array.max(),addClass=maxClass,rmvClass=minClass}let el;$(target+array.indexOf(value)).removeClass(rmvClass).addClass(addClass)})},INSRT_factoryLevel(factoryId){"use strict";let factoryLevel=rHelper.data.products[factoryId].factoryLevel;$(`#factories-level-${factoryId}`).val(factoryLevel),$(`#diamond-level-${factoryId}`).text(factoryLevel)},INSRT_factoryOutput(factoryId){"use strict";$(`#factories-product-${factoryId}`).text(rHelper.methods.CALC_factoryOutput(factoryId).toLocaleString("en-US"))},INSRT_factoryUpgradeCost(factoryId){"use strict";let target=$(`#factories-upgrade-cost-${factoryId}`),calculateFactoryUpgradeCostObj=rHelper.methods.CALC_factoryUpgradeCost(factoryId);target.text(calculateFactoryUpgradeCostObj.sum.toLocaleString("en-US")),target.attr("title",calculateFactoryUpgradeCostObj.title),applyTippyOnNewElement(target)},INSRT_totalFactoryUpgrades(){"use strict";$("#factories-total-upgrades").text(rHelper.methods.CALC_totalFactoryUpgrades().toLocaleString("en-US"))},INSRT_factoryDependencies(factoryId){"use strict";let product,dependencies=rHelper.data.products[factoryId].dependencies,dependencyString="";if($.isArray(dependencies))$.each(dependencies,(dependencyIndex,dependency)=>{let dependantObj=rHelper.methods.CALC_convertId(dependency),price=rHelper.methods.CALC_returnPriceViaId(dependency).toLocaleString("en-US"),requiredAmount=rHelper.methods.CALC_factoryDependencyRequiredAmount(factoryId,dependencyIndex),existingAmount=rHelper.methods.CALC_factoryDependencyExistingAmount(dependantObj,dependencyIndex),addClass=rHelper.methods.CALC_factoryComparatorRequiredVsExistingAmount(requiredAmount,existingAmount),outerSpan=$(crEl("span")),imgSpan=$(crEl("span")),innerSpan=$(crEl("span"));imgSpan.addClass(dependantObj.icon).attr("title",price.toLocaleString("en-US")),innerSpan.addClass(addClass).text(requiredAmount.toLocaleString("en-US")),outerSpan.append(`${imgSpan[0].outerHTML} ${innerSpan[0].outerHTML} `),dependencyString+=outerSpan[0].outerHTML});else{let dependantObj=rHelper.methods.CALC_convertId(dependencies),price=rHelper.methods.CALC_returnPriceViaId(dependencies).toLocaleString("en-US"),requiredAmount=rHelper.methods.CALC_factoryDependencyRequiredAmount(factoryId,0),existingAmount=rHelper.methods.CALC_factoryDependencyExistingAmount(dependantObj,0),addClass=rHelper.methods.CALC_factoryComparatorRequiredVsExistingAmount(requiredAmount,existingAmount),outerSpan=$(crEl("span")),imgSpan=$(crEl("span")),innerSpan=$(crEl("span"));imgSpan.addClass(dependantObj.icon).attr("title",price.toLocaleString("en-US")),innerSpan.addClass(addClass).text(requiredAmount.toLocaleString("en-US")),outerSpan.append(`${imgSpan[0].outerHTML} ${innerSpan[0].outerHTML} `),dependencyString+=outerSpan[0].outerHTML}$(`#factories-dependencies-${factoryId}`).html(dependencyString)},INSRT_factoryAmortisation(factoryId){"use strict";let target=`#factories-roi-${factoryId}`,amortisation=rHelper.methods.CALC_factoryAmortisation(factoryId);amortisation=amortisation<0||amortisation==1/0?"∞":amortisation.toFixed(2),$(target).text(amortisation)},INSRT_factoryWorkload(factoryId){"use strict";let target=$(`#factories-workload-${factoryId}`),dependencies=rHelper.data.products[factoryId].dependencies;if(rHelper.data.products[factoryId].dependencyWorkload=[],$.isArray(dependencies))$.each(dependencies,dependencyIndex=>{let dependencyWorkload=rHelper.methods.CALC_factoryDepedencyWorkload(factoryId,dependencyIndex);rHelper.data.products[factoryId].dependencyWorkload.push(dependencyWorkload)});else{let dependencyWorkload=rHelper.methods.CALC_factoryDepedencyWorkload(factoryId,0);rHelper.data.products[factoryId].dependencyWorkload.push(dependencyWorkload)}let workload=rHelper.methods.CALC_factoryWorkloadMinNonSanitized(factoryId),removeClass,addClass;workload>=1?(removeClass="text-danger",addClass="text-success"):(removeClass="text-success",addClass="text-danger"),target.removeClass(removeClass).addClass(addClass),target.text((100*workload).toFixed(2)+" %")},INSRT_factoryTurnover(factoryId){"use strict";let target=$(`#factories-turnover-${factoryId}`),turnover=rHelper.methods.CALC_factoryTurnover(factoryId),removeClass,addClass;turnover<=0?(removeClass="text-success",addClass="text-danger"):(removeClass="text-danger",addClass="text-success"),rHelper.data.products[factoryId].turnover=turnover,target.removeClass(removeClass).addClass(addClass),target.text(turnover.toLocaleString("en-US"))},INSRT_factoryHighlightColumns(){"use strict";let subArray,columns=["#factories-upgrade-cost-","#factories-increase-per-upgrade-","#factories-roi-","#diamond-profit-"];$.each(columns,(i,column)=>{switch(i){case 0:subArray="upgradeCost";break;case 1:subArray="turnoverIncrease";break;case 2:subArray="roi";break;case 3:subArray=[]}let valueArray=[],idArray=[];$.each(rHelper.data.products,(k,factory)=>{$(column+k).removeClass("text-success text-danger");let value=0;value="object"==typeof subArray?factory.diamond.profit:factory[subArray],rHelper.data.products[k].turnover>0&&value!=-1/0&&value!=1/0&&value>0&&(valueArray.push(value),idArray.push(k))});let arrayMin=idArray[valueArray.indexOf(valueArray.min())],arrayMax=idArray[valueArray.indexOf(valueArray.max())];switch(i){case 0:case 2:$(column+arrayMin).addClass("text-success"),arrayMin!=arrayMax&&$(column+arrayMax).addClass("text-danger");break;case 1:case 3:$(column+arrayMax).addClass("text-success"),arrayMin!=arrayMax&&$(column+arrayMin).addClass("text-danger")}})},INSRT_factoryROI(factoryId){"use strict";let target=$(`#factories-roi-${factoryId}`),roi=rHelper.methods.CALC_factoryROI(factoryId);rHelper.data.products[factoryId].roi=roi,roi=roi<0||roi===1/0?"∞":roi.toFixed(2),target.text(roi.toLocaleString("en-US"))},INSRT_factoryTurnoverPerUpgrade(factoryId){"use strict";let target=$(`#factories-increase-per-upgrade-${factoryId}`),turnoverPerUpgrade=rHelper.methods.CALC_factoryTurnoverPerUpgrade(factoryId);rHelper.data.products[factoryId].turnoverIncrease=turnoverPerUpgrade,target.text(turnoverPerUpgrade.toLocaleString("en-US"))},INSRT_API_remainingCredits(value){"use strict";value&&$("#api-credits").text(value.toLocaleString("en-US")+" Credits left")},INSRT_diamondFactoryOutput(factoryId){"use strict";$(`#diamond-product-${factoryId}`).text(rHelper.methods.CALC_diamondFactoryOutput(factoryId).toLocaleString("en-US"))},INSRT_diamondFactoryOutputWarehouse(factoryId){"use strict";let diamondFactoryOutput=rHelper.methods.CALC_diamondFactoryOutput(factoryId),requiredWarehouseLevel=rHelper.methods.CALC_nextGreaterWarehouseLevel(diamondFactoryOutput);$(`#diamond-product-warehouse-${factoryId}`).text(requiredWarehouseLevel.toLocaleString("en-US"))},INSRT_diamondDependenciesHelper(dependantObj,price,requiredAmount,factoryId,warehouseIconSpan){"use strict";let requiredWarehouseLevel=rHelper.methods.CALC_nextGreaterWarehouseLevel(requiredAmount);rHelper.data.products[factoryId].diamond.dependenciesWorth+=price*requiredAmount;let imgSpan=$(crEl("span")).addClass(dependantObj.icon).attr("title",price.toLocaleString("en-US")),innerSpan=$(crEl("span")).text(requiredAmount.toLocaleString("en-US")),warehouseSamp=$(crEl("span")).text(requiredWarehouseLevel),kbd=$(crEl("kbd")).append(`${warehouseIconSpan[0].outerHTML} ${warehouseSamp[0].outerHTML}`),outerSpan;return $(crEl("span")).append(`${imgSpan[0].outerHTML} ${innerSpan[0].outerHTML} ${kbd[0].outerHTML} `)[0].outerHTML},INSRT_diamondDependencies(factoryId){"use strict";let product,dependencies=rHelper.data.products[factoryId].dependencies,dependencyString="",warehouseIconSpan=$(crEl("span")).addClass("nav-icon-warehouses");if($.isArray(dependencies))$.each(dependencies,(dependencyIndex,dependency)=>{let dependantObj=rHelper.methods.CALC_convertId(dependency),price=rHelper.methods.CALC_returnPriceViaId(dependency),requiredAmount=5*rHelper.methods.CALC_factoryDependencyRequiredAmount(factoryId,dependencyIndex)*24;dependencyString+=rHelper.methods.INSRT_diamondDependenciesHelper(dependantObj,price,requiredAmount,factoryId,warehouseIconSpan)});else{let dependantObj=rHelper.methods.CALC_convertId(dependencies),price=rHelper.methods.CALC_returnPriceViaId(dependencies),requiredAmount=5*rHelper.methods.CALC_factoryDependencyRequiredAmount(factoryId,0)*24;dependencyString+=rHelper.methods.INSRT_diamondDependenciesHelper(dependantObj,price,requiredAmount,factoryId,warehouseIconSpan)}$(`#diamond-dependencies-${factoryId}`).html(dependencyString)},INSRT_diamondEfficiency(factoryId){"use strict";$(`#diamond-efficiency-${factoryId}`).text((100*rHelper.methods.CALC_diamondEfficiency(factoryId)).toFixed(2).toLocaleString("en-US")+"%")},INSRT_diamondProfit(factoryId){"use strict";$(`#diamond-profit-${factoryId}`).text(rHelper.methods.CALC_diamondProfit(factoryId).toLocaleString("en-US"))},INSRT_diamondFactoryLevel(factoryId){"use strict";$(`#diamond-level-${factoryId}`).text(rHelper.data.products[factoryId].factoryLevel)},INSRT_diamondTop10Profit(){"use strict";let top10Profit=rHelper.methods.CALC_diamondTop10Profit().toLocaleString("en-US");$("#diamond-top-10").text(top10Profit)},INSRT_diamondTotalProfit(){"use strict";let totalProfit=rHelper.methods.CALC_diamondTotalProfit().toLocaleString("en-US");$("#diamond-total").text(totalProfit)},INSRT_flowRate(id,type){"use strict";let target=$(`#flow-${type}-rate-${id}`),rate=rHelper.methods.CALC_flowRate(id,type);"product"==type&&rHelper.data.products[id].turnover<0&&(rate=0),target.text(rate.toLocaleString("en-US"))},INSRT_flowDistributionGlobal(){"use strict";let materialTotal=0,productsTotal=0,materialColor="yellowgreen",productColor="yellowgreen";$.each(rHelper.data.material,materialId=>{materialTotal+=rHelper.methods.INSRT_flowDistributionSingle(materialId,"material")});let calculationOrder=rHelper.methods.GET_calculationOrder();$.each(calculationOrder,(index,factoryId)=>{productsTotal+=rHelper.methods.INSRT_flowDistributionSingle(factoryId,"product")}),materialTotal<0&&(materialColor="coral"),productsTotal<0&&(productColor="coral"),rHelper.data.material.totalIncomePerHour=materialTotal,rHelper.data.products.totalIncomePerHour=productsTotal,$("#flow-material-total").text(materialTotal.toLocaleString("en-US")).css("color",materialColor),$("#flow-products-total").text(productsTotal.toLocaleString("en-US")).css("color",productColor),$("#effective-hourly-income").text((materialTotal+productsTotal).toLocaleString("en-US"))},INSRT_flowSurplus(id,type,remainingAmount){"use strict";let surplusTarget=$(`#flow-${type}-surplus-${id}`),color="#dedede";remainingAmount<=0&&(color="coral"),surplusTarget.css("color",color),surplusTarget.html(`<span class="resources-${type}-${id}"></span> ${remainingAmount.toLocaleString("en-US")}`)},INSRT_flowDistributionSingle(id,type){"use strict";let worthTarget=$(`#flow-${type}-worth-${id}`),price=0,worth=0,remainingAmount=rHelper.methods.CALC_flowDistribution(id,type),color="yellowgreen",productionCost=0;switch(type){case"material":price=rHelper.methods.CALC_returnPriceViaId(id);break;case"product":price=rHelper.methods.CALC_returnPriceViaId(id+14)}switch("product"==type&&(rHelper.data.products[id].turnover<0?(remainingAmount*=-1,""==rHelper.data.products[id].dependantFactories&&(remainingAmount=0)):productionCost=rHelper.methods.CALC_factoryCashCostPerHour(id)),worth=remainingAmount*price,remainingAmount<0&&(worth*=rHelper.data.buildings[9].transportCost,color="coral"),worth=Math.round(worth-productionCost),type){case"material":rHelper.data.material[id].effectiveTurnover=worth;break;case"product":rHelper.data.products[id].effectiveTurnover=worth}return worthTarget.css("color",color).text(worth.toLocaleString("en-US")),rHelper.methods.INSRT_flowSurplus(id,type,remainingAmount),worth},INSRT_warehouseFillAmount(id,type){"use strict";$(`#warehouse-${type}-stock-current-${id}`).val(rHelper.data[type][id].warehouse.fillAmount)},INSRT_warehouseLevel(id,type){"use strict";let warehouseLevel=rHelper.data[type][id].warehouse.level;$(`#warehouse-${type}-level-${id}`).val(warehouseLevel),$(`#warehouse-${type}-stock-current-${id}`).attr("max",rHelper.methods.CALC_warehouseContingent(warehouseLevel))},INSRT_warehouseFillStatus(id,type){"use strict";let target=$(`#warehouse-${type}-fill-percent-${id}`),percent=(100*rHelper.data[type][id].warehouse.fillStatus).toFixed(2),color="rgb(255, 38, 41)";percent<75?color="rgb(70, 252, 6)":percent>=75&&percent<90?color="rgb(255, 252, 38)":percent>=90&&percent<95&&(color="rgb(255, 155, 38)"),target.text(percent).css("color",color)},INSRT_warehouseCapacity(id,type){"use strict";$(`#warehouse-${type}-stock-cap-${id}`).text(rHelper.data[type][id].warehouse.contingent.toLocaleString("en-US"))},INSRT_warehouseWorth(id,type){"use strict";let price,worth=rHelper.methods.CALC_warehouseWorth(id,type)*rHelper.data[type][id].warehouse.fillAmount;$(`#warehouse-${type}-worth-${id}`).text(worth.toLocaleString("en-US"))},INSRT_warehouseTotalWorth(){"use strict";let warehouseTotalWorth=rHelper.methods.CALC_warehouseTotalWorth();$("#warehouse-total-worth").text(warehouseTotalWorth.toLocaleString("en-US"))},INSRT_warehouseTotalLevel(){"use strict";let warehouseTotalLevel=rHelper.methods.CALC_warehouseTotalLevel();$("#warehouse-total-level").text(warehouseTotalLevel.toLocaleString("en-US"))},INSRT_warehouseRemainingTimeToFull(id,type){"use strict";let remainingTime=rHelper.methods.CALC_warehouseRemainingTimeToFull(id,type);$(`#warehouse-${type}-remaining-${id}`).text(remainingTime)},INSRT_warehouseUpgradeCost(id,type,value){"use strict";let target=$(`#warehouse-${type}-upgrade-cost-${id}`),upgradeCost=rHelper.methods.CALC_warehouseUpgradeCostOnInput(id,type,value);target.text(upgradeCost.toLocaleString("en-US"))},INSRT_buildingName(buildingId){"use strict";$(`#buildings-name-${buildingId}`).text(rHelper.data.buildings[buildingId].name)},INSRT_buildingData(buildingId){"use strict";let building=rHelper.data.buildings[buildingId],buildingLevel=building.level,dropdown=$(`#buildings-level-${buildingId}`);parseInt(dropdown.val())!=buildingLevel&&$(dropdown[0][buildingLevel]).attr("selected","true");let materialWorthSum=0,materialTransportationSum=0;if(10!=buildingLevel){rHelper.methods.SET_buildingTableVisibility(buildingId,"show");for(let i=0;i<=3;i+=1)if(0===i){let cashTarget=$(`#buildings-cash-${buildingId}`),cash=building.materialAmount0[buildingLevel];void 0===cash&&(cash=0),materialWorthSum+=cash,cashTarget.text(cash.toLocaleString("en-US"))}else{let selector=`materialAmount${i}`,material=rHelper.methods.CALC_convertId(building.material[i]);$(`#buildings-mat-${i}-${buildingId}`).addClass(material.icon);let materialAmount=building[selector][buildingLevel];if("number"==typeof materialAmount){$(`#buildings-amount-${i}-${buildingId}`).text(materialAmount.toLocaleString("en-US"));let materialPrice,materialWorth=rHelper.methods.CALC_returnPriceViaId(building.material[i])*materialAmount,transportation=(rHelper.data.buildings[9].transportCost-1)*materialWorth;materialWorthSum+=materialWorth,materialTransportationSum+=transportation,$(`#buildings-worth-${i}-${buildingId}`).text(materialWorth.toLocaleString("en-US")),$(`#buildings-transportation-${i}-${buildingId}`).text(transportation.toLocaleString("en-US"))}}}else rHelper.methods.SET_buildingTableVisibility(buildingId,"hide");$(`#buildings-sum-${buildingId}`).text(materialWorthSum.toLocaleString("en-US")),$(`#buildings-transportation-sum-${buildingId}`).text(Math.round(materialTransportationSum).toLocaleString("en-US"))},INSRT_buildingToLevel10(buildingId){"use strict";let buildingToLevel10=rHelper.methods.CALC_buildingToLevel10(buildingId);$(`#buildings-cap-${buildingId}`).text(buildingToLevel10.level10Cost.toLocaleString("en-US")),$(`#buildings-transportation-cap-${buildingId}`).text(buildingToLevel10.level10Transportation.toLocaleString("en-US"))},INSRT_techUpgradeRows(tu4Trigger){"use strict";let techUpgradeTbody=$("#techupgrades-combinations-tbl tbody");techUpgradeTbody[0].childNodes.length>0&&techUpgradeTbody.empty();let prices=[];for(let i=46;i<=49;i+=1)prices.push(rHelper.methods.CALC_returnPriceViaId(i,0));$.each(rHelper.tu,(index,combination)=>{if(void 0===tu4Trigger&&0!=combination.tu4)return;let tr=$(crEl("tr"));for(let i=0;i<=6;i+=1){let td=$(crEl("td"));td.addClass("text-md-right text-sm-left");let tus=[combination.tu1,combination.tu2,combination.tu3,combination.tu4];switch(i){case 0:case 1:case 2:case 3:td.text(tus[i]).attr("data-th",`Tech-Upgrade ${i}`);break;case 4:td.text(combination.factor).attr("data-th","Boost");break;case 5:let price=0;for(let k=0;k<tus.length;k+=1)price+=tus[k]*prices[k];td.text(price.toLocaleString("en-US")).attr("data-th","Price");break;case 6:let count=1*tus[0]+2*tus[1]+3*tus[2]+5*tus[3];td.text(count).attr("data-th","Pimp my mine count")}tr.append(td[0])}techUpgradeTbody.append(tr[0])})},INSRT_techUpgradeCalculator(value,tu4Inclusion){"use strict";toggleTechUpgradeInfo("start");let table=$("#techupgrades-calc-tbl");"none"==table.css("display")&&table.css("display","table");let target=$("#techupgrades-calc-tbl tbody");target.empty();let url=`api/getTechCombination.php?factor=${value}`;"string"==typeof tu4Inclusion&&(url+="&tu4=allowed"),$.getJSON(url,data=>{let prices=[];for(let i=46;i<=49;i+=1)prices.push(rHelper.methods.CALC_returnPriceViaId(i,0));$.each(data,(i,combination)=>{let tr=$(crEl("tr"));for(let k=0;k<=6;k+=1){let td=$(crEl("td"));td.addClass("text-md-right text-sm-left"),td.attr("data-th",`missing Tech-Upgrade ${k+1}`);let tus=[combination.tu1,combination.tu2,combination.tu3,combination.tu4];switch(k){case 0:case 1:case 2:case 3:td.text(tus[k]);break;case 4:td.text(combination.factor).attr("data-th","resulting Boost");break;case 5:let price=0;for(let l=0;l<tus.length;l+=1)price+=tus[l]*prices[l];td.text(price.toLocaleString("en-US")).attr("data-th","Price");break;case 6:let count=1*tus[0]+2*tus[1]+3*tus[2]+5*tus[3];td.text(count).attr("data-th","remaining Pimp my mine count")}tr.append(td)}target.append(tr)}),sorttable.makeSortable(table[0]),sorttable.innerSortFunction.apply($("#techupgrades-calc-tbl th")[5],[]),sorttable.innerSortFunction.apply($("#techupgrades-calc-tbl th")[5],[]),toggleTechUpgradeInfo("end")}).fail(()=>{let tr=$(crEl("tr")),td=$(crEl("td"));td.addClass("text-warning text-center").attr("data-th","Attention").attr("colspan",7).text("No entries found or invalid value. Try to lower the value a bit – up to 5 decimals are allowed (e.g. 3.00005)."),tr.append(td),target.append(tr),toggleTechUpgradeInfo("end")})},INSRT_recyclingRequirement(lootId){"use strict";$(`#recycling-requirement-${lootId}`).text(rHelper.methods.CALC_recyclingRequirement(lootId).toLocaleString("en-US"))},INSRT_recyclingProducts(lootId){"use strict";let recyclingPlantLevel=rHelper.data.buildings[5].level,recyclingProducts=rHelper.methods.CALC_recyclingProducts(lootId,recyclingPlantLevel);$(`#recycling-products-${lootId}`).html(recyclingProducts)},INSRT_recyclingOutputWorth(lootId){"use strict";let recyclingPlantLevel=rHelper.data.buildings[5].level;$(`#recycling-output-${lootId}`).text(rHelper.methods.CALC_recyclingOutputWorth(lootId,recyclingPlantLevel).toLocaleString("en-US"))},INSRT_recyclingInputWorth(lootId){"use strict";$(`#recycling-input-${lootId}`).text(rHelper.methods.CALC_recyclingInputWorth(lootId).toLocaleString("en-US"))},INSRT_unitsRecyclingProfit(type,id){"use strict";let target=$(`#${type}-profit-${id}`),profit=0,result,color;"recycling"==type?profit=rHelper.methods.CALC_recyclingProfit(id):"units"==type&&(profit=rHelper.methods.CALC_unitsProfit(id)),color=profit>0?"#9acd3225":"#ff7f5025",$(target[0].parentNode).css("background-color",color),result=profit.toFixed(2).toLocaleString("en-US")+"%",target.text(result)},INSRT_unitsCraftingPrice(unitId){"use strict";$(`#units-crafting-${unitId}`).text(rHelper.methods.CALC_unitsCraftingPrice(unitId).toLocaleString("en-US"))},INSRT_unitsPricePerStrength(unitId){"use strict";$(`#units-pps-${unitId}`).text(rHelper.methods.CALC_unitsPricePerStrength(unitId).toLocaleString("en-US"))},INSRT_unitsMarketPrice(unitId){"use strict";let convertedId=unitId+52,marketPrice=rHelper.methods.CALC_returnPriceViaId(convertedId);rHelper.data.units[unitId].profit.marketPrice=marketPrice,$(`#units-market-${unitId}`).text(marketPrice.toLocaleString("en-US"))},INSRT_companyWorth(){"use strict";let companyWorth=rHelper.methods.CALC_companyWorth();$("#company-worth").text(companyWorth.toLocaleString("en-US"))},INSRT_headquarterOvwTransportation(level){"use strict";let hqLevel=rHelper.data.headquarter[level];if($.isArray(hqLevel.material)){let hqCost=rHelper.methods.CALC_headquarterLevelCost(level),transportation=Math.round(hqCost*(rHelper.data.buildings[9].transportCost-1));$(`#hq-ovw-transportation-${level}`).text(transportation.toLocaleString("en-US"))}},INSRT_headquarterOvwCost(level){"use strict";let hqCost=rHelper.methods.CALC_headquarterLevelCost(level);$(`#hq-ovw-sum-${level}`).text(hqCost.toLocaleString("en-US"))},INSRT_headquarterOvwRadius(level){"use strict";let hqLevel=rHelper.data.headquarter[level];$(`#hq-ovw-radius-${level}`).text(`${hqLevel.radius} m | ${rHelper.methods.CALC_convertMeterToYards(hqLevel.radius)} yards`)},INSRT_headquarterOvwBoost(level){"use strict";let hqLevel=rHelper.data.headquarter[level];$(`#hq-ovw-boost-${level}`).text(hqLevel.boost)},INSRT_headquarterOvwString(level){"use strict";let hqLevel=rHelper.data.headquarter[level];if($.isArray(hqLevel.material)){let string=`${rHelper.methods.CALC_headquarterOvwMaterial(level)} x ${hqLevel.amount.toLocaleString("en-US")}`;$(`#hq-ovw-mat-${level}`).html(string)}},INSRT_headquarterContentRequiredAmount(level){"use strict";let hqContent=$("#hq-content");if(10!=level){hqContent.css("display","block");let headquarter=rHelper.data.headquarter[level],amount=headquarter.amount;$.each(headquarter.material,(i,material)=>{let icon=rHelper.methods.CALC_headquarterContentIcon(material),span=rHelper.methods.CALC_headquarterContentRequiredAmount(amount);$(`#hq-content-icon-${i}`).html(icon),$(`#hq-content-requirement-${i}`).html(span)})}else hqContent.css("display","none")},INSRT_headquarterPaid(){"use strict";let paid=rHelper.data.headquarter.user.paid;$.each(paid,(i,amount)=>{$(`#hq-content-paid-${i}`).val(amount)})},INSRT_headquarterMissing(i){"use strict";let userHqLevel=rHelper.data.headquarter.user.level;if(10!=userHqLevel){let requiredAmount,paid,missing=rHelper.data.headquarter[userHqLevel].amount-rHelper.data.headquarter.user.paid[i];missing<0&&(missing=0),$(`#hq-content-missing-${i}`).text(missing.toLocaleString("en-US"))}},INSRT_headquarterRemainingCost(userHqLevel){"use strict";if(10!=userHqLevel){let headquarter=rHelper.data.headquarter[userHqLevel],totalCost=0,totalTransportation=0;$.each(headquarter.material,(i,material)=>{let worth=rHelper.methods.CALC_headquarterRemainingCost(i,material,userHqLevel);totalCost+=worth;let transportation=Math.round(worth*(rHelper.data.buildings[9].transportCost-1));totalTransportation+=transportation,$(`#hq-content-cost-${i}`).text(worth.toLocaleString("en-US")),$(`#hq-content-transportation-${i}`).text(transportation.toLocaleString("en-US"))}),rHelper.methods.INSRT_headquarterTotalCost(totalCost),rHelper.methods.INSRT_headquarterTotalTransportation(totalTransportation)}},INSRT_headquarterTotalCost(sum){"use strict";$("#hq-content-cost-sum").text(sum.toLocaleString("en-US"))},INSRT_headquarterTotalTransportation(sum){"use strict";$("#hq-content-transportation-sum").text(sum.toLocaleString("en-US"))},INSRT_priceHistoryName(type,id){"use strict";$(`#pricehistory-${type}-${id}`).text(rHelper.data[type][id].name)},INSRT_qualityComparator(type,quality){"use strict";type&&null!=type||(type=0),quality?quality/=100:quality=1;let price,worth=rHelper.methods.CALC_returnPriceViaId(type)*rHelper.data.material[type].maxRate*quality;$("#qualitycomparator-income").text(worth.toLocaleString("en-US")),$.each(rHelper.data.material,(i,material)=>{let qualityTarget=$(`#qualitycomparator-${i}`),parentElement=$(qualityTarget[0].parentNode.parentNode),thisPrice=rHelper.methods.CALC_returnPriceViaId(i),thisMaxRate=material.maxRate,thisResourcesRequiredAmount=worth/thisPrice;if(i==type||thisResourcesRequiredAmount>thisMaxRate)parentElement.css("opacity",.1);else{parentElement.css("opacity",1);let percent=(thisResourcesRequiredAmount/thisMaxRate*100).toFixed(2);qualityTarget.text(`${percent} %`)}})},INSRT_missions(){"use strict";let missionContainer=rHelper.data.missions;if(0!=missionContainer.length){let now=Math.round(Date.now()/1e3),calculateMissionCost=(i,mission)=>{let uncalculatableMissions,requirementId=0,materialCost=0,missionCost=0;if(-1==[9,12,17,21,22,25,30,31,32,35,37,38,41,42,43,44,50,55].indexOf(i))switch(i){case 10:missionCost+=rHelper.data.units[5].profit.craftingPrice*mission.goal;break;case 11:case 26:case 28:case 31:case 39:26==i?requirementId=29:28==i?requirementId=21:31==i?requirementId=20:39==i&&(requirementId=25),missionCost+=(materialCost=rHelper.methods.CALC_returnPriceViaId(requirementId)*mission.goal)*rHelper.data.buildings[9].transportCost-materialCost;break;case 14:missionCost+=rHelper.methods.CALC_currentScanCost()*mission.goal;break;case 33:let calcSmallestUnitPrice;missionCost+=(()=>{let min=1/0;return $.each(rHelper.data.units,(i,unit)=>{if(1==i||4==i||5==i){let craftingPrice=unit.profit.craftingPrice,marketPrice=unit.profit.marketPrice*rHelper.data.buildings[9].transportCost,result=0;(result=marketPrice>craftingPrice?craftingPrice:marketPrice)<min&&(min=result)}}),min})()*mission.goal;break;case 45:missionCost+=mission.goal/5*100}return missionCost},calculateMissionReward=(i,mission)=>{let rewardId=mission.rewardId,rewardWorth=0;if(-1!=rewardId){$(`#mission-reward-${i}`).addClass(rHelper.methods.CALC_convertId(rewardId).icon);let price=rHelper.methods.CALC_returnPriceViaId(rewardId);rewardWorth+=mission.rewardAmount*price}else $(`#mission-reward-${i}`).html('<img src="assets/img/cash.png" alt="Cash" />'),rewardWorth+=mission.rewardAmount;return rewardWorth},returnWorthColor=missionWorth=>{let color="coral";return missionWorth>0&&(color="yellowgreen"),color},insertMissionReward=(i,mission)=>{let parsedI=parseInt(i),rewardWorth,missionCost,missionWorth=calculateMissionReward(i,mission)-calculateMissionCost(parsedI,mission),color=returnWorthColor(missionWorth);50!=parsedI&&55!=parsedI&&31!=parsedI&&$(`#mission-profit-${i}`).text(missionWorth.toLocaleString("en-US")).css("color",color)},colorProgress=progressPercent=>{let color="coral";return progressPercent>33&&progressPercent<66?color="orange":progressPercent>=66&&(color="yellowgreen"),color},returnMissionProgress=(progress,goal)=>progress/goal*100,calculateRemainingDuration=(now,finish)=>{let remainingDuration=finish-now;return remainingDuration<60?remainingDuration+"s":remainingDuration>=60&&remainingDuration<3600?(remainingDuration/60).toFixed(2)+"m":remainingDuration>=3600&&remainingDuration<86400?(remainingDuration/3600).toFixed(2)+"h":(remainingDuration/86400).toFixed(2)+"d"},fadeOutMission=(i,mission)=>{let cooldown=calculateRemainingDuration(now,mission.cooldown);$(`#mission-progress-${i}`).attr("colspan",3).html('Mission on cooldown for <span style="color: orange;">'+cooldown+"</span>").css("text-align","center"),$(`#mission-start-${i}`).remove(),$(`#mission-end-${i}`).remove(),$(`#mission-${i}`).addClass("faded-mission")},highlightAvailableMission=i=>{$(`#mission-${i}`).addClass("yellowgreen-10")},insertMissionConstants=(i,mission)=>{$(`#mission-duration-${i}`).text(mission.duration/24),$(`#mission-goal-${i}`).text(mission.goal.toLocaleString("en-US")),$(`#mission-interval-${i}`).text(mission.intervalDays),$(`#mission-penalty-${i}`).text(mission.penalty.toLocaleString("en-US")),$(`#mission-reward-amount-${i}`).text(mission.rewardAmount.toLocaleString("en-US"))},onActiveMission=(i,mission)=>{let progressPercent=returnMissionProgress(mission.progress,mission.goal);$(`#mission-progress-bar-${i}`).css({width:progressPercent+"%","background-color":colorProgress(progressPercent)}),$(`#mission-start-${i}`).text(rHelper.methods.CALC_convertDateToIso(rHelper.methods.CALC_toMilliseconds(mission.startTimestamp))),$(`#mission-end-${i}`).text(calculateRemainingDuration(now,mission.endTimestamp))},onPassiveMission=i=>{$(`#mission-progress-wrap-${i}`).css("display","none")},checkForMissionStatus=(i,mission)=>{1==mission.status?onActiveMission(i,mission):onPassiveMission(i,mission)};$.each(missionContainer,(i,mission)=>{insertMissionReward(i,mission),insertMissionConstants(i,mission),mission.cooldown>now?fadeOutMission(i,mission):highlightAvailableMission(i),checkForMissionStatus(i,mission)})}},CALC_attackLogDetailedUnitStringInsertion(type,container){let content="",unitArray;return"offense"==type?unitArray=[0,2,3]:"defense"==type&&(unitArray=[5,4,1]),$.each(container,(i,unitAmount)=>{0!=unitAmount&&(content+=' <span class="resources-unit-'+unitArray[i]+'"></span> '+unitAmount.toLocaleString("en-US"))}),content},CALC_attackLogDetailedDatasetIteration(i,dataset,dataTHs){let tr=$(crEl("tr")).addClass(rHelper.methods.CALC_attackLogSetTRColor(dataset.result)),textOrientation="text-md-right text-sm-left",factorBgColorClass="bg-success-25";for(let index=0;index<=7;index+=1){let td=$(crEl("td")).attr("data-th",dataTHs[index]);switch(index){case 0:td.text(`${dataset.target} (${dataset.targetLevel})`);break;case 1:td.html(rHelper.methods.CALC_attackLogDetailedCoordsTimestampString(dataset));break;case 2:td.html(rHelper.methods.CALC_attackLogDetailedUnitStringInsertion("offense",dataset.offense.units)).addClass("text-sm-left text-md-center");break;case 3:td.html(rHelper.methods.CALC_attackLogDetailedUnitStringInsertion("defense",dataset.defense.units)).addClass("text-sm-left text-md-center");break;case 4:dataset.factor<100&&(factorBgColorClass="bg-warning-25"),td.text(dataset.factor.toLocaleString("en-US")+"%").addClass(`${textOrientation} ${factorBgColorClass}`);break;case 5:td.html(rHelper.methods.CALC_attackLogDetailedLootString(dataset.loot));break;case 6:let profit=dataset.profit,result=dataset.result,profitColor="#dedede";(profit<0&&result||!result)&&(profitColor="coral"),td.text(profit.toLocaleString("en-US")).addClass(textOrientation).css("color",profitColor)}tr.append(td)}return tr},CALC_attackLogSetTRColor(result){let colorClass="bg-success-25";return(!result||result<0)&&(colorClass="bg-warning-25"),colorClass},CALC_attackLogDetailedCoordsTimestampString(dataset){let coords=`${dataset.coordinates.lat}, ${dataset.coordinates.lon}`,timestamp,a;return`${rHelper.methods.CALC_convertDateToIso(dataset.attackedAt)} | ${`<a href="https://www.google.com/maps/search/${coords}" target="_blank" rel="noopener nofollow noreferrer">${coords}</a>`}`},CALC_attackLogDetailedPageButtonToggler(type,dataContainer){let button=$(`#attacklog-detailed-${type}`),success="btn-success";"last"==type?0==dataContainer.skipCount?button.attr("disabled",!0).removeClass(success):button.attr("disabled",!1).addClass(success):"next"==type&&(dataContainer.maxLength>dataContainer.skipCount+100?button.addClass(success).attr("disabled",!1):button.removeClass(success).attr("disabled",!0))},CALC_attackLogDetailedLootString(lootContainer){let lootString="";return $.each(lootContainer,(index,iteration)=>{let type=iteration.type,icon="";icon=-1==type?'<img src="assets/img/cash.png" alt="Cash" />':'<span class="'+rHelper.methods.CALC_convertId(type).icon+'"></span>',lootString+=`${icon} ${iteration.amount.toLocaleString("en-US")} `}),lootString},CALC_convertDateToIso(milliseconds){let tzoffset=6e4*new Date(milliseconds).getTimezoneOffset(),date=new Date(milliseconds-tzoffset).toISOString().slice(0,-1).match(/(\d{4}\-\d{2}\-\d{2})T(\d{2}:\d{2}:\d{2})/);return`${date[1]} ${date[2]}`},CALC_currentScanCost(){let techCenterLevel=rHelper.data.buildings[0].level,mineCount=rHelper.methods.CALC_totalMineCount();return 5e3*Math.round(1e4*Math.pow(2.4,techCenterLevel)*(1+mineCount/1e3)/5e3)},CALC_toMilliseconds:unix=>1e3*unix,CALC_mineEstRevenue(subObj,type,age){"use strict";return Math.round(subObj.fullRate*rHelper.methods.CALC_returnPriceViaId(type,8)*age*24*subObj.HQBoost)},CALC_createMapContentString(relObj,buildDate,age,estRevenue,subObj){"use strict";let quality=100*subObj.quality;return`<div>\n        <h1 class="firstHeading">${relObj.name}</h1>\n        <div>\n        <p><strong>Built:</strong> ${buildDate}</p>\n        <p><strong>Age (days)</strong>: ${age.toFixed(2)}</p>\n        <p><strong>Estimated revenue (condition always 100%):</strong> ${estRevenue.toLocaleString("en-US")}</p>\n        <table class="table table-break-medium mb-3 text-center">\n        <thead>\n        <tr>\n          <th>Raw rate</th>\n          <th>Full rate</th>\n          <th>Tech factor</th>\n          <th>Quality</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr>\n          <td>${subObj.rawRate.toLocaleString("en-US")}</td>\n          <td>${subObj.fullRate.toLocaleString("en-US")}</td>\n          <td>${subObj.techFactor.toLocaleString("en-US")}</td>\n          <td>${quality.toFixed(2)}% => ${(quality*subObj.techFactor).toFixed(2)} %</td>\n        </tr>\n        </tbody>\n        </table>\n        </div>\n        </div>`},CALC_headquarterRemainingCost(i,material,userHqLevel){"use strict";let price=rHelper.methods.CALC_returnPriceViaId(material),missing=rHelper.data.headquarter[userHqLevel].amount-rHelper.data.headquarter.user.paid[i];return missing<0&&(missing=0),price*missing},CALC_headquarterContentIcon(material){"use strict";let container=$(crEl("span"));return container.addClass(rHelper.methods.CALC_convertId(material).icon),container[0].outerHTML},CALC_headquarterContentRequiredAmount(amount){"use strict";let span;return $(crEl("span")).html(amount.toLocaleString("en-US"))[0].outerHTML},CALC_convertMeterToYards(meter){"use strict";return Math.round(1.09361*meter)},CALC_headquarterLevelCost(level){"use strict";let cost=0,hqLevel=rHelper.data.headquarter[level];return $.isArray(hqLevel.material)&&$.each(hqLevel.material,(k,material)=>{cost+=hqLevel.amount*rHelper.methods.CALC_returnPriceViaId(material)}),cost},CALC_headquarterOvwMaterial(level){"use strict";let hqLevel=rHelper.data.headquarter[level],string="";return $.isArray(hqLevel.material)&&$.each(hqLevel.material,(k,material)=>{let addClass;material<=13?addClass=rHelper.data.material[material].icon:material>=14&&material<=35?(material-=14,addClass=rHelper.data.products[material].icon):material>=36&&material<=51?(material-=36,addClass=rHelper.data.loot[material].icon):(material-=52,addClass=rHelper.data.units[material].icon);let span=$(crEl("span")).addClass(addClass);string+=span[0].outerHTML+" "}),string},CALC_totalBuildingErectionSum(){"use strict";let total=0;return $.each(rHelper.data.buildings,(i,building)=>{for(let level=0;level<building.level;level+=1)$.each(building.material,(k,material)=>{let materialAmount=`materialAmount${k}`;total+=-1!=material?rHelper.methods.CALC_returnPriceViaId(material)*building[materialAmount][level]:building[materialAmount][level]})}),total},CALC_perfectWorth(type){"use strict";let total=0;return"headquarter"==type?$.each(rHelper.data.headquarter,(i,hqLevel)=>{$.each(hqLevel.material,(k,material)=>{total+=hqLevel.amount*rHelper.methods.CALC_returnPriceViaId(material)})}):"buildings"==type&&$.each(rHelper.data.buildings,(i,building)=>{for(let level=0;level<10;level+=1)$.each(building.material,(k,material)=>{let materialAmount=`materialAmount${k}`;total+=-1!=material?rHelper.methods.CALC_returnPriceViaId(material)*building[materialAmount][level]:building[materialAmount][level]})}),total},CALC_companyWorth(){"use strict";let companyWorth=0,fns=["CALC_totalHeadquarterErectionSum","CALC_totalBuildingErectionSum","CALC_totalFactoryErectionWorth","CALC_totalWarehouseErectionWorth","CALC_totalMineErectionSum"];return $.each(fns,(i,fn)=>{companyWorth+=rHelper.methods[fn]()}),companyWorth},CALC_totalHeadquarterErectionSum(){"use strict";let total=0,headquarter=rHelper.data.headquarter;if(headquarter.user){let userHq=headquarter.user,userHqLevel=userHq.level;for(let i=userHqLevel-1;i>=1;i-=1){let hqLevel=rHelper.data.headquarter[i];$.each(hqLevel.material,(k,material)=>{total+=hqLevel.amount*rHelper.methods.CALC_returnPriceViaId(material)})}10!=userHqLevel&&$.each(userHq.paid,(i,paid)=>{if(0!=paid){let material=rHelper.data.headquarter[userHqLevel-1].material[i];total+=paid*rHelper.methods.CALC_returnPriceViaId(material)}})}return total},CALC_totalMineErectionSum(){"use strict";let total=0,totalMines=rHelper.methods.CALC_totalMineCount();return $.each(rHelper.data.material,(i,material)=>{total+=material.basePrice*(1+.01*totalMines)*material.amountOfMines}),Math.round(total)},CALC_totalWarehouseErectionWorth(){"use strict";let total=0,subArrays=["material","products","loot","units"];return $.each(subArrays,(i,index)=>{$.each(rHelper.data[index],(k,obj)=>{for(let k=1;k<=obj.warehouse.level;k+=1)total+=125e4*Math.pow(k-1,2)})}),total},CALC_totalFactoryErectionWorth(){"use strict";let total=0;return $.each(rHelper.data.products,(i,factory)=>{for(let level=0;level<=factory.factoryLevel;level+=1)$.each(factory.upgradeMaterial,(k,material)=>{let value=Math.pow(level,2)*factory.upgradeMaterialAmount[k];total+=-1!=material?value*rHelper.methods.CALC_returnPriceViaId(material):value})}),total},CALC_unitsCraftingPrice(unitId){"use strict";let unit=rHelper.data.units[unitId],worth=unit.prices.current.ai,requiredAmount=unit.requiredAmount,requirements=unit.requirements;$.each(requirements,(index,requirement)=>{let price=rHelper.methods.CALC_returnPriceViaId(requirement);worth+=price*requiredAmount[index]});let settings,transportCostInclusion=1;return void 0!==typeof rHelper.data.settings[3]&&(transportCostInclusion=rHelper.data.settings[3].value),1==transportCostInclusion&&(worth*=rHelper.data.buildings[9].transportCost),worth=Math.round(worth),unit.profit.craftingPrice=worth,worth},CALC_unitsPricePerStrength(unitId){"use strict";let buildingLevel=0,strength=0,pricePerStrength=0,referencePrice=0,profitObj=rHelper.data.units[unitId].profit;switch(unitId){case 0:case 2:case 3:buildingLevel=rHelper.data.buildings[3].level;break;case 1:case 4:case 5:buildingLevel=rHelper.data.buildings[4].level}strength=rHelper.data.units[unitId].baseStrength*buildingLevel;let marketPriceIncludingTransportation=profitObj.marketPrice*rHelper.data.buildings[9].transportCost;return referencePrice=marketPriceIncludingTransportation>=profitObj.craftingPrice?profitObj.craftingPrice:marketPriceIncludingTransportation,pricePerStrength=Math.round(referencePrice/strength)},CALC_unitsProfit(unitId){"use strict";let profitObj=rHelper.data.units[unitId].profit,profit=100*(1-profitObj.marketPrice/profitObj.craftingPrice);return profit*=-1,profitObj.profit=profit,profit},CALC_recyclingProfit(lootId){"use strict";let profitObj=rHelper.data.loot[lootId].profit,profit=100*(1-profitObj.outputWorth/profitObj.inputWorth);return profit*=-1},CALC_recyclingInputWorth(lootId){"use strict";let loot=rHelper.data.loot[lootId],amount=loot.recyclingDivisor,convertedId=lootId+36,price,worth=rHelper.methods.CALC_returnPriceViaId(convertedId,0)*amount,settings,transportCostInclusion=1;return void 0!==typeof rHelper.data.settings[3]&&(transportCostInclusion=rHelper.data.settings[3].value),1==transportCostInclusion&&(worth*=rHelper.data.buildings[9].transportCost),worth=Math.round(worth),loot.profit.inputWorth=worth,worth},CALC_recyclingOutputWorth(lootId,recyclingPlantLevel){"use strict";let resultingAmount=rHelper.data.loot[lootId].recyclingAmount,resultingProducts=rHelper.data.loot[lootId].recyclingProduct,worth=0;return $.isArray(resultingProducts)?$.each(resultingProducts,(index,resultingProduct)=>{worth+=rHelper.methods.CALC_recyclingOutputWorthHelper(recyclingPlantLevel,resultingProduct,resultingAmount,index)}):worth+=rHelper.methods.CALC_recyclingOutputWorthHelper(recyclingPlantLevel,resultingProducts,resultingAmount),worth=Math.round(worth),rHelper.data.loot[lootId].profit.outputWorth=worth,worth},CALC_recyclingOutputWorthHelper(recyclingPlantLevel,resultingProduct,resultingAmount,index){"use strict";let price=rHelper.methods.CALC_returnPriceViaId(resultingProduct,0),amount=resultingAmount*recyclingPlantLevel,worth;return $.isArray(resultingAmount)&&(amount=resultingAmount[index]*recyclingPlantLevel),amount*price},CALC_recyclingRequirement(lootId){"use strict";return rHelper.data.loot[lootId].recyclingDivisor},CALC_recyclingProducts(lootId,recyclingPlantLevel){"use strict";let resultingAmount=rHelper.data.loot[lootId].recyclingAmount,resultingProducts=rHelper.data.loot[lootId].recyclingProduct,string="";return $.isArray(resultingProducts)?$.each(resultingProducts,(index,resultingProduct)=>{string+=rHelper.methods.CALC_recyclingProductsHelper(recyclingPlantLevel,resultingProduct,resultingAmount,index)}):string+=rHelper.methods.CALC_recyclingProductsHelper(recyclingPlantLevel,resultingProducts,resultingAmount),string},CALC_recyclingProductsHelper(recyclingPlantLevel,resultingProduct,resultingAmount,index){"use strict";let product=rHelper.methods.CALC_convertId(resultingProduct),icon=$(crEl("span")).addClass(product.icon),amount=resultingAmount*recyclingPlantLevel,string;return $.isArray(resultingAmount)&&(amount=resultingAmount[index]*recyclingPlantLevel),`${icon[0].outerHTML} ${amount.toLocaleString("en-US")} `},CALC_buildingToLevel10(buildingId){"use strict";let building=rHelper.data.buildings[buildingId],buildingLevel,level10Cost=0,level10Transportation=0;for(let level=building.level;level<10;level+=1)for(let i=0;i<=3;i+=1)if(0===i){let cash;level10Cost+=building.materialAmount0[level]}else{let selector,materialAmount=building[`materialAmount${i}`][level];if("number"==typeof materialAmount){let materialPrice,materialWorth=rHelper.methods.CALC_returnPriceViaId(building.material[i])*materialAmount,transportation;level10Cost+=materialWorth,level10Transportation+=(rHelper.data.buildings[9].transportCost-1)*materialWorth}}return{level10Cost:level10Cost,level10Transportation:Math.round(level10Transportation)}},CALC_warehouseUpgradeCost(targetLevel){"use strict";return 125e4*Math.pow(targetLevel-1,2)},CALC_warehouseCostFromTo(start,end){"use strict";let warehouseCost=0;for(let i=end;i>start;i-=1)warehouseCost+=rHelper.methods.CALC_warehouseUpgradeCost(i);return warehouseCost},CALC_warehouseContingent(level){"use strict";return 5e3*Math.pow(level,2)},CALC_warehouseUpgradeCostContigentBased(startLevel,endContingent){"use strict";let warehouseCost=0,nextBiggerTargetLevel=Math.ceil(Math.sqrt(endContingent/5e3));return warehouseCost+=rHelper.methods.CALC_warehouseCostFromTo(startLevel,nextBiggerTargetLevel)},CALC_warehouseUpgradeCostOnInput(id,type,value){"use strict";let mode=$(`#warehouse-${type}-calc-1-${id}`).val(),currentWarehouseLevel=rHelper.data[type][id].warehouse.level,upgradeCost=0;switch(mode){case"level":upgradeCost=rHelper.methods.CALC_warehouseCostFromTo(currentWarehouseLevel,value);break;case"contingent":upgradeCost=rHelper.methods.CALC_warehouseUpgradeCostContigentBased(currentWarehouseLevel,value)}return upgradeCost},CALC_warehouseWorth(id,type){"use strict";let price=0,priceId=0;switch(type){case"material":priceId=id;break;case"products":priceId=id+14;break;case"loot":priceId=id+36;break;case"units":priceId=id+51}return price=rHelper.methods.CALC_returnPriceViaId(priceId)},CALC_warehouseRemainingTimeToFull(id,type){"use strict";let el=rHelper.data[type][id],remainingCapacity=el.warehouse.contingent-el.warehouse.fillAmount,remainingTime=0,divisor=1;return"material"==type?divisor=el.perHour:"products"==type&&(divisor=el.scaling*el.factoryLevel*rHelper.methods.CALC_factoryMinWorkload(id)),remainingTime=remainingCapacity/divisor,remainingTime=isNaN(remainingTime)||"products"==type&&el.turnover<=0||"loot"==type||"units"==type?"∞":remainingTime>24?`> ${(remainingTime/24).toFixed(2)} days`:`> ${remainingTime.toFixed(2)} hours`},CALC_warehouseTotalLevel(){"use strict";let total=0,arr=["material","products","loot","units"];return $.each(arr,(index,pointer)=>{$.each(rHelper.data[pointer],(index,el)=>{total+=el.warehouse.level})}),total},CALC_warehouseTotalWorth(){"use strict";let total=0,arr=["material","products","loot","units"];return $.each(arr,(index,pointer)=>{$.each(rHelper.data[pointer],(index,el)=>{total+=rHelper.methods.CALC_warehouseWorth(index,pointer)*el.warehouse.fillAmount})}),total},CALC_flowDistributionHelper(type,dependantFactory,id,i){"use strict";let originalIndex=0,dependantIconIndex=0,requiredAmountPerLevel=0,dependantObj={},requiredAmount=0,string="",arrow='<svg xmlns="http://www.w3.org/2000/svg" width="15" fill="#fff" viewBox="0 0 31.49 31.49"><path d="M21.205 5.007c-.429-.444-1.143-.444-1.587 0-.429.429-.429 1.143 0 1.571l8.047 8.047H1.111C.492 14.626 0 15.118 0 15.737c0 .619.492 1.127 1.111 1.127h26.554l-8.047 8.032c-.429.444-.429 1.159 0 1.587.444.444 1.159.444 1.587 0l9.952-9.952c.444-.429.444-1.143 0-1.571l-9.952-9.953z"/></svg>';"material"==type?(dependantIconIndex=dependantFactory-14,dependantObj=rHelper.data.products[dependantIconIndex],$.isArray(dependantObj.dependencies)?(originalIndex=dependantObj.dependencies.indexOf(id),requiredAmountPerLevel=dependantObj.requiredAmount[originalIndex]):(originalIndex=dependantObj.dependencies,requiredAmountPerLevel=dependantObj.requiredAmount)):(dependantIconIndex=dependantFactory,dependantObj=rHelper.data.products[dependantFactory],$.isArray(dependantObj.dependencies)?(originalIndex=dependantObj.dependencies.indexOf(id+14),requiredAmountPerLevel=dependantObj.requiredAmount[originalIndex]):(originalIndex=dependantObj.dependencies,requiredAmountPerLevel=dependantObj.requiredAmount)),dependantObj.turnover>0&&(requiredAmount=dependantObj.factoryLevel*requiredAmountPerLevel),string+=`<span class="resources-${type}-${id}"></span> ${requiredAmount.toLocaleString("en-US")} ${arrow} <span class="resources-product-${dependantIconIndex}"></span>`;let name1="",name2=dependantObj.name;switch(type){case"material":name1=rHelper.data.material[id].name;break;case"product":name1=rHelper.data.products[id].name}return $(`#flow-${type}-distribution-${id}-${i}`).html(string).attr("data-th",`${name1} to ${name2}`),requiredAmount},CALC_flowDistribution(id,type){"use strict";let perHour=0,obj={},requiredAmount=0;switch(type){case"material":perHour=(obj=rHelper.data.material[id]).perHour;break;case"product":let factoryLevel,scaling,workload;perHour=(obj=rHelper.data.products[id]).factoryLevel*obj.scaling*rHelper.methods.CALC_factoryMinWorkload(id)}let dependantFactories=obj.dependantFactories;return $.isArray(dependantFactories)?$.each(dependantFactories,(i,dependantFactory)=>{requiredAmount+=rHelper.methods.CALC_flowDistributionHelper(type,dependantFactory,id,i)}):""!=dependantFactories&&(requiredAmount+=rHelper.methods.CALC_flowDistributionHelper(type,dependantFactories,id,0)),perHour-requiredAmount},CALC_flowRate(id,type){"use strict";let rate=0;switch(type){case"material":rate=rHelper.data.material[id].perHour;break;case"product":let factory=rHelper.data.products[id],workload=rHelper.methods.CALC_factoryMinWorkload(id);rate=factory.factoryLevel*factory.scaling*workload}return rate},CALC_factoryMinWorkload(factoryId){"use strict";let workload=rHelper.data.products[factoryId].dependencyWorkload.min();return workload>1&&(workload=1),workload},CALC_diamondTotalProfit(){"use strict";let val=0;return $.each(rHelper.data.products,(i,factory)=>{let diamondProfit=factory.diamond.profit;diamondProfit>0&&(val+=diamondProfit)}),val},CALC_diamondTop10Profit(){"use strict";let arr=[];$.each(rHelper.data.products,(i,factory)=>{let diamondProfit=factory.diamond.profit;diamondProfit>0&&arr.push(diamondProfit)});let sum=0;arr=arr.sort((a,b)=>b-a);for(let i=0;i<=9;i+=1)arr[i]&&(sum+=arr[i]);return sum},CALC_diamondEfficiency(factoryId){"use strict";let factoryDiamond=rHelper.data.products[factoryId].diamond,efficiency=factoryDiamond.outputWorth/(factoryDiamond.dependenciesWorth+factoryDiamond.productionCost);return isNaN(efficiency)&&(efficiency=0),factoryDiamond.efficiency=efficiency,efficiency},CALC_diamondProfit(factoryId){"use strict";let factoryDiamond=rHelper.data.products[factoryId].diamond;return factoryDiamond.profit=factoryDiamond.outputWorth-(factoryDiamond.dependenciesWorth+factoryDiamond.productionCost),factoryDiamond.profit},CALC_nextGreaterWarehouseLevel(amount){"use strict";return Math.ceil(Math.sqrt(amount/5e3))},CALC_diamondFactoryOutput(factoryId){"use strict";let factory=rHelper.data.products[factoryId],outputAmount=factory.factoryLevel*factory.scaling*5*24,productionCost=120*factory.cashPerHour;return 0==factory.factoryLevel&&(productionCost=0),rHelper.data.products[factoryId].diamond={outputWorth:outputAmount*rHelper.methods.CALC_returnPriceViaId(factoryId+14),dependenciesWorth:0,productionCost:productionCost,efficiency:0,profit:0},factory.factoryLevel*factory.scaling*5*24},CALC_dependantFactoriesHelper(dependantFactory,type){"use strict";"material"==type&&(dependantFactory-=14);let fns=["INSRT_factoryDependencies","INSRT_factoryWorkload","INSRT_factoryTurnover","INSRT_factoryTurnoverPerUpgrade","INSRT_factoryROI"];$.each(fns,(i,fn)=>{rHelper.methods[fn](dependantFactory)}),rHelper.methods.INSRT_factoryHighlightColumns(),""!=rHelper.data.products[dependantFactory].dependantFactories&&rHelper.methods.CALC_dependantFactories(dependantFactory,"product")},CALC_dependantFactories(id,type){"use strict";let dependantFactories="";switch(type){case"material":dependantFactories=rHelper.data.material[id].dependantFactories;break;case"product":dependantFactories=rHelper.data.products[id].dependantFactories}$.isArray(dependantFactories)?$.each(dependantFactories,(k,dependantFactory)=>{rHelper.methods.CALC_dependantFactoriesHelper(dependantFactory,type)}):""!=dependantFactories&&rHelper.methods.CALC_dependantFactoriesHelper(dependantFactories,type)},CALC_factoryTurnoverPerUpgrade(factoryId){"use strict";let value=0,nextLevelWorkloadArray=[],dependencies=rHelper.data.products[factoryId].dependencies;if($.isArray(dependencies))$.each(dependencies,dependencyIndex=>{let dependencyWorkload=rHelper.methods.CALC_factoryDepedencyWorkload(factoryId,dependencyIndex,"nextLevel");nextLevelWorkloadArray.push(dependencyWorkload)});else{let dependencyWorkload=rHelper.methods.CALC_factoryDepedencyWorkload(factoryId,0,"nextLevel");nextLevelWorkloadArray.push(dependencyWorkload)}let nextLevelWorkload=nextLevelWorkloadArray.min();return nextLevelWorkload>1&&(nextLevelWorkload=1),(value=parseInt(rHelper.methods.CALC_factoryTurnover(factoryId,"nextLevel",nextLevelWorkload)-rHelper.data.products[factoryId].turnover))<10&&value>-10&&(value=0),value},CALC_factoryDependencyExistingAmount(dependantObj,dependencyIndex){"use strict";return dependantObj.perHour?dependantObj.perHour:dependantObj.factoryLevel*dependantObj.scaling},CALC_factoryWorkloadMinNonSanitized(factoryId){"use strict";return rHelper.data.products[factoryId].dependencyWorkload.min()},CALC_factoryCashCostPerHour(factoryId,nextLevel){"use strict";let factory=rHelper.data.products[factoryId],factoryLevel=factory.factoryLevel;return nextLevel&&(factoryLevel+=1),factory.cashPerHour*factoryLevel},CALC_factoryTurnover(factoryId,nextLevel,nextLevelWorkload){"use strict";let factory=rHelper.data.products[factoryId],price=rHelper.methods.CALC_returnPriceViaId(factoryId+14),factoryLevel=factory.factoryLevel,cashCost=rHelper.methods.CALC_factoryCashCostPerHour(factoryId,nextLevel),workload=rHelper.methods.CALC_factoryMinWorkload(factoryId),materialWorth=0;nextLevel&&(factoryLevel+=1,workload=nextLevelWorkload);let outputWorth=factory.scaling*factoryLevel*price,remainingValue;if($.isArray(factory.dependencies))$.each(factory.dependencies,index=>{let dependencyWorth=rHelper.methods.CALC_factoryDependencyWorth(factoryId,index,nextLevel);materialWorth+=dependencyWorth});else{let dependencyWorth=rHelper.methods.CALC_factoryDependencyWorth(factoryId,0,nextLevel);materialWorth+=dependencyWorth}return(outputWorth-materialWorth-cashCost)*workload},CALC_factoryDependencyWorth(factoryId,dependencyIndex,nextLevel){"use strict";let factory=rHelper.data.products[factoryId],factoryLevel=factory.factoryLevel,requiredAmount=0,dependencyPrice=0;return nextLevel&&(factoryLevel+=1),$.isArray(factory.dependencies)?(requiredAmount=factory.requiredAmount[dependencyIndex],dependencyPrice=rHelper.methods.CALC_returnPriceViaId(factory.dependencies[dependencyIndex])):(requiredAmount=factory.requiredAmount,dependencyPrice=rHelper.methods.CALC_returnPriceViaId(factory.dependencies)),factoryLevel*requiredAmount*dependencyPrice},CALC_factoryDepedencyWorkload(factoryId,dependencyIndex,nextLevel){"use strict";let workload=0,factory=rHelper.data.products[factoryId],factoryLevel=factory.factoryLevel,thisDependency,baseAmountRequirement,existingAmount=0;nextLevel&&(factoryLevel+=1),$.isArray(factory.dependencies)?(thisDependency=factory.dependencies[dependencyIndex],baseAmountRequirement=factory.requiredAmount[dependencyIndex]):(thisDependency=factory.dependencies,baseAmountRequirement=factory.requiredAmount);let requiredAmount=baseAmountRequirement*factoryLevel;if(thisDependency<=13)existingAmount=rHelper.data.material[thisDependency].perHour;else{let actualFactory=rHelper.methods.CALC_convertId(thisDependency),minDependencyWorkload=actualFactory.dependencyWorkload.min();minDependencyWorkload>1&&(minDependencyWorkload=1),existingAmount=actualFactory.factoryLevel*actualFactory.scaling*minDependencyWorkload}return workload=existingAmount/requiredAmount,(isNaN(workload)||workload===1/0)&&(workload=0),workload},CALC_factoryROI(factoryId){"use strict";return rHelper.data.products[factoryId].upgradeCost/rHelper.data.products[factoryId].turnoverIncrease/24},CALC_factoryComparatorRequiredVsExistingAmount(requiredAmount,existingAmount){"use strict";let addClass;return isNaN(existingAmount)&&(existingAmount=0),addClass=existingAmount<requiredAmount?'class="faulty-dependency"':""},CALC_factoryDependencyRequiredAmount(factoryId,dependencyIndex){"use strict";let factory=rHelper.data.products[factoryId],requiredAmount=0;return(requiredAmount=$.isArray(factory.requiredAmount)?factory.requiredAmount[dependencyIndex]:factory.requiredAmount)*factory.factoryLevel},CALC_totalFactoryUpgrades(){"use strict";let totalFactoryUpgrades=0;return $.each(rHelper.data.products,(i,factory)=>{totalFactoryUpgrades+=factory.factoryLevel}),totalFactoryUpgrades},CALC_factoryUpgradeCost(factoryId){"use strict";let factoryLevel=rHelper.data.products[factoryId].factoryLevel;void 0!==factoryLevel&&factoryLevel||(factoryLevel=0);let nextLevel=factoryLevel+1,sum=0,sumTransportation=0,table=$(crEl("table")),tbody=$(crEl("tbody")),td,small;$.each(rHelper.data.products[factoryId].upgradeMaterialAmount,(i,amount)=>{let tr=$(crEl("tr")),k=0;if(0===i)for(sum+=amount*Math.pow(nextLevel,2),k=0;k<=2;k+=1){switch(td=$(crEl("td")),k){case 0:let img=$(crEl("img")).attr("src","assets/img/cash.png").attr("alt","Cash");td.append(img[0]);break;case 1:td.addClass("text-right").attr("colspan",3).text(sum.toLocaleString("en-US"));break;case 2:small=$(crEl("small")).text("Transportation"),td.addClass("text-right text-warning").append(small[0])}tr.append(td[0])}else{let upgradeMaterial=rHelper.data.products[factoryId].upgradeMaterial[i],upgradeMaterialAmount=amount*Math.pow(nextLevel,2),price,materialWorth=rHelper.methods.CALC_returnPriceViaId(upgradeMaterial)*upgradeMaterialAmount,transportation=(rHelper.data.buildings[9].transportCost-1)*materialWorth,className;for(sum+=materialWorth,sumTransportation+=transportation,(upgradeMaterial+=1)<=13?className="material":upgradeMaterial>=14&&upgradeMaterial<=35?(upgradeMaterial-=14,className="product"):upgradeMaterial>=36&&upgradeMaterial<=51?(upgradeMaterial-=36,className="loot"):(upgradeMaterial-=51,className="units"),k=0;k<=4;k+=1){switch(td=$(crEl("td")),k){case 0:td.addClass(`resources-${className}-${upgradeMaterial-1}`);break;case 1:td.addClass("text-right").text(upgradeMaterialAmount.toLocaleString("en-US"));break;case 2:td.text("≙");break;case 3:td.addClass("text-right").text(materialWorth.toLocaleString("en-US"));break;case 4:small=$(crEl("small")).addClass("text-warning").text(transportation.toLocaleString("en-US")),td.addClass("text-right").append(small[0])}tr.append(td[0])}}tbody.append(tr[0])});let tr=$(crEl("tr")),result;for(let k=0;k<=1;k+=1)td=$(crEl("td")).addClass("text-right"),0===k?td.attr("colspan",4).text(sum.toLocaleString("en-US")):(small=$(crEl("small")).addClass("text-warning").text(sumTransportation.toLocaleString("en-US")),td.append(small[0])),tr.append(td[0]);return tbody.append(tr[0]),table.append(tbody[0]),rHelper.data.products[factoryId].upgradeCost=sum,{sum:sum,title:table[0].outerHTML}},CALC_factoryOutput(factoryId){"use strict";let factory=rHelper.data.products[factoryId];return factory.factoryLevel*factory.scaling},CALC_totalMineCount(){"use strict";let totalMineCount=0;return $.each(rHelper.data.material,(i,material)=>{totalMineCount+=material.amountOfMines}),totalMineCount},CALC_totalMineWorth(){"use strict";let totalMineWorth=0;return $.each(rHelper.data.material,i=>{totalMineWorth+=rHelper.methods.CALC_materialRateWorth(i)}),totalMineWorth},CALC_returnPriceViaId(id,period){"use strict";let possiblePrices=["current","1day","3days","7days","4weeks","3months","6months","1year","max"],index=0;if(void 0===period){let settings,priceAgeSetting=2;void 0!==typeof rHelper.data.settings[5]&&(priceAgeSetting=rHelper.data.settings[5].value),index=possiblePrices[priceAgeSetting]}else"number"==typeof period&&(index=possiblePrices[period]);let target,targetPrices=rHelper.methods.CALC_convertId(id).prices[index];return targetPrices.ai>=targetPrices.player?targetPrices.ai:targetPrices.player},CALC_convertId(id){"use strict";return id<=13?rHelper.data.material[id]:id>=14&&id<=35?(id-=14,rHelper.data.products[id]):id>=36&&id<=51?(id-=36,rHelper.data.loot[id]):(id-=52,rHelper.data.units[id])},CALC_materialNewMinePrice(totalMineCount,materialId){"use strict";return Math.round(rHelper.data.material[materialId].basePrice*(1+totalMineCount/50))},CALC_materialRateWorth(materialId){"use strict";return rHelper.data.material[materialId].perHour*rHelper.methods.CALC_returnPriceViaId(materialId)},CALC_materialMinePerfectIncome(materialId){"use strict";return rHelper.data.material[materialId].maxRate*rHelper.methods.CALC_returnPriceViaId(materialId)},CALC_materialMineROI(type){"use strict";let array=[];for(let i=0;i<=13;i+=1){let newMinePrice=rHelper.methods.CALC_materialNewMinePrice(rHelper.methods.CALC_totalMineCount(),i),perfectIncome=rHelper.methods.CALC_materialMinePerfectIncome(i),customTUPrice=rHelper.methods.CALC_customTUPrice();switch(type){case"100":array.push(newMinePrice/perfectIncome/24);break;case"505":array.push((newMinePrice+customTUPrice)/perfectIncome/24/5.05);break;case"505hq":let userHQLevel=1;rHelper.data.headquarter.user&&(userHQLevel=rHelper.data.headquarter.user.level);let hqBoost=rHelper.data.headquarter[userHQLevel-1].boost-.9;array.push((newMinePrice+customTUPrice)/perfectIncome/24/5.05/hqBoost)}}return array},CALC_customTUPrice(){"use strict";let customTUPrice=0,tuIndex=46,settings=rHelper.data.settings[1],customTUCombination=[111,26,0,0];void 0!==typeof settings&&(customTUCombination=settings.value);for(let i=0;i<=3;i+=1)customTUPrice+=customTUCombination[i]*rHelper.methods.CALC_returnPriceViaId(46+i);return customTUPrice}},graphs:{gaugeOptions:{chart:{type:"solidgauge",backgroundColor:"transparent"},title:null,pane:{center:["50%","85%"],size:"140%",startAngle:-90,endAngle:90,background:{backgroundColor:"#EEE",innerRadius:"60%",outerRadius:"100%",shape:"arc"}},tooltip:{enabled:!1},yAxis:{minColor:"rgba(255, 127, 80, 0.75)",maxColor:"rgba(154, 205, 50, 0.75)",lineWidth:0,minorTickInterval:null,title:{y:-70},labels:{y:16}},plotOptions:{solidgauge:{dataLabels:{y:5,borderWidth:0,style:{color:"#dedede"},useHTML:!0}}}},material:{target:"graph-material",categories:[],mineData:[],incomeData:[],data:[],colors:["#8a4f3e","#a4938e","#aba59a","#2d2c2b","#8a5a3a","#d8d8d8","#b58359","#b87259","#9b7953","#c4b9ab","#957e60","#cccbc2","#b28b3d","#b0a17d"],reference:{mineCount:0,mineIncome:0},seriesNames:["Mines","Mine income"],responsiveId:"income",titleText:"mine distribution vs mine income"}},data:{},tu:[]};let openedWindow;$("#loading-text").text("fetching data"),void 0!==localStorage.rGame&&1!=getCookie("loggedIn")?(rHelper.data=JSON.parse(localStorage.getItem("rGame")),loadingAnimToggler("hide"),console.log("Found existing data!"),rHelper.init.core()):$.get({url:"api/core.php",success:response=>{switch(rHelper.data=response,localStorage.setItem("rGame",JSON.stringify(response)),loadingAnimToggler("hide"),parseInt(getCookie("loggedIn"))){case 1:console.log("Returning user - fetched existing data!");break;default:console.log("New user - fetched basic data!")}rHelper.init.user()},error:response=>{swal("Error fetching data",`Error message:<br />${response}<br /> Please try again.`,"error")}});